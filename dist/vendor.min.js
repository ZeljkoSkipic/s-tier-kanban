function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(()=>{try{var e;("undefined"==typeof document?"undefined":_typeof(document))<"u"&&((e=document.createElement("style")).appendChild(document.createTextNode(".ce-code__textarea{min-height:200px;font-family:Menlo,Monaco,Consolas,Courier New,monospace;color:#41314e;line-height:1.6em;font-size:12px;background:#f8f7fa;border:1px solid #f1f1f4;box-shadow:none;white-space:pre;word-wrap:normal;overflow-x:auto;resize:vertical}")),document.head.appendChild(e))}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})(),(e=>{"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&("undefined"==typeof module?"undefined":_typeof(module))<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(("undefined"==typeof globalThis?"undefined":_typeof(globalThis))<"u"?globalThis:self).CodeTool=e()})(function(){return(()=>_createClass(function e(t){var n=t.data,o=t.config,r=t.api,t=t.readOnly;_classCallCheck(this,e),this.api=r,this.readOnly=t,this.placeholder=this.api.i18n.t(o.placeholder||e.DEFAULT_PLACEHOLDER),this.CSS={baseClass:this.api.styles.block,input:this.api.styles.input,wrapper:"ce-code",textarea:"ce-code__textarea"},this.nodes={holder:null,textarea:null},this.data={code:n.code||""},this.nodes.holder=this.drawView()},[{key:"drawView",value:function(){var t=this,e=document.createElement("div"),n=document.createElement("textarea");return e.classList.add(this.CSS.baseClass,this.CSS.wrapper),n.classList.add(this.CSS.textarea,this.CSS.input),n.textContent=this.data.code,n.placeholder=this.placeholder,this.readOnly&&(n.disabled=!0),e.appendChild(n),n.addEventListener("keydown",function(e){"Tab"===e.code&&t.tabHandler(e)}),this.nodes.textarea=n,e}},{key:"render",value:function(){return this.nodes.holder}},{key:"save",value:function(e){return{code:e.querySelector("textarea").value}}},{key:"onPaste",value:function(e){e=e.detail.data;this.data={code:e.textContent}}},{key:"data",get:function(){return this._data},set:function(e){this._data=e,this.nodes.textarea&&(this.nodes.textarea.textContent=e.code)}},{key:"tabHandler",value:function(e){e.stopPropagation(),e.preventDefault();var t,n=e.target,o=n.selectionStart,r=n.value,i="  ";if(e.shiftKey){e=((e,t)=>{for(var n="";"\n"!==n&&0<t;)n=e.substr(t-=1,1);return"\n"===n&&(t+=1),t})(r,o);if(r.substr(e,i.length)!==i)return;n.value=r.substring(0,e)+r.substring(e+i.length),t=o-i.length}else t=o+i.length,n.value=r.substring(0,o)+i+r.substring(o);n.setSelectionRange(t,t)}}],[{key:"isReadOnlySupported",get:function(){return!0}},{key:"enableLineBreaks",get:function(){return!0}},{key:"toolbox",get:function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 8L5 12L9 16"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 8L19 12L15 16"/></svg>',title:"Code"}}},{key:"DEFAULT_PLACEHOLDER",get:function(){return"Enter a code"}},{key:"pasteConfig",get:function(){return{tags:["pre"]}}},{key:"sanitize",get:function(){return{code:!0}}}]))()});var DefaultBlock=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"render",value:function(){return document.createElement("span")}},{key:"save",value:function(e){return""}}],[{key:"isReadOnlySupported",get:function(){return!0}}]))(),_excluded=["class","isInternal"];function _objectWithoutProperties(e,t){if(null==e)return{};var n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var r=Object.getOwnPropertySymbols(e),i=0;i<r.length;i++)n=r[i],-1===t.indexOf(n)&&{}.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,o={};for(n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;o[n]=e[n]}return o}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,i,s,a=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=i.call(n)).done)&&(a.push(o.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _regeneratorRuntime(){_regeneratorRuntime=function(){return s};var l,s={},e=Object.prototype,c=e.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},o=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",r=t.toStringTag||"@@toStringTag";function i(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{i({},"")}catch(l){i=function(e,t,n){return e[t]=n}}function a(e,t,n,o){var r,i,s,a,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype),o=new E(o||[]);return u(t,"_invoke",{value:(r=e,i=n,s=o,a=h,function(e,t){if(a===f)throw Error("Generator is already running");if(a===g){if("throw"===e)throw t;return{value:l,done:!0}}for(s.method=e,s.arg=t;;){var n=s.delegate;if(n){n=function e(t,n){var o=n.method,r=t.iterator[o];if(r===l)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=l,e(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;o=d(r,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;r=o.arg;return r?r.done?(n[t.resultName]=r.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=l),n.delegate=null,v):r:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}(n,s);if(n){if(n===v)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(a===h)throw a=g,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);a=f;n=d(r,i,s);if("normal"===n.type){if(a=s.done?g:p,n.arg===v)continue;return{value:n.arg,done:s.done}}"throw"===n.type&&(a=g,s.method="throw",s.arg=n.arg)}})}),t}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}s.wrap=a;var h="suspendedStart",p="suspendedYield",f="executing",g="completed",v={};function m(){}function k(){}function b(){}var t={},y=(i(t,o,function(){return this}),Object.getPrototypeOf),y=y&&y(y(T([]))),w=(y&&y!==e&&c.call(y,o)&&(t=y),b.prototype=m.prototype=Object.create(t));function x(e){["next","throw","return"].forEach(function(t){i(e,t,function(e){return this._invoke(t,e)})})}function C(s,a){var t;u(this,"_invoke",{value:function(n,o){function e(){return new a(function(e,t){!function t(e,n,o,r){var i,e=d(s[e],s,n);if("throw"!==e.type)return(n=(i=e.arg).value)&&"object"==_typeof(n)&&c.call(n,"__await")?a.resolve(n.__await).then(function(e){t("next",e,o,r)},function(e){t("throw",e,o,r)}):a.resolve(n).then(function(e){i.value=e,o(i)},function(e){return t("throw",e,o,r)});r(e.arg)}(n,o,e,t)})}return t=t?t.then(e,e):e()}})}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function T(t){if(t||""===t){var n,e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=l,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return u(w,"constructor",{value:k.prototype=b,configurable:!0}),u(b,"constructor",{value:k,configurable:!0}),k.displayName=i(b,r,"GeneratorFunction"),s.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===k||"GeneratorFunction"===(e.displayName||e.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,i(e,r,"GeneratorFunction")),e.prototype=Object.create(w),e},s.awrap=function(e){return{__await:e}},x(C.prototype),i(C.prototype,n,function(){return this}),s.AsyncIterator=C,s.async=function(e,t,n,o,r){void 0===r&&(r=Promise);var i=new C(a(e,t,n,o),r);return s.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},x(w),i(w,r,"Generator"),i(w,o,function(){return this}),i(w,"toString",function(){return"[object Generator]"}),s.keys=function(e){var t,n=Object(e),o=[];for(t in n)o.push(t);return o.reverse(),function e(){for(;o.length;){var t=o.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},s.values=T,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=l)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var o=this;function e(e,t){return i.type="throw",i.arg=n,o.next=e,t&&(o.method="next",o.arg=l),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t],i=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var s=c.call(r,"catchLoc"),a=c.call(r,"finallyLoc");if(s&&a){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!a)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&c.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var r=o;break}}var i=(r=r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc?null:r)?r.completion:{};return i.type=e,i.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,o,r=this.tryEntries[t];if(r.tryLoc===e)return"throw"===(n=r.completion).type&&(o=n.arg,S(r)),o}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=l),v}},s}function _superPropGet(e,t,n,o){var r=_get(_getPrototypeOf(1&o?e.prototype:e),t,n);return 2&o&&"function"==typeof r?function(e){return r.apply(n,e)}:r}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=_superPropBase(e,t);if(o)return(o=Object.getOwnPropertyDescriptor(o,t)).get?o.get.call(arguments.length<3?e:n):o.value}).apply(null,arguments)}function _superPropBase(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _createForOfIteratorHelper(e,t){var n,o,r,i,s="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(s)return r=!(o=!0),{s:function(){s=s.call(e)},n:function(){var e=s.next();return o=e.done,e},e:function(e){r=!0,n=e},f:function(){try{o||null==s.return||s.return()}finally{if(r)throw n}}};if(Array.isArray(e)||(s=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return s&&(e=s),i=0,{s:t=function(){},n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"==_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var n="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function _construct(e,t,n){var o;return _isNativeReflectConstruct()?Reflect.construct.apply(null,arguments):((o=[null]).push.apply(o,t),t=new(e.bind.apply(e,o)),n&&_setPrototypeOf(t,n.prototype),t)}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _isNativeFunction(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function asyncGeneratorStep(e,t,n,o,r,i,s){try{var a=e[i](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(o,r)}function _asyncToGenerator(a){return function(){var e=this,s=arguments;return new Promise(function(t,n){var o=a.apply(e,s);function r(e){asyncGeneratorStep(o,t,n,r,i,"next",e)}function i(e){asyncGeneratorStep(o,t,n,r,i,"throw",e)}r(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n={}.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function ownKeys(t,e){var n,o=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),o.push.apply(o,n)),o}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:e+""}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}(e=>{"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&("undefined"==typeof module?"undefined":_typeof(module))<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(("undefined"==typeof globalThis?"undefined":_typeof(globalThis))<"u"?globalThis:self).EditorJS=e()})(function(){("undefined"==typeof globalThis?"undefined":_typeof(globalThis))<"u"?globalThis:("undefined"==typeof window?"undefined":_typeof(window))<"u"?window:("undefined"==typeof global?"undefined":_typeof(global))<"u"?global:("undefined"==typeof self?"undefined":_typeof(self))<"u"&&self;function P(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function D(){}Object.assign(D,{default:D,register:D,revert:function(){},__esModule:!0}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n}),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(document.documentElement.contains(t))do{if(t.matches(e))return t}while(null!==(t=t.parentElement||t.parentNode));return null}),Element.prototype.prepend||(Element.prototype.prepend=function(e){var n=document.createDocumentFragment();(e=Array.isArray(e)?e:[e]).forEach(function(e){var t=e instanceof Node;n.appendChild(t?e:document.createTextNode(e))}),this.insertBefore(n,this.firstChild)}),Element.prototype.scrollIntoViewIfNeeded||(Element.prototype.scrollIntoViewIfNeeded=function(e){e=0===arguments.length||!!e;var t=this.parentNode,n=window.getComputedStyle(t,null),o=parseInt(n.getPropertyValue("border-top-width")),n=parseInt(n.getPropertyValue("border-left-width")),r=this.offsetTop-t.offsetTop<t.scrollTop,i=this.offsetTop-t.offsetTop+this.clientHeight-o>t.scrollTop+t.clientHeight,s=this.offsetLeft-t.offsetLeft<t.scrollLeft,a=this.offsetLeft-t.offsetLeft+this.clientWidth-n>t.scrollLeft+t.clientWidth,l=r&&!i;(r||i)&&e&&(t.scrollTop=this.offsetTop-t.offsetTop-t.clientHeight/2-o+this.clientHeight/2),(s||a)&&e&&(t.scrollLeft=this.offsetLeft-t.offsetLeft-t.clientWidth/2-n+this.clientWidth/2),(r||i||s||a)&&!e&&this.scrollIntoView(l)}),window.requestIdleCallback=window.requestIdleCallback||function(e){var t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)};var j=function(){return crypto.getRandomValues(new Uint8Array(0<arguments.length&&void 0!==arguments[0]?arguments[0]:21)).reduce(function(e,t){return e+=(t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():62<t?"-":"_"},"")},F=((t={}).VERBOSE="VERBOSE",t.INFO="INFO",t.WARN="WARN",t.ERROR="ERROR",t),H=8,s=9,a=13,z=27,U=37,l=38,c=40,G=39,q=46,K=0;function W(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"log",o=3<arguments.length?arguments[3]:void 0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"color: inherit";if("console"in window&&window.console[n]){var i=["info","log","warn","error"].includes(n),s=[];switch(W.logLevel){case"ERROR":if("error"!==n)return;break;case"WARN":if(["error","warn"].includes(n))break;return;case"INFO":if(!i||e)return}o&&s.push(o);var a,l,c="Editor.js 2.29.1";e&&(t=(i?(s.unshift("line-height: 1em;\n            color: #006FEA;\n            display: inline-block;\n            font-size: 11px;\n            line-height: 1em;\n            background-color: #fff;\n            padding: 4px 9px;\n            border-radius: 30px;\n            border: 1px solid rgba(56, 138, 229, 0.16);\n            margin: 4px 5px 4px 0;",r),"%c".concat(c,"%c ")):"( ".concat(c," )")).concat(t));try{i?o?(a=console)[n].apply(a,["".concat(t," %o")].concat(s)):(l=console)[n].apply(l,[t].concat(s)):console[n](t)}catch(e){}}}W.logLevel="VERBOSE";var u=W.bind(window,!1),d=W.bind(window,!0);function h(e){return Object.prototype.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()}function p(e){return"function"===h(e)||"asyncfunction"===h(e)}function f(e){return"object"===h(e)}function g(e){return"string"===h(e)}function Y(e){return"number"===h(e)}function V(e){return"undefined"===h(e)}function v(e){return!e||0===Object.keys(e).length&&e.constructor===Object}function X(e){return 47<e&&e<58||32===e||13===e||229===e||64<e&&e<91||95<e&&e<112||185<e&&e<193||218<e&&e<223}function Z(){return(Z=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var o,r,i,s,n=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n,o){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.function(t.data);case 3:return e.next=5,n(V(t.data)?{}:t.data);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),o(V(t.data)?{}:t.data);case 10:case"end":return e.stop()}},e,null,[[0,7]])}))).apply(this,arguments)},i=function(e,t,n){return s.apply(this,arguments)},o=1<n.length&&void 0!==n[1]?n[1]:function(){},r=2<n.length&&void 0!==n[2]?n[2]:function(){},e.abrupt("return",t.reduce((()=>{var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return e.abrupt("return",i(n,o,r));case 3:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}})(),Promise.resolve()));case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function $(e){return Array.prototype.slice.call(e)}function Q(n,o){return function(){var e=this,t=arguments;window.setTimeout(function(){return n.apply(e,t)},o)}}function J(i,s,a){var l,c=this;return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=c,r=a&&!l;window.clearTimeout(l),l=window.setTimeout(function(){l=null,a||i.apply(o,t)},s),r&&i.apply(o,t)}}function ee(n,o,e){function r(){c=!1===u.leading?0:Date.now(),l=null,a=n.apply(i,s),l||(i=s=null)}var i,s,a,l=null,c=0,u=(u=2<arguments.length&&void 0!==e?e:void 0)||{};return function(){var e=Date.now(),t=(c||!1!==u.leading||(c=e),o-(e-c));return i=this,s=arguments,t<=0||o<t?(l&&(clearTimeout(l),l=null),c=e,a=n.apply(i,s),l||(i=s=null)):l||!1===u.trailing||(l=setTimeout(r,t)),a}}function m(e){return e[0].toUpperCase()+e.slice(1)}function te(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];if(!n.length)return e;var r=n.shift();if(f(e)&&f(r))for(var i in r)f(r[i])?(e[i]||Object.assign(e,_defineProperty({},i,{})),te(e[i],r[i])):Object.assign(e,_defineProperty({},i,r[i]));return te.apply(void 0,[e].concat(n))}function ne(e){t={win:!1,mac:!1,x11:!1,linux:!1},(n=Object.keys(t).find(function(e){return-1!==window.navigator.appVersion.toLowerCase().indexOf(e)}))&&(t[n]=!0);var t,n=t;return e=e.replace(/shift/gi,"⇧").replace(/backspace/gi,"⌫").replace(/enter/gi,"⏎").replace(/up/gi,"↑").replace(/left/gi,"→").replace(/down/gi,"↓").replace(/right/gi,"←").replace(/escape/gi,"⎋").replace(/insert/gi,"Ins").replace(/delete/gi,"␡").replace(/\+/gi," + "),e=n.mac?e.replace(/ctrl|cmd/gi,"⌘").replace(/alt/gi,"⌥"):e.replace(/cmd/gi,"Ctrl").replace(/windows/gi,"WIN")}function oe(e,t,n){t="«".concat(t,"» is deprecated and will be removed in the next major release. Please use the «").concat(n,"» instead.");e&&d(t,"warn")}function e(t,e,n){var o,r=n.value?"value":"get",i=n[r],s="#".concat(e,"Cache");return n[r]=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return void 0===this[s]&&(this[s]=i.apply.apply(i,[this].concat(t))),this[s]},"get"==r&&n.set&&(o=n.set,n.set=function(e){delete t[s],o.apply(this,e)}),n}function k(){return window.matchMedia("(max-width: ".concat(650,"px)")).matches}var re=("undefined"==typeof window?"undefined":_typeof(window))<"u"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||"MacIntel"===window.navigator.platform&&1<window.navigator.maxTouchPoints);var b=(()=>{function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"isSingleTag",value:function(e){return e.tagName&&["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"].includes(e.tagName)}},{key:"isLineBreakTag",value:function(e){return e&&e.tagName&&["BR","WBR"].includes(e.tagName)}},{key:"make",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement(e);for(t in Array.isArray(n)?(e=r.classList).add.apply(e,_toConsumableArray(n)):n&&r.classList.add(n),o)Object.prototype.hasOwnProperty.call(o,t)&&(r[t]=o[t]);return r}},{key:"text",value:function(e){return document.createTextNode(e)}},{key:"append",value:function(t,e){Array.isArray(e)?e.forEach(function(e){return t.appendChild(e)}):t.appendChild(e)}},{key:"prepend",value:function(t,e){Array.isArray(e)?(e=e.reverse()).forEach(function(e){return t.prepend(e)}):t.prepend(e)}},{key:"swap",value:function(e,t){var n=document.createElement("div"),o=e.parentNode;o.insertBefore(n,e),o.insertBefore(e,t),o.insertBefore(t,n),o.removeChild(n)}},{key:"find",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:document).querySelector(1<arguments.length?arguments[1]:void 0)}},{key:"get",value:function(e){return document.getElementById(e)}},{key:"findAll",value:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:document).querySelectorAll(1<arguments.length?arguments[1]:void 0)}},{key:"allInputsSelector",get:function(){return"[contenteditable=true], textarea, input:not([type]), "+["text","password","email","number","search","tel","url"].map(function(e){return'input[type="'.concat(e,'"]')}).join(", ")}},{key:"findAllInputs",value:function(e){return $(e.querySelectorAll(r.allInputsSelector)).reduce(function(e,t){return r.isNativeInput(t)||r.containsOnlyInlineElements(t)?[].concat(_toConsumableArray(e),[t]):[].concat(_toConsumableArray(e),_toConsumableArray(r.getDeepestBlockElements(t)))},[])}},{key:"getDeepestNode",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=t?"lastChild":"firstChild",o=t?"previousSibling":"nextSibling";if(e&&e.nodeType===Node.ELEMENT_NODE&&e[n]){n=e[n];if(r.isSingleTag(n)&&!r.isNativeInput(n)&&!r.isLineBreakTag(n))if(n[o])n=n[o];else{if(!n.parentNode[o])return n.parentNode;n=n.parentNode[o]}return this.getDeepestNode(n,t)}return e}},{key:"isElement",value:function(e){return!Y(e)&&e&&e.nodeType&&e.nodeType===Node.ELEMENT_NODE}},{key:"isFragment",value:function(e){return!Y(e)&&e&&e.nodeType&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE}},{key:"isContentEditable",value:function(e){return"true"===e.contentEditable}},{key:"isNativeInput",value:function(e){return!(!e||!e.tagName)&&["INPUT","TEXTAREA"].includes(e.tagName)}},{key:"canSetCaret",value:function(e){var t=!0;if(r.isNativeInput(e))switch(e.type){case"file":case"checkbox":case"radio":case"hidden":case"submit":case"button":case"image":case"reset":t=!1}else t=r.isContentEditable(e);return t}},{key:"isNodeEmpty",value:function(e,t){return!(this.isSingleTag(e)&&!this.isLineBreakTag(e))&&(e=this.isElement(e)&&this.isNativeInput(e)?e.value:e.textContent.replace("​",""),0===(e=t?e.replace(new RegExp(t,"g"),""):e).trim().length)}},{key:"isLeaf",value:function(e){return!!e&&0===e.childNodes.length}},{key:"isEmpty",value:function(e,t){e.normalize();for(var n=[e];0<n.length;)if(e=n.shift()){if(this.isLeaf(e)&&!this.isNodeEmpty(e,t))return!1;e.childNodes&&n.push.apply(n,_toConsumableArray(Array.from(e.childNodes)))}return!0}},{key:"isHTMLString",value:function(e){var t=r.make("div");return t.innerHTML=e,0<t.childElementCount}},{key:"getContentLength",value:function(e){return(r.isNativeInput(e)?e.value:e.nodeType===Node.TEXT_NODE?e:e.textContent).length}},{key:"blockElements",get:function(){return["address","article","aside","blockquote","canvas","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","ruby","section","table","tbody","thead","tr","tfoot","ul","video"]}},{key:"containsOnlyInlineElements",value:function(e){function t(e){return!r.blockElements.includes(e.tagName.toLowerCase())&&Array.from(e.children).every(t)}var n;g(e)?(n=document.createElement("div")).innerHTML=e:n=e;return Array.from(n.children).every(t)}},{key:"getDeepestBlockElements",value:function(e){return r.containsOnlyInlineElements(e)?[e]:Array.from(e.children).reduce(function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(r.getDeepestBlockElements(t)))},[])}},{key:"getHolder",value:function(e){return g(e)?document.getElementById(e):e}},{key:"isAnchor",value:function(e){return"a"===e.tagName.toLowerCase()}},{key:"offset",value:function(e){var e=e.getBoundingClientRect(),t=window.pageXOffset||document.documentElement.scrollLeft,n=window.pageYOffset||document.documentElement.scrollTop,n=e.top+n,t=e.left+t;return{top:n,left:t,bottom:n+e.height,right:t+e.width}}}])})(),t={ui:{blockTunes:{toggler:{"Click to tune":"","or drag to move":""}},inlineToolbar:{converter:{"Convert to":""}},toolbar:{toolbox:{Add:""}},popover:{Filter:"","Nothing found":""}},toolNames:{Text:"",Link:"",Bold:"",Italic:""},tools:{link:{"Add a link":""},stub:{"The block can not be displayed correctly.":""}},blockTunes:{delete:{Delete:"","Click to delete":""},moveUp:{"Move up":""},moveDown:{"Move down":""}}},n=(()=>_createClass(function e(){_classCallCheck(this,e)},null,[{key:"ui",value:function(e,t){return n._t(e,t)}},{key:"t",value:function(e,t){return n._t(e,t)}},{key:"setDictionary",value:function(e){n.currentDictionary=e}},{key:"_t",value:function(e,t){e=n.getNamespace(e);return e&&e[t]?e[t]:t}},{key:"getNamespace",value:function(e){return e.split(".").reduce(function(e,t){return e&&Object.keys(e).length?e[t]:{}},n.currentDictionary)}}]))(),y=n,ie=(y.currentDictionary=t,(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,_wrapNativeSuper(Error)),_createClass(e)})()),se=(()=>_createClass(function e(){_classCallCheck(this,e),this.subscribers={}},[{key:"on",value:function(e,t){e in this.subscribers||(this.subscribers[e]=[]),this.subscribers[e].push(t)}},{key:"once",value:function(n,o){function r(e){var e=o(e),t=i.subscribers[n].indexOf(r);return-1!==t&&i.subscribers[n].splice(t,1),e}var i=this;n in this.subscribers||(this.subscribers[n]=[]);this.subscribers[n].push(r)}},{key:"emit",value:function(e,t){!v(this.subscribers)&&this.subscribers[e]&&this.subscribers[e].reduce(function(e,t){t=t(e);return void 0!==t?t:e},t)}},{key:"off",value:function(e,t){if(void 0===this.subscribers[e])console.warn('EventDispatcher .off(): there is no subscribers for event "'.concat(e.toString(),'". Probably, .off() called before .on()'));else for(var n=0;n<this.subscribers[e].length;n++)if(this.subscribers[e][n]===t){delete this.subscribers[e][n];break}}},{key:"destroy",value:function(){this.subscribers={}}}]))();function w(n){Object.setPrototypeOf(this,{get id(){return n.id},get name(){return n.name},get config(){return n.config},get holder(){return n.holder},get isEmpty(){return n.isEmpty},get selected(){return n.selected},set stretched(e){n.stretched=e},get stretched(){return n.stretched},get focusable(){return n.focusable},call:function(e,t){return n.call(e,t)},save:function(){return n.save()},validate:function(e){return n.validate(e)},dispatchChange:function(){n.dispatchChange()}})}var ae=(()=>_createClass(function e(){_classCallCheck(this,e),this.allListeners=[]},[{key:"on",value:function(e,t,n){var o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],r=function(e){return"".concat(0<arguments.length&&void 0!==e?e:"").concat(Math.floor(1e8*Math.random()).toString(16))}("l"),i={id:r,element:e,eventType:t,handler:n,options:o};if(!this.findOne(e,t,n))return this.allListeners.push(i),e.addEventListener(t,n,o),r}},{key:"off",value:function(e,t,n,o){var r=this,i=this.findAll(e,t,n);i.forEach(function(e,t){t=r.allListeners.indexOf(i[t]);-1<t&&(r.allListeners.splice(t,1),e.element.removeEventListener(e.eventType,e.handler,e.options))})}},{key:"offById",value:function(e){e=this.findById(e);e&&e.element.removeEventListener(e.eventType,e.handler,e.options)}},{key:"findOne",value:function(e,t,n){e=this.findAll(e,t,n);return 0<e.length?e[0]:null}},{key:"findAll",value:function(e,t,n){var o=e?this.findByEventTarget(e):[],e=e&&t&&n?o.filter(function(e){return e.eventType===t&&e.handler===n}):e&&t?o.filter(function(e){return e.eventType===t}):o;return e}},{key:"removeAll",value:function(){this.allListeners.map(function(e){e.element.removeEventListener(e.eventType,e.handler,e.options)}),this.allListeners=[]}},{key:"destroy",value:function(){this.removeAll()}},{key:"findByEventTarget",value:function(t){return this.allListeners.filter(function(e){if(e.element===t)return e})}},{key:"findByType",value:function(t){return this.allListeners.filter(function(e){if(e.eventType===t)return e})}},{key:"findByHandler",value:function(t){return this.allListeners.filter(function(e){if(e.handler===t)return e})}},{key:"findById",value:function(t){return this.allListeners.find(function(e){return e.id===t})}}]))(),x=(()=>_createClass(function e(t){var o=this,n=t.config,t=t.eventsDispatcher;if(_classCallCheck(this,e),this.nodes={},this.listeners=new ae,this.readOnlyMutableListeners={on:function(e,t,n){o.mutableListenerIds.push(o.listeners.on(e,t,n,3<arguments.length&&void 0!==arguments[3]&&arguments[3]))},clearAll:function(){var e,t=_createForOfIteratorHelper(o.mutableListenerIds);try{for(t.s();!(e=t.n()).done;){var n=e.value;o.listeners.offById(n)}}catch(e){t.e(e)}finally{t.f()}o.mutableListenerIds=[]}},this.mutableListenerIds=[],(this instanceof e?this.constructor:void 0)===e)throw new TypeError("Constructors for abstract class Module are not allowed.");this.config=n,this.eventsDispatcher=t},[{key:"state",set:function(e){this.Editor=e}},{key:"removeAllNodes",value:function(){for(var e in this.nodes){e=this.nodes[e];e instanceof HTMLElement&&e.remove()}}},{key:"isRtl",get:function(){return"rtl"===this.config.i18n.direction}}]))(),C=(()=>{function n(){_classCallCheck(this,n),this.instance=null,this.selection=null,this.savedSelectionRange=null,this.isFakeBackgroundEnabled=!1,this.commandBackground="backColor",this.commandRemoveFormat="removeFormat"}return _createClass(n,[{key:"removeFakeBackground",value:function(){this.isFakeBackgroundEnabled&&(this.isFakeBackgroundEnabled=!1,document.execCommand(this.commandRemoveFormat))}},{key:"setFakeBackground",value:function(){document.execCommand(this.commandBackground,!1,"#a8d6ff"),this.isFakeBackgroundEnabled=!0}},{key:"save",value:function(){this.savedSelectionRange=n.range}},{key:"restore",value:function(){var e;this.savedSelectionRange&&((e=window.getSelection()).removeAllRanges(),e.addRange(this.savedSelectionRange))}},{key:"clearSaved",value:function(){this.savedSelectionRange=null}},{key:"collapseToEnd",value:function(){var e=window.getSelection(),t=document.createRange();t.selectNodeContents(e.focusNode),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}},{key:"findParentTag",value:function(n,o){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:10,e=window.getSelection(),i=null;return e&&e.anchorNode&&e.focusNode?([e.anchorNode,e.focusNode].forEach(function(e){for(var t=r;0<t&&e.parentNode&&(e.tagName!==n||(i=e,!(i=o&&e.classList&&!e.classList.contains(o)?null:i)));)e=e.parentNode,t--}),i):null}},{key:"expandToTag",value:function(e){var t=window.getSelection(),n=(t.removeAllRanges(),document.createRange());n.selectNodeContents(e),t.addRange(n)}}],[{key:"CSS",get:function(){return{editorWrapper:"codex-editor",editorZone:"codex-editor__redactor"}}},{key:"anchorNode",get:function(){var e=window.getSelection();return e?e.anchorNode:null}},{key:"anchorElement",get:function(){var e=window.getSelection();return(e=e&&e.anchorNode)?b.isElement(e)?e:e.parentElement:null}},{key:"anchorOffset",get:function(){var e=window.getSelection();return e?e.anchorOffset:null}},{key:"isCollapsed",get:function(){var e=window.getSelection();return e?e.isCollapsed:null}},{key:"isAtEditor",get:function(){return this.isSelectionAtEditor(n.get())}},{key:"isSelectionAtEditor",value:function(e){var t;return!!e&&(t=null,!!(t=(e=(e=e.anchorNode||e.focusNode)&&e.nodeType===Node.TEXT_NODE?e.parentNode:e)&&e instanceof Element?e.closest(".".concat(n.CSS.editorZone)):t))&&t.nodeType===Node.ELEMENT_NODE}},{key:"isRangeAtEditor",value:function(e){var t;if(e)return t=null,!!(t=(e=(e=e.startContainer)&&e.nodeType===Node.TEXT_NODE?e.parentNode:e)&&e instanceof Element?e.closest(".".concat(n.CSS.editorZone)):t)&&t.nodeType===Node.ELEMENT_NODE}},{key:"isSelectionExists",get:function(){return!!n.get().anchorNode}},{key:"range",get:function(){return this.getRangeFromSelection(this.get())}},{key:"getRangeFromSelection",value:function(e){return e&&e.rangeCount?e.getRangeAt(0):null}},{key:"rect",get:function(){var e,t=document.selection,n={x:0,y:0,width:0,height:0};return t&&"Control"!==t.type?(e=t.createRange(),n.x=e.boundingLeft,n.y=e.boundingTop,n.width=e.boundingWidth,n.height=e.boundingHeight):window.getSelection?null===(t=window.getSelection()).rangeCount||isNaN(t.rangeCount)?u("Method SelectionUtils.rangeCount is not supported","warn"):0!==t.rangeCount&&0===(n=(e=t.getRangeAt(0).cloneRange()).getBoundingClientRect?e.getBoundingClientRect():n).x&&0===n.y&&(t=document.createElement("span")).getBoundingClientRect&&(t.appendChild(document.createTextNode("​")),e.insertNode(t),n=t.getBoundingClientRect(),(e=t.parentNode).removeChild(t),e.normalize()):u("Method window.getSelection is not supported","warn"),n}},{key:"text",get:function(){return window.getSelection?window.getSelection().toString():""}},{key:"get",value:function(){return window.getSelection()}},{key:"setCursor",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=document.createRange(),o=window.getSelection();return b.isNativeInput(e)?b.canSetCaret(e)?(e.focus(),e.selectionStart=e.selectionEnd=t,e.getBoundingClientRect()):void 0:(n.setStart(e,t),n.setEnd(e,t),o.removeAllRanges(),o.addRange(n),n.getBoundingClientRect())}},{key:"isRangeInsideContainer",value:function(e){var t=n.range;return null!==t&&e.contains(t.startContainer)}},{key:"addFakeCursor",value:function(){var e,t=n.range;null!==t&&((e=b.make("span","codex-editor__fake-cursor")).dataset.mutationFree="true",t.collapse(),t.insertNode(e))}},{key:"isFakeCursorInsideContainer",value:function(e){return null!==b.find(e,".codex-editor__fake-cursor")}},{key:"removeFakeCursor",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document.body,e=b.find(e,".codex-editor__fake-cursor");e&&e.remove()}}])})();var le="redactor dom changed",ce="block changed",ue="fake cursor is about to be toggled",de="fake cursor have been set";function he(e,t){return e.mergeable&&e.name===t.name}(o={}).APPEND_CALLBACK="appendCallback",o.RENDERED="rendered",o.MOVED="moved",o.UPDATED="updated",o.REMOVED="removed",o.ON_PASTE="onPaste";var pe,fe,_=o,S=(()=>{function l(e,t){var o,n=e.id,n=void 0===n?j(10):n,r=e.data,i=e.tool,s=e.api,a=e.readOnly,e=e.tunesData;return _classCallCheck(this,l),(o=_callSuper(this,l)).cachedInputs=[],o.toolRenderedElement=null,o.tunesInstances=new Map,o.defaultTunesInstances=new Map,o.unavailableTunesData={},o.inputIndex=0,o.editorEventBus=null,o.handleFocus=function(){o.dropInputsCache(),o.updateCurrentInput()},o.didMutated=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0,t=void 0===e,n=e instanceof InputEvent;t||n||o.detectToolRootChange(e),!t&&!n&&(0<e.length&&e.every(function(e){var t=e.addedNodes,n=e.removedNodes,e=e.target;return[].concat(_toConsumableArray(Array.from(t)),_toConsumableArray(Array.from(n)),[e]).some(function(e){return(e=b.isElement(e)?e:e.parentElement)&&null!==e.closest('[data-mutation-free="true"]')})}))||(o.dropInputsCache(),o.updateCurrentInput(),o.call("updated"),o.emit("didMutated",_assertThisInitialized(o)))},o.name=i.name,o.id=n,o.settings=i.settings,o.config=i.settings.config||{},o.api=s,o.editorEventBus=t||null,o.blockAPI=new w(_assertThisInitialized(o)),o.tool=i,o.toolInstance=i.create(r,o.blockAPI,a),o.tunes=i.tunes,o.composeTunes(e),o.holder=o.compose(),window.requestIdleCallback(function(){o.watchBlockMutations(),o.addInputEvents()}),o}return _inherits(l,se),_createClass(l,[{key:"inputs",get:function(){var e;return 0!==this.cachedInputs.length?this.cachedInputs:(e=b.findAllInputs(this.holder),this.inputIndex>e.length-1&&(this.inputIndex=e.length-1),this.cachedInputs=e)}},{key:"currentInput",get:function(){return this.inputs[this.inputIndex]},set:function(t){var e=this.inputs.findIndex(function(e){return e===t||e.contains(t)});-1!==e&&(this.inputIndex=e)}},{key:"firstInput",get:function(){return this.inputs[0]}},{key:"lastInput",get:function(){var e=this.inputs;return e[e.length-1]}},{key:"nextInput",get:function(){return this.inputs[this.inputIndex+1]}},{key:"previousInput",get:function(){return this.inputs[this.inputIndex-1]}},{key:"data",get:function(){return this.save().then(function(e){return e&&!v(e.data)?e.data:{}})}},{key:"sanitize",get:function(){return this.tool.sanitizeConfig}},{key:"mergeable",get:function(){return p(this.toolInstance.merge)}},{key:"focusable",get:function(){return 0!==this.inputs.length}},{key:"isEmpty",get:function(){var e=b.isEmpty(this.pluginsContent,"/"),t=!this.hasMedia;return e&&t}},{key:"hasMedia",get:function(){return!!this.holder.querySelector(["img","iframe","video","audio","source","input","textarea","twitterwidget"].join(","))}},{key:"selected",get:function(){return this.holder.classList.contains(l.CSS.selected)},set:function(e){this.holder.classList.toggle(l.CSS.selected,e);var t=!0===e&&C.isRangeInsideContainer(this.holder),n=!1===e&&C.isFakeCursorInsideContainer(this.holder);(t||n)&&(null!=(n=this.editorEventBus)&&n.emit(ue,{state:e}),t?C.addFakeCursor():C.removeFakeCursor(this.holder),null!=(n=this.editorEventBus))&&n.emit(de,{state:e})}},{key:"stretched",get:function(){return this.holder.classList.contains(l.CSS.wrapperStretched)},set:function(e){this.holder.classList.toggle(l.CSS.wrapperStretched,e)}},{key:"dropTarget",set:function(e){this.holder.classList.toggle(l.CSS.dropTarget,e)}},{key:"pluginsContent",get:function(){return this.toolRenderedElement}},{key:"call",value:function(t,e){if(p(this.toolInstance[t])){"appendCallback"===t&&u("`appendCallback` hook is deprecated and will be removed in the next major release. Use `rendered` hook instead","warn");try{this.toolInstance[t].call(this.toolInstance,e)}catch(e){u("Error during '".concat(t,"' call: ").concat(e.message),"error")}}}},{key:"mergeWith",value:(r=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.toolInstance.merge(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"save",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o,r,i=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.toolInstance.save(this.pluginsContent);case 2:return t=e.sent,n=this.unavailableTunesData,[].concat(_toConsumableArray(this.tunesInstances.entries()),_toConsumableArray(this.defaultTunesInstances.entries())).forEach(function(t){var t=_slicedToArray(t,2),e=t[0],t=t[1];if(p(t.save))try{n[e]=t.save()}catch(e){u("Tune ".concat(t.constructor.name," save method throws an Error %o"),"warn",e)}}),o=window.performance.now(),e.abrupt("return",Promise.resolve(t).then(function(e){return r=window.performance.now(),{id:i.id,tool:i.name,data:e,tunes:n,time:r-o}}).catch(function(e){u("Saving process for ".concat(i.name," tool failed due to the ").concat(e),"log","red")}));case 7:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"validate",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!0,e.t0=this.toolInstance.validate instanceof Function,e.t0)return e.next=5,this.toolInstance.validate(t);e.next=6;break;case 5:n=e.sent;case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"getTunes",value:function(){var t=document.createElement("div"),n=[];return["function"==typeof this.toolInstance.renderSettings?this.toolInstance.renderSettings():[],[].concat(_toConsumableArray(this.tunesInstances.values()),_toConsumableArray(this.defaultTunesInstances.values())).map(function(e){return e.render()})].flat().forEach(function(e){b.isElement(e)?t.appendChild(e):Array.isArray(e)?n.push.apply(n,_toConsumableArray(e)):n.push(e)}),[n,t]}},{key:"updateCurrentInput",value:function(){this.currentInput=b.isNativeInput(document.activeElement)||!C.anchorNode?document.activeElement:C.anchorNode}},{key:"dispatchChange",value:function(){this.didMutated()}},{key:"destroy",value:function(){this.unwatchBlockMutations(),this.removeInputEvents(),_superPropGet(l,"destroy",this,3)([]),p(this.toolInstance.destroy)&&this.toolInstance.destroy()}},{key:"getActiveToolboxEntry",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1===(t=this.tool.toolbox).length)return e.abrupt("return",Promise.resolve(this.tool.toolbox[0]));e.next=3;break;case 3:return e.next=5,this.data;case 5:return r=e.sent,e.abrupt("return",t.find(function(e){return Object.entries(e.data).some(function(e){var t,n,e=_slicedToArray(e,2),o=e[0];return r[o]&&(o=r[o],e=e[1],t=Array.isArray(o)||f(o),n=Array.isArray(e)||f(e),t||n?JSON.stringify(o)===JSON.stringify(e):o===e)})}));case 7:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"exportDataAsString",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data;case 2:return o=e.sent,e.abrupt("return",(t=o,p(n=null==(n=this.tool.conversionConfig)?void 0:n.export)?n(t):g(n)?t[n]:(void 0!==n&&u("Conversion «export» property must be a string or function. String means key of saved data object to export. Function should export processed string to export."),"")));case 4:case"end":return e.stop()}var t,n},e,this)})),function(){return e.apply(this,arguments)})},{key:"compose",value:function(){var e=b.make("div",l.CSS.wrapper),t=b.make("div",l.CSS.content),n=this.toolInstance.render(),o=(e.dataset.id=this.id,this.toolRenderedElement=n,t.appendChild(this.toolRenderedElement),t);return[].concat(_toConsumableArray(this.tunesInstances.values()),_toConsumableArray(this.defaultTunesInstances.values())).forEach(function(t){if(p(t.wrap))try{o=t.wrap(o)}catch(e){u("Tune ".concat(t.constructor.name," wrap method throws an Error %o"),"warn",e)}}),e.appendChild(o),e}},{key:"composeTunes",value:function(t){var n=this;Array.from(this.tunes.values()).forEach(function(e){(e.isInternal?n.defaultTunesInstances:n.tunesInstances).set(e.name,e.create(t[e.name],n.blockAPI))}),Object.entries(t).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];n.tunesInstances.has(t)||(n.unavailableTunesData[t]=e)})}},{key:"addInputEvents",value:function(){var t=this;this.inputs.forEach(function(e){e.addEventListener("focus",t.handleFocus),b.isNativeInput(e)&&e.addEventListener("input",t.didMutated)})}},{key:"removeInputEvents",value:function(){var t=this;this.inputs.forEach(function(e){e.removeEventListener("focus",t.handleFocus),b.isNativeInput(e)&&e.removeEventListener("input",t.didMutated)})}},{key:"watchBlockMutations",value:function(){var e,s=this;this.redactorDomChangedCallback=function(e){e=e.mutations;e.some(function(e){return t=e,n=s.toolRenderedElement,o=e.type,r=e.target,i=e.addedNodes,t=e.removedNodes,r===n||(["characterData","attributes"].includes(o)?(o=r.nodeType===Node.TEXT_NODE?r.parentNode:r,n.contains(o)):(r=Array.from(i).some(function(e){return n.contains(e)}),o=Array.from(t).some(function(e){return n.contains(e)}),r||o));var t,n,o,r,i})&&s.didMutated(e)},null!=(e=this.editorEventBus)&&e.on(le,this.redactorDomChangedCallback)}},{key:"unwatchBlockMutations",value:function(){var e;null!=(e=this.editorEventBus)&&e.off(le,this.redactorDomChangedCallback)}},{key:"detectToolRootChange",value:function(e){var t=this;e.forEach(function(e){Array.from(e.removedNodes).includes(t.toolRenderedElement)&&(e=e.addedNodes[e.addedNodes.length-1],t.toolRenderedElement=e)})}},{key:"dropInputsCache",value:function(){this.cachedInputs=[]}}],[{key:"CSS",get:function(){return{wrapper:"ce-block",wrapperStretched:"ce-block--stretched",content:"ce-block__content",selected:"ce-block--selected",dropTarget:"ce-block--drop-target"}}}]);var e,t,n,o,r})(),o=(()=>{function e(){var s;return _classCallCheck(this,e),(s=_callSuper(this,e,arguments)).insert=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:s.config.defaultBlock,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0,r=5<arguments.length?arguments[5]:void 0;return new w(s.Editor.BlockManager.insert({id:6<arguments.length?arguments[6]:void 0,tool:e,data:t,index:n,needToFocus:o,replace:r}))},s.composeBlockData=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.Editor.Tools.blockTools.get(t),e.abrupt("return",new S({tool:n,api:s.Editor.API,readOnly:!0,data:{},tunesData:{}}).data);case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),s.update=(()=>{var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o,r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.Editor.BlockManager,void 0===(r=o.getBlockById(t)))throw new Error('Block with id "'.concat(t,'" not found'));e.next=3;break;case 3:return e.next=5,o.update(r,n);case 5:return i=e.sent,e.abrupt("return",new w(i));case 7:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}})(),s.convert=function(e,t,n){var o=s.Editor,r=o.BlockManager,o=o.Tools,i=r.getBlockById(e);if(!i)throw new Error('Block with id "'.concat(e,'" not found'));var e=o.blockTools.get(i.name),o=o.blockTools.get(t);if(!o)throw new Error('Block Tool with type "'.concat(t,'" not found'));e=void 0!==(null==(e=null==e?void 0:e.conversionConfig)?void 0:e.export),o=void 0!==(null==(o=o.conversionConfig)?void 0:o.import);if(!e||!o)throw e=[!e&&m(i.name),!o&&m(t)].filter(Boolean).join(" and "),new Error('Conversion from "'.concat(i.name,'" to "').concat(t,'" is not possible. ').concat(e,' tool(s) should provide a "conversionConfig"'));r.convert(i,t,n)},s.insertMany=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.Editor.BlockManager.blocks.length-1,e=(s.validateIndex(t),e.map(function(e){var t=e.id;return s.Editor.BlockManager.composeBlock({id:t,tool:e.type||s.config.defaultBlock,data:e.data})}));return s.Editor.BlockManager.insertMany(e,t),e.map(function(e){return new w(e)})},s}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var n=this;return{clear:function(){return n.clear()},render:function(e){return n.render(e)},renderFromHTML:function(e){return n.renderFromHTML(e)},delete:function(e){return n.delete(e)},swap:function(e,t){return n.swap(e,t)},move:function(e,t){return n.move(e,t)},getBlockByIndex:function(e){return n.getBlockByIndex(e)},getById:function(e){return n.getById(e)},getCurrentBlockIndex:function(){return n.getCurrentBlockIndex()},getBlockIndex:function(e){return n.getBlockIndex(e)},getBlocksCount:function(){return n.getBlocksCount()},stretchBlock:function(e){return n.stretchBlock(e,!(1<arguments.length&&void 0!==arguments[1])||arguments[1])},insertNewBlock:function(){return n.insertNewBlock()},insert:this.insert,insertMany:this.insertMany,update:this.update,composeBlockData:this.composeBlockData,convert:this.convert}}},{key:"getBlocksCount",value:function(){return this.Editor.BlockManager.blocks.length}},{key:"getCurrentBlockIndex",value:function(){return this.Editor.BlockManager.currentBlockIndex}},{key:"getBlockIndex",value:function(e){var t=this.Editor.BlockManager.getBlockById(e);if(t)return this.Editor.BlockManager.getBlockIndex(t);d("There is no block with id `"+e+"`","warn")}},{key:"getBlockByIndex",value:function(e){var t=this.Editor.BlockManager.getBlockByIndex(e);if(void 0!==t)return new w(t);d("There is no block at index `"+e+"`","warn")}},{key:"getById",value:function(e){var t=this.Editor.BlockManager.getBlockById(e);return void 0===t?(d("There is no block with id `"+e+"`","warn"),null):new w(t)}},{key:"swap",value:function(e,t){u("`blocks.swap()` method is deprecated and will be removed in the next major release. Use `block.move()` method instead","info"),this.Editor.BlockManager.swap(e,t)}},{key:"move",value:function(e,t){this.Editor.BlockManager.move(e,t)}},{key:"delete",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.Editor.BlockManager.currentBlockIndex;try{var t=this.Editor.BlockManager.getBlockByIndex(e);this.Editor.BlockManager.removeBlock(t)}catch(t){return void d(t,"warn")}0===this.Editor.BlockManager.blocks.length&&this.Editor.BlockManager.insert(),this.Editor.BlockManager.currentBlock&&this.Editor.Caret.setToBlock(this.Editor.BlockManager.currentBlock,this.Editor.Caret.positions.END),this.Editor.Toolbar.close()}},{key:"clear",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Editor.BlockManager.clear(!0);case 2:this.Editor.InlineToolbar.close();case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"render",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===t||void 0===t.blocks)throw new Error("Incorrect data passed to the render() method");e.next=2;break;case 2:return this.Editor.ModificationsObserver.disable(),e.next=5,this.Editor.BlockManager.clear();case 5:return e.next=7,this.Editor.Renderer.render(t.blocks);case 7:this.Editor.ModificationsObserver.enable();case 8:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"renderFromHTML",value:function(e){return this.Editor.BlockManager.clear(),this.Editor.Paste.processText(e,!0)}},{key:"stretchBlock",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],e=(oe(!0,"blocks.stretchBlock()","BlockAPI"),this.Editor.BlockManager.getBlockByIndex(e));e&&(e.stretched=t)}},{key:"insertNewBlock",value:function(){u("Method blocks.insertNewBlock() is deprecated and it will be removed in the next major release. Use blocks.insert() instead.","warn"),this.insert()}},{key:"validateIndex",value:function(e){if("number"!=typeof e)throw new Error("Index should be a number");if(e<0)throw new Error("Index should be greater than or equal to 0");if(null===e)throw new Error("Index should be greater than or equal to 0")}}]);var t,n})(),ge=(()=>{function e(){var n;return _classCallCheck(this,e),(n=_callSuper(this,e,arguments)).setToFirstBlock=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.Editor.Caret.positions.DEFAULT;return!!n.Editor.BlockManager.firstBlock&&(n.Editor.Caret.setToBlock(n.Editor.BlockManager.firstBlock,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),!0)},n.setToLastBlock=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.Editor.Caret.positions.DEFAULT;return!!n.Editor.BlockManager.lastBlock&&(n.Editor.Caret.setToBlock(n.Editor.BlockManager.lastBlock,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),!0)},n.setToPreviousBlock=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.Editor.Caret.positions.DEFAULT;return!!n.Editor.BlockManager.previousBlock&&(n.Editor.Caret.setToBlock(n.Editor.BlockManager.previousBlock,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),!0)},n.setToNextBlock=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:n.Editor.Caret.positions.DEFAULT;return!!n.Editor.BlockManager.nextBlock&&(n.Editor.Caret.setToBlock(n.Editor.BlockManager.nextBlock,e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),!0)},n.setToBlock=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:n.Editor.Caret.positions.DEFAULT;return!!n.Editor.BlockManager.blocks[e]&&(n.Editor.Caret.setToBlock(n.Editor.BlockManager.blocks[e],t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:0),!0)},n.focus=function(){return 0<arguments.length&&void 0!==arguments[0]&&arguments[0]?n.setToLastBlock(n.Editor.Caret.positions.END):n.setToFirstBlock(n.Editor.Caret.positions.START)},n}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){return{setToFirstBlock:this.setToFirstBlock,setToLastBlock:this.setToLastBlock,setToPreviousBlock:this.setToPreviousBlock,setToNextBlock:this.setToNextBlock,setToBlock:this.setToBlock,focus:this.focus}}}])})(),ve=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var n=this;return{emit:function(e,t){return n.emit(e,t)},off:function(e,t){return n.off(e,t)},on:function(e,t){return n.on(e,t)}}}},{key:"on",value:function(e,t){this.eventsDispatcher.on(e,t)}},{key:"emit",value:function(e,t){this.eventsDispatcher.emit(e,t)}},{key:"off",value:function(e,t){this.eventsDispatcher.off(e,t)}}])})(),me=(()=>{function n(){return _classCallCheck(this,n),_callSuper(this,n,arguments)}return _inherits(n,x),_createClass(n,[{key:"methods",get:function(){return{t:function(){d("I18n.t() method can be accessed only from Tools","warn")}}}},{key:"getMethodsForTool",value:function(t){return Object.assign(this.methods,{t:function(e){return y.t(n.getNamespace(t),e)}})}}],[{key:"getNamespace",value:function(e){return(e.isTune()?"blockTunes.":"tools.").concat(e.name)}}])})(),ke=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){return{blocks:this.Editor.BlocksAPI.methods,caret:this.Editor.CaretAPI.methods,events:this.Editor.EventsAPI.methods,listeners:this.Editor.ListenersAPI.methods,notifier:this.Editor.NotifierAPI.methods,sanitizer:this.Editor.SanitizerAPI.methods,saver:this.Editor.SaverAPI.methods,selection:this.Editor.SelectionAPI.methods,styles:this.Editor.StylesAPI.classes,toolbar:this.Editor.ToolbarAPI.methods,inlineToolbar:this.Editor.InlineToolbarAPI.methods,tooltip:this.Editor.TooltipAPI.methods,i18n:this.Editor.I18nAPI.methods,readOnly:this.Editor.ReadOnlyAPI.methods,ui:this.Editor.UiAPI.methods}}},{key:"getMethodsForTool",value:function(e){return Object.assign(this.methods,{i18n:this.Editor.I18nAPI.getMethodsForTool(e)})}}])})(),be=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var e=this;return{close:function(){return e.close()},open:function(){return e.open()}}}},{key:"open",value:function(){this.Editor.InlineToolbar.tryToShow()}},{key:"close",value:function(){this.Editor.InlineToolbar.close()}}])})(),ye=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var r=this;return{on:function(e,t,n,o){return r.on(e,t,n,o)},off:function(e,t,n,o){return r.off(e,t,n,o)},offById:function(e){return r.offById(e)}}}},{key:"on",value:function(e,t,n,o){return this.listeners.on(e,t,n,o)}},{key:"off",value:function(e,t,n,o){this.listeners.off(e,t,n,o)}},{key:"offById",value:function(e){this.listeners.offById(e)}}])})(),we={},xe={get exports(){return we},set exports(e){we=e}};function r(e){var t;return(fe[e]||(t=fe[e]={i:e,l:!1,exports:{}},pe[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}window,xe.exports=(pe=[function(e,t,n){var o,r;n(1),e.exports=(o=n(6),r=null,{show:function(e){if(e.message){r||(r=o.getWrapper(),document.body.appendChild(r));var t=null,n=e.time||8e3;switch(e.type){case"confirm":t=o.confirm(e);break;case"prompt":t=o.prompt(e);break;default:t=o.alert(e),window.setTimeout(function(){t.remove()},n)}r.appendChild(t),t.classList.add("cdx-notify--bounce-in")}}})},function(e,t,n){var o=n(2);"string"==typeof o&&(o=[[e.i,o,""]]);n(4)(o,{hmr:!0,transform:void 0,insertInto:void 0}),o.locals&&(e.exports=o.locals)},function(e,t,n){(e.exports=n(3)(!1)).push([e.i,'.cdx-notify--error{background:#fffbfb!important}.cdx-notify--error::before{background:#fb5d5d!important}.cdx-notify__input{max-width:130px;padding:5px 10px;background:#f7f7f7;border:0;border-radius:3px;font-size:13px;color:#656b7c;outline:0}.cdx-notify__input:-ms-input-placeholder{color:#656b7c}.cdx-notify__input::placeholder{color:#656b7c}.cdx-notify__input:focus:-ms-input-placeholder{color:rgba(101,107,124,.3)}.cdx-notify__input:focus::placeholder{color:rgba(101,107,124,.3)}.cdx-notify__button{border:none;border-radius:3px;font-size:13px;padding:5px 10px;cursor:pointer}.cdx-notify__button:last-child{margin-left:10px}.cdx-notify__button--cancel{background:#f2f5f7;box-shadow:0 2px 1px 0 rgba(16,19,29,0);color:#656b7c}.cdx-notify__button--cancel:hover{background:#eee}.cdx-notify__button--confirm{background:#34c992;box-shadow:0 1px 1px 0 rgba(18,49,35,.05);color:#fff}.cdx-notify__button--confirm:hover{background:#33b082}.cdx-notify__btns-wrapper{display:-ms-flexbox;display:flex;-ms-flex-flow:row nowrap;flex-flow:row nowrap;margin-top:5px}.cdx-notify__cross{position:absolute;top:5px;right:5px;width:10px;height:10px;padding:5px;opacity:.54;cursor:pointer}.cdx-notify__cross::after,.cdx-notify__cross::before{content:\'\';position:absolute;left:9px;top:5px;height:12px;width:2px;background:#575d67}.cdx-notify__cross::before{transform:rotate(-45deg)}.cdx-notify__cross::after{transform:rotate(45deg)}.cdx-notify__cross:hover{opacity:1}.cdx-notifies{position:fixed;z-index:2;bottom:20px;left:20px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif}.cdx-notify{position:relative;width:220px;margin-top:15px;padding:13px 16px;background:#fff;box-shadow:0 11px 17px 0 rgba(23,32,61,.13);border-radius:5px;font-size:14px;line-height:1.4em;word-wrap:break-word}.cdx-notify::before{content:\'\';position:absolute;display:block;top:0;left:0;width:3px;height:calc(100% - 6px);margin:3px;border-radius:5px;background:0 0}@keyframes bounceIn{0%{opacity:0;transform:scale(.3)}50%{opacity:1;transform:scale(1.05)}70%{transform:scale(.9)}100%{transform:scale(1)}}.cdx-notify--bounce-in{animation-name:bounceIn;animation-duration:.6s;animation-iteration-count:1}.cdx-notify--success{background:#fafffe!important}.cdx-notify--success::before{background:#41ffb1!important}',""])},function(e,t){e.exports=function(i){var s=[];return s.toString=function(){return this.map(function(e){n=e[1]||"";var t,n,o,r=(o=e[3])?(i&&"function"==typeof btoa?(t="/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */",r=o.sources.map(function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"}),[n].concat(r).concat([t])):[n]).join("\n"):n;return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},s.i=function(e,t){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(n[r]=!0)}for(o=0;o<e.length;o++){var i=e[o];"number"==typeof i[0]&&n[i[0]]||(t&&!i[2]?i[2]=t:t&&(i[2]="("+i[2]+") and ("+t+")"),s.push(i))}},s}},function(e,t,n){var o,r,i,l={},s=(o=function(){return window&&document&&document.all&&!window.atob},i={},function(e){if("function"==typeof e)return e();if(void 0===i[e]){var t=function(e){return document.querySelector(e)}.call(this,e);if(window.HTMLIFrameElement&&t instanceof window.HTMLIFrameElement)try{t=t.contentDocument.head}catch(e){t=null}i[e]=t}return i[e]}),a=null,c=0,u=[],d=n(5);function h(e,t){for(var n=0;n<e.length;n++){var o=e[n],r=l[o.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](o.parts[i]);for(;i<o.parts.length;i++)r.parts.push(k(o.parts[i],t))}else{for(var s=[],i=0;i<o.parts.length;i++)s.push(k(o.parts[i],t));l[o.id]={id:o.id,refs:1,parts:s}}}}function p(e,t){for(var n=[],o={},r=0;r<e.length;r++){var i=e[r],s=t.base?i[0]+t.base:i[0],i={css:i[1],media:i[2],sourceMap:i[3]};o[s]?o[s].parts.push(i):n.push(o[s]={id:s,parts:[i]})}return n}function f(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var o=u[u.length-1];if("top"===e.insertAt)o?o.nextSibling?n.insertBefore(t,o.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),u.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=_typeof(e.insertAt)||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");o=s(e.insertInto+" "+e.insertAt.before);n.insertBefore(t,o)}}function g(e){null!==e.parentNode&&(e.parentNode.removeChild(e),0<=(e=u.indexOf(e)))&&u.splice(e,1)}function v(e){var t=document.createElement("style");return void 0===e.attrs.type&&(e.attrs.type="text/css"),m(t,e.attrs),f(e,t),t}function m(t,n){Object.keys(n).forEach(function(e){t.setAttribute(e,n[e])})}function k(t,e){var n,o,r,i,s;if(e.transform&&t.css){if(!(i=e.transform(t.css)))return function(){};t.css=i}return r=e.singleton?(i=c++,n=a=a||v(e),o=w.bind(null,n,i,!1),w.bind(null,n,i,!0)):t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=e,s=document.createElement("link"),void 0===i.attrs.type&&(i.attrs.type="text/css"),i.attrs.rel="stylesheet",m(s,i.attrs),f(i,s),n=s,o=function(e,t,n){var o=n.css,n=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&n,t=((t.convertToAbsoluteUrls||r)&&(o=d(o)),n&&(o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */"),new Blob([o],{type:"text/css"})),r=e.href;e.href=URL.createObjectURL(t),r&&URL.revokeObjectURL(r)}.bind(null,n,e),function(){g(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(e),o=function(e,t){var n=t.css,t=t.media;if(t&&e.setAttribute("media",t),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}.bind(null,n),function(){g(n)}),o(t),function(e){e?e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap||o(t=e):r()}}e.exports=function(e,s){if(("undefined"==typeof DEBUG?"undefined":_typeof(DEBUG))<"u"&&DEBUG&&"object"!=("undefined"==typeof document?"undefined":_typeof(document)))throw new Error("The style-loader cannot be used in a non-browser environment");(s=s||{}).attrs="object"==_typeof(s.attrs)?s.attrs:{},s.singleton||"boolean"==typeof s.singleton||(s.singleton=function(){return r=void 0===r?o.apply(this,arguments):r}()),s.insertInto||(s.insertInto="head"),s.insertAt||(s.insertAt="bottom");var a=p(e,s);return h(a,s),function(e){for(var t,n=[],o=0;o<a.length;o++){var r=a[o];(t=l[r.id]).refs--,n.push(t)}for(e&&h(p(e,s),s),o=0;o<n.length;o++)if(0===(t=n[o]).refs){for(var i=0;i<t.parts.length;i++)t.parts[i]();delete l[t.id]}}};b=[];var b,y=function(e,t){return b[e]=t,b.filter(Boolean).join("\n")};function w(e,t,n,o){var n=n?"":o.css;e.styleSheet?e.styleSheet.cssText=y(t,n):(o=document.createTextNode(n),(n=e.childNodes)[t]&&e.removeChild(n[t]),n.length?e.insertBefore(o,n[t]):e.appendChild(o))}},function(e,t){e.exports=function(e){var n,o,t=("undefined"==typeof window?"undefined":_typeof(window))<"u"&&window.location;if(t)return e&&"string"==typeof e?(n=t.protocol+"//"+t.host,o=n+t.pathname.replace(/\/[^\/]*$/,"/"),e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){t=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(t)?e:(e=0===t.indexOf("//")?t:0===t.indexOf("/")?n+t:o+t.replace(/^\.\//,""),"url("+JSON.stringify(e)+")")})):e;throw new Error("fixUrls requires window.location")}},function(e,t,n){var r,l,c,u,d,h;e.exports=(r="cdx-notify",l="cdx-notify__cross",c="cdx-notify__button--confirm",u="cdx-notify__button",d="cdx-notify__btns-wrapper",{alert:h=function(e){var t=document.createElement("DIV"),n=document.createElement("DIV"),o=e.message,e=e.style;return t.classList.add(r),e&&t.classList.add(r+"--"+e),t.innerHTML=o,n.classList.add(l),n.addEventListener("click",t.remove.bind(t)),t.appendChild(n),t},confirm:function(e){var t=h(e),n=document.createElement("div"),o=document.createElement("button"),r=document.createElement("button"),i=t.querySelector("."+l),s=e.cancelHandler,a=e.okHandler;return n.classList.add(d),o.innerHTML=e.okText||"Confirm",r.innerHTML=e.cancelText||"Cancel",o.classList.add(u),r.classList.add(u),o.classList.add(c),r.classList.add("cdx-notify__button--cancel"),s&&"function"==typeof s&&(r.addEventListener("click",s),i.addEventListener("click",s)),a&&"function"==typeof a&&o.addEventListener("click",a),o.addEventListener("click",t.remove.bind(t)),r.addEventListener("click",t.remove.bind(t)),n.appendChild(o),n.appendChild(r),t.appendChild(n),t},prompt:function(e){var t=h(e),n=document.createElement("div"),o=document.createElement("button"),r=document.createElement("input"),i=t.querySelector("."+l),s=e.cancelHandler,a=e.okHandler;return n.classList.add(d),o.innerHTML=e.okText||"Ok",o.classList.add(u),o.classList.add(c),r.classList.add("cdx-notify__input"),e.placeholder&&r.setAttribute("placeholder",e.placeholder),e.default&&(r.value=e.default),e.inputType&&(r.type=e.inputType),s&&"function"==typeof s&&i.addEventListener("click",s),a&&"function"==typeof a&&o.addEventListener("click",function(){a(r.value)}),o.addEventListener("click",t.remove.bind(t)),n.appendChild(r),n.appendChild(o),t.appendChild(n),t},getWrapper:function(){var e=document.createElement("DIV");return e.classList.add("cdx-notifies"),e}})}],fe={},r.m=pe,r.c=fe,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){("undefined"==typeof Symbol?"undefined":_typeof(Symbol))<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=0));var Ce,_e,Se=P(we),Ee=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"show",value:function(e){Se.show(e)}}]))(),xe=(()=>{function n(e){var t=e.config,e=e.eventsDispatcher;return _classCallCheck(this,n),(t=_callSuper(this,n,[{config:t,eventsDispatcher:e}])).notifier=new Ee,t}return _inherits(n,x),_createClass(n,[{key:"methods",get:function(){var t=this;return{show:function(e){return t.show(e)}}}},{key:"show",value:function(e){return this.notifier.show(e)}}])})(),Te=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var t=this;return{toggle:function(e){return t.toggle(e)},get isEnabled(){return t.isEnabled}}}},{key:"toggle",value:function(e){return this.Editor.ReadOnly.toggle(e)}},{key:"isEnabled",get:function(){return this.Editor.ReadOnly.isEnabled}}])})(),Be={},Ie={get exports(){return Be},set exports(e){Be=e}};function Ae(e){var t=e.tags;if(!Object.keys(t).map(function(e){return _typeof(t[e])}).every(function(e){return"object"===e||"boolean"===e||"function"===e}))throw new Error("The configuration was invalid");this.config=e}function Le(e){return-1!==Ce.indexOf(e.nodeName)}Ie.exports=(Ce=["P","LI","TD","TH","DIV","H1","H2","H3","H4","H5","H6","PRE"],_e=["A","B","STRONG","I","EM","SUB","SUP","U","STRIKE"],Ae.prototype.clean=function(e){var t=document.implementation.createHTMLDocument(),n=t.createElement("div");return n.innerHTML=e,this._sanitize(t,n),n.innerHTML},Ae.prototype._sanitize=function(e,t){var n,o,r,i,s,a,l=e.createTreeWalker(t,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT,null,!1),c=l.firstChild();if(c)do{if(c.nodeType===Node.TEXT_NODE){if(""===c.data.trim()&&(c.previousElementSibling&&Le(c.previousElementSibling)||c.nextElementSibling&&Le(c.nextElementSibling))){t.removeChild(c),this._sanitize(e,t);break}}else{if(c.nodeType===Node.COMMENT_NODE){t.removeChild(c),this._sanitize(e,t);break}d=c;var u,d=-1!==_e.indexOf(d.nodeName),h=(d&&(u=Array.prototype.some.call(c.childNodes,Le)),!!t.parentNode),h=Le(t)&&Le(c)&&h,p=c.nodeName.toLowerCase(),f=(s=this.config,p=p,a=c,"function"==typeof s.tags[p]?s.tags[p](a):s.tags[p]);if(d&&u||"u"<_typeof(a=f)||"boolean"==typeof a&&!a||!this.config.keepNestedBlockElements&&h){if("SCRIPT"!==c.nodeName&&"STYLE"!==c.nodeName)for(;0<c.childNodes.length;)t.insertBefore(c.childNodes[0],c);t.removeChild(c),this._sanitize(e,t);break}for(var g=0;g<c.attributes.length;g+=1){var v=c.attributes[g];o=f,r=c,i=void 0,i=(n=v).name.toLowerCase(),!0!==o&&("function"==typeof o[i]?!o[i](n.value,r):"u"<_typeof(o[i])||!1===o[i]||"string"==typeof o[i]&&o[i]!==n.value)&&(c.removeAttribute(v.name),g-=1)}this._sanitize(e,c)}}while(c=l.nextSibling())},Ae);var Me=Be;function Oe(e,n){return e.map(function(e){var t=p(n)?n(e.tool):n;return v(t)||(e.data=Re(e.data,t)),e})}function E(e,t){return new Me({tags:1<arguments.length&&void 0!==t?t:{}}).clean(e)}function Re(e,t){{if(Array.isArray(e))return c=t,e.map(function(e){return Re(e,c)});if(f(e)){var n=e,o=t,r,i,s,a={};for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i=n[r],s=(e=>f(e)||(e=>"boolean"===h(e))(e)||p(e))(o[r])?o[r]:o,a[r]=Re(i,s));return a}return g(e)?(l=e,f(t=t)?E(l,t):!1===t?E(l,{}):l):e}var l,c}var Ie=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var n=this;return{clean:function(e,t){return n.clean(e,t)}}}},{key:"clean",value:function(e,t){return E(e,t)}}])})(),Ne=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var e=this;return{save:function(){return e.save()}}}},{key:"save",value:function(){var e="Editor's content can not be saved in read-only mode";return this.Editor.ReadOnly.isEnabled?(d(e,"warn"),Promise.reject(new Error(e))):this.Editor.Saver.save()}}])})(),Pe=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var n=this;return{findParentTag:function(e,t){return n.findParentTag(e,t)},expandToTag:function(e){return n.expandToTag(e)}}}},{key:"findParentTag",value:function(e,t){return(new C).findParentTag(e,t)}},{key:"expandToTag",value:function(e){(new C).expandToTag(e)}}])})(),De=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"classes",get:function(){return{block:"cdx-block",inlineToolButton:"ce-inline-tool",inlineToolButtonActive:"ce-inline-tool--active",input:"cdx-input",loader:"cdx-loader",button:"cdx-button",settingsButton:"cdx-settings-button",settingsButtonActive:"cdx-settings-button--active"}}}])})(),je=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){var t=this;return{close:function(){return t.close()},open:function(){return t.open()},toggleBlockSettings:function(e){return t.toggleBlockSettings(e)},toggleToolbox:function(e){return t.toggleToolbox(e)}}}},{key:"open",value:function(){this.Editor.Toolbar.moveAndOpen()}},{key:"close",value:function(){this.Editor.Toolbar.close()}},{key:"toggleBlockSettings",value:function(e){-1===this.Editor.BlockManager.currentBlockIndex?d("Could't toggle the Toolbar because there is no block selected ","warn"):(null!=e?e:!this.Editor.BlockSettings.opened)?(this.Editor.Toolbar.moveAndOpen(),this.Editor.BlockSettings.open()):this.Editor.BlockSettings.close()}},{key:"toggleToolbox",value:function(e){-1===this.Editor.BlockManager.currentBlockIndex?d("Could't toggle the Toolbox because there is no block selected ","warn"):(null!=e?e:!this.Editor.Toolbar.toolbox.opened)?(this.Editor.Toolbar.moveAndOpen(),this.Editor.Toolbar.toolbox.open()):this.Editor.Toolbar.toolbox.close()}}])})(),Fe={},He={get exports(){return Fe},set exports(e){Fe=e}},ze=(window,He.exports=(n=>{var o={};function r(e){var t;return(o[e]||(t=o[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}return r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){("undefined"==typeof Symbol?"undefined":_typeof(Symbol))<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)})([function(e,t,n){e.exports=n(1)},function(e,t,n){n.r(t),n.d(t,"default",function(){return o});var o=(()=>_createClass(function e(){var t=this;_classCallCheck(this,e),this.nodes={wrapper:null,content:null},this.showed=!1,this.offsetTop=10,this.offsetLeft=10,this.offsetRight=10,this.hidingDelay=0,this.handleWindowScroll=function(){t.showed&&t.hide(!0)},this.loadStyles(),this.prepare(),window.addEventListener("scroll",this.handleWindowScroll,{passive:!0})},[{key:"CSS",get:function(){return{tooltip:"ct",tooltipContent:"ct__content",tooltipShown:"ct--shown",placement:{left:"ct--left",bottom:"ct--bottom",right:"ct--right",top:"ct--top"}}}},{key:"show",value:function(e,t,n){var o=this,r=(this.nodes.wrapper||this.prepare(),this.hidingTimeout&&clearTimeout(this.hidingTimeout),Object.assign({placement:"bottom",marginTop:0,marginLeft:0,marginRight:0,marginBottom:0,delay:70,hidingDelay:0},n));if(r.hidingDelay&&(this.hidingDelay=r.hidingDelay),this.nodes.content.innerHTML="","string"==typeof t)this.nodes.content.appendChild(document.createTextNode(t));else{if(!(t instanceof Node))throw Error("[CodeX Tooltip] Wrong type of «content» passed. It should be an instance of Node or String. But "+_typeof(t)+" given.");this.nodes.content.appendChild(t)}switch((n=this.nodes.wrapper.classList).remove.apply(n,_toConsumableArray(Object.values(this.CSS.placement))),r.placement){case"top":this.placeTop(e,r);break;case"left":this.placeLeft(e,r);break;case"right":this.placeRight(e,r);break;default:this.placeBottom(e,r)}r&&r.delay?this.showingTimeout=setTimeout(function(){o.nodes.wrapper.classList.add(o.CSS.tooltipShown),o.showed=!0},r.delay):(this.nodes.wrapper.classList.add(this.CSS.tooltipShown),this.showed=!0)}},{key:"hide",value:function(){var e=this;!this.hidingDelay||0<arguments.length&&void 0!==arguments[0]&&arguments[0]?(this.nodes.wrapper.classList.remove(this.CSS.tooltipShown),this.showed=!1,this.showingTimeout&&clearTimeout(this.showingTimeout)):(this.hidingTimeout&&clearTimeout(this.hidingTimeout),this.hidingTimeout=setTimeout(function(){e.hide(!0)},this.hidingDelay))}},{key:"onHover",value:function(e,t,n){var o=this;e.addEventListener("mouseenter",function(){o.show(e,t,n)}),e.addEventListener("mouseleave",function(){o.hide()})}},{key:"destroy",value:function(){this.nodes.wrapper.remove(),window.removeEventListener("scroll",this.handleWindowScroll)}},{key:"prepare",value:function(){this.nodes.wrapper=this.make("div",this.CSS.tooltip),this.nodes.content=this.make("div",this.CSS.tooltipContent),this.append(this.nodes.wrapper,this.nodes.content),this.append(document.body,this.nodes.wrapper)}},{key:"loadStyles",value:function(){var e,t="codex-tooltips-style";document.getElementById(t)||(e=n(2),e=this.make("style",null,{textContent:e.toString(),id:t}),this.prepend(document.head,e))}},{key:"placeBottom",value:function(e,t){var n=e.getBoundingClientRect(),e=n.left+e.clientWidth/2-this.nodes.wrapper.offsetWidth/2,n=n.bottom+window.pageYOffset+this.offsetTop+t.marginTop;this.applyPlacement("bottom",e,n)}},{key:"placeTop",value:function(e,t){var n=e.getBoundingClientRect(),e=n.left+e.clientWidth/2-this.nodes.wrapper.offsetWidth/2,n=n.top+window.pageYOffset-this.nodes.wrapper.clientHeight-this.offsetTop;this.applyPlacement("top",e,n)}},{key:"placeLeft",value:function(e,t){var n=e.getBoundingClientRect(),t=n.left-this.nodes.wrapper.offsetWidth-this.offsetLeft-t.marginLeft,n=n.top+window.pageYOffset+e.clientHeight/2-this.nodes.wrapper.offsetHeight/2;this.applyPlacement("left",t,n)}},{key:"placeRight",value:function(e,t){var n=e.getBoundingClientRect(),t=n.right+this.offsetRight+t.marginRight,n=n.top+window.pageYOffset+e.clientHeight/2-this.nodes.wrapper.offsetHeight/2;this.applyPlacement("right",t,n)}},{key:"applyPlacement",value:function(e,t,n){this.nodes.wrapper.classList.add(this.CSS.placement[e]),this.nodes.wrapper.style.left=t+"px",this.nodes.wrapper.style.top=n+"px"}},{key:"make",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement(e);for(t in Array.isArray(n)?(e=r.classList).add.apply(e,_toConsumableArray(n)):n&&r.classList.add(n),o)o.hasOwnProperty(t)&&(r[t]=o[t]);return r}},{key:"append",value:function(t,e){Array.isArray(e)?e.forEach(function(e){return t.appendChild(e)}):t.appendChild(e)}},{key:"prepend",value:function(t,e){Array.isArray(e)?(e=e.reverse()).forEach(function(e){return t.prepend(e)}):t.prepend(e)}}]))()},function(e,t){e.exports='.ct{z-index:999;opacity:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;pointer-events:none;-webkit-transition:opacity 50ms ease-in,-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,transform 70ms cubic-bezier(.215,.61,.355,1);transition:opacity 50ms ease-in,transform 70ms cubic-bezier(.215,.61,.355,1),-webkit-transform 70ms cubic-bezier(.215,.61,.355,1);will-change:opacity,top,left;-webkit-box-shadow:0 8px 12px 0 rgba(29,32,43,.17),0 4px 5px -3px rgba(5,6,12,.49);box-shadow:0 8px 12px 0 rgba(29,32,43,.17),0 4px 5px -3px rgba(5,6,12,.49);border-radius:9px}.ct,.ct:before{position:absolute;top:0;left:0}.ct:before{content:"";bottom:0;right:0;background-color:#1d202b;z-index:-1;border-radius:4px}@supports(-webkit-mask-box-image:url("")){.ct:before{border-radius:0;-webkit-mask-box-image:url(\'data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M10.71 0h2.58c3.02 0 4.64.42 6.1 1.2a8.18 8.18 0 013.4 3.4C23.6 6.07 24 7.7 24 10.71v2.58c0 3.02-.42 4.64-1.2 6.1a8.18 8.18 0 01-3.4 3.4c-1.47.8-3.1 1.21-6.11 1.21H10.7c-3.02 0-4.64-.42-6.1-1.2a8.18 8.18 0 01-3.4-3.4C.4 17.93 0 16.3 0 13.29V10.7c0-3.02.42-4.64 1.2-6.1a8.18 8.18 0 013.4-3.4C6.07.4 7.7 0 10.71 0z"/></svg>\') 48% 41% 37.9% 53.3%}}@media (--mobile){.ct{display:none}}.ct__content{padding:6px 10px;color:#cdd1e0;font-size:12px;text-align:center;letter-spacing:.02em;line-height:1em}.ct:after{content:"";width:8px;height:8px;position:absolute;background-color:#1d202b;z-index:-1}.ct--bottom{-webkit-transform:translateY(5px);transform:translateY(5px)}.ct--bottom:after{top:-3px;left:50%;-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg)}.ct--top{-webkit-transform:translateY(-5px);transform:translateY(-5px)}.ct--top:after{top:auto;bottom:-3px;left:50%;-webkit-transform:translateX(-50%) rotate(-45deg);transform:translateX(-50%) rotate(-45deg)}.ct--left{-webkit-transform:translateX(-5px);transform:translateX(-5px)}.ct--left:after{top:50%;left:auto;right:0;-webkit-transform:translate(41.6%,-50%) rotate(-45deg);transform:translate(41.6%,-50%) rotate(-45deg)}.ct--right{-webkit-transform:translateX(5px);transform:translateX(5px)}.ct--right:after{top:50%;left:0;-webkit-transform:translate(-41.6%,-50%) rotate(-45deg);transform:translate(-41.6%,-50%) rotate(-45deg)}.ct--shown{opacity:1;-webkit-transform:none;transform:none}'}]).default,P(Fe)),i=null;function Ue(){i=i||new ze}function Ge(e){e=0<arguments.length&&void 0!==e&&e;Ue(),null!=i&&i.hide(e)}function qe(e,t,n){Ue(),null!=i&&i.onHover(e,t,n)}var He=(()=>{function n(e){var t=e.config,e=e.eventsDispatcher;return _classCallCheck(this,n),_callSuper(this,n,[{config:t,eventsDispatcher:e}])}return _inherits(n,x),_createClass(n,[{key:"methods",get:function(){var o=this;return{show:function(e,t,n){return o.show(e,t,n)},hide:function(){return o.hide()},onHover:function(e,t,n){return o.onHover(e,t,n)}}}},{key:"show",value:function(e,t,n){e=e,t=t,n=n,Ue(),null!=i&&i.show(e,t,n)}},{key:"hide",value:function(){Ge()}},{key:"onHover",value:function(e,t,n){qe(e,t,n)}}])})(),Ke=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"methods",get:function(){return{nodes:this.editorNodes}}},{key:"editorNodes",get:function(){return{wrapper:this.Editor.UI.nodes.wrapper,redactor:this.Editor.UI.nodes.redactor}}}])})();var T=function o(e,r){var i={};return Object.entries(e).forEach(function(e){var t,n=(e=_slicedToArray(e,2))[0];f(e=e[1])?(t=r?"".concat(r,".").concat(n):n,Object.values(e).every(g)?i[n]=t:i[n]=o(e,t)):i[n]=e}),i}(t);for(var We,Ye='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7 10L11.8586 14.8586C11.9367 14.9367 12.0633 14.9367 12.1414 14.8586L17 10"/></svg>',Ve='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7.69998 12.6L7.67896 12.62C6.53993 13.7048 6.52012 15.5155 7.63516 16.625V16.625C8.72293 17.7073 10.4799 17.7102 11.5712 16.6314L13.0263 15.193C14.0703 14.1609 14.2141 12.525 13.3662 11.3266L13.22 11.12"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16.22 11.12L16.3564 10.9805C17.2895 10.0265 17.3478 8.5207 16.4914 7.49733V7.49733C15.5691 6.39509 13.9269 6.25143 12.8271 7.17675L11.3901 8.38588C10.0935 9.47674 9.95706 11.4241 11.0888 12.6852L11.12 12.72"/></svg>',Xe=(()=>{function n(e){var t=this;_classCallCheck(this,n),this.nodes={root:null,icon:null},this.confirmationState=null,this.removeSpecialFocusBehavior=function(){t.nodes.root.classList.remove(n.CSS.noFocus)},this.removeSpecialHoverBehavior=function(){t.nodes.root.classList.remove(n.CSS.noHover)},this.onErrorAnimationEnd=function(){t.nodes.icon.classList.remove(n.CSS.wobbleAnimation),t.nodes.icon.removeEventListener("animationend",t.onErrorAnimationEnd)},this.params=e,this.nodes.root=this.make(e)}return _createClass(n,[{key:"isDisabled",get:function(){return this.params.isDisabled}},{key:"toggle",get:function(){return this.params.toggle}},{key:"title",get:function(){return this.params.title}},{key:"closeOnActivate",get:function(){return this.params.closeOnActivate}},{key:"isConfirmationStateEnabled",get:function(){return null!==this.confirmationState}},{key:"isFocused",get:function(){return this.nodes.root.classList.contains(n.CSS.focused)}},{key:"getElement",value:function(){return this.nodes.root}},{key:"handleClick",value:function(){this.isConfirmationStateEnabled?this.activateOrEnableConfirmationMode(this.confirmationState):this.activateOrEnableConfirmationMode(this.params)}},{key:"toggleActive",value:function(e){this.nodes.root.classList.toggle(n.CSS.active,e)}},{key:"toggleHidden",value:function(e){this.nodes.root.classList.toggle(n.CSS.hidden,e)}},{key:"reset",value:function(){this.isConfirmationStateEnabled&&this.disableConfirmationMode()}},{key:"onFocus",value:function(){this.disableSpecialHoverAndFocusBehavior()}},{key:"make",value:function(e){var t=b.make("div",n.CSS.container);return e.name&&(t.dataset.itemName=e.name),this.nodes.icon=b.make("div",n.CSS.icon,{innerHTML:e.icon||'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><circle cx="12" cy="12" r="4" stroke="currentColor" stroke-width="2"/></svg>'}),t.appendChild(this.nodes.icon),t.appendChild(b.make("div",n.CSS.title,{innerHTML:e.title||""})),e.secondaryLabel&&t.appendChild(b.make("div",n.CSS.secondaryTitle,{textContent:e.secondaryLabel})),e.isActive&&t.classList.add(n.CSS.active),e.isDisabled&&t.classList.add(n.CSS.disabled),t}},{key:"enableConfirmationMode",value:function(e){var t=_objectSpread(_objectSpread(_objectSpread({},this.params),e),{},{confirmation:e.confirmation}),t=this.make(t);this.nodes.root.innerHTML=t.innerHTML,this.nodes.root.classList.add(n.CSS.confirmationState),this.confirmationState=e,this.enableSpecialHoverAndFocusBehavior()}},{key:"disableConfirmationMode",value:function(){var e=this.make(this.params);this.nodes.root.innerHTML=e.innerHTML,this.nodes.root.classList.remove(n.CSS.confirmationState),this.confirmationState=null,this.disableSpecialHoverAndFocusBehavior()}},{key:"enableSpecialHoverAndFocusBehavior",value:function(){this.nodes.root.classList.add(n.CSS.noHover),this.nodes.root.classList.add(n.CSS.noFocus),this.nodes.root.addEventListener("mouseleave",this.removeSpecialHoverBehavior,{once:!0})}},{key:"disableSpecialHoverAndFocusBehavior",value:function(){this.removeSpecialFocusBehavior(),this.removeSpecialHoverBehavior(),this.nodes.root.removeEventListener("mouseleave",this.removeSpecialHoverBehavior)}},{key:"activateOrEnableConfirmationMode",value:function(e){if(void 0===e.confirmation)try{e.onActivate(e),this.disableConfirmationMode()}catch(e){this.animateError()}else this.enableConfirmationMode(e.confirmation)}},{key:"animateError",value:function(){this.nodes.icon.classList.contains(n.CSS.wobbleAnimation)||(this.nodes.icon.classList.add(n.CSS.wobbleAnimation),this.nodes.icon.addEventListener("animationend",this.onErrorAnimationEnd))}}],[{key:"CSS",get:function(){return{container:"ce-popover-item",title:"ce-popover-item__title",secondaryTitle:"ce-popover-item__secondary-title",icon:"ce-popover-item__icon",active:"ce-popover-item--active",disabled:"ce-popover-item--disabled",focused:"ce-popover-item--focused",hidden:"ce-popover-item--hidden",confirmationState:"ce-popover-item--confirmation",noHover:"ce-popover-item--no-hover",noFocus:"ce-popover-item--no-focus",wobbleAnimation:"wobble"}}}])})(),Ze=(()=>_createClass(function e(t,n){_classCallCheck(this,e),this.cursor=-1,this.items=[],this.items=t||[],this.focusedCssClass=n},[{key:"currentItem",get:function(){return-1===this.cursor?null:this.items[this.cursor]}},{key:"setCursor",value:function(e){e<this.items.length&&-1<=e&&(this.dropCursor(),this.cursor=e,this.items[this.cursor].classList.add(this.focusedCssClass))}},{key:"setItems",value:function(e){this.items=e}},{key:"next",value:function(){this.cursor=this.leafNodesAndReturnIndex(Ze.directions.RIGHT)}},{key:"previous",value:function(){this.cursor=this.leafNodesAndReturnIndex(Ze.directions.LEFT)}},{key:"dropCursor",value:function(){-1!==this.cursor&&(this.items[this.cursor].classList.remove(this.focusedCssClass),this.cursor=-1)}},{key:"leafNodesAndReturnIndex",value:function(e){var t,n=this;return 0===this.items.length?this.cursor:(-1===(t=this.cursor)?t=e===Ze.directions.RIGHT?-1:0:this.items[t].classList.remove(this.focusedCssClass),t=e===Ze.directions.RIGHT?(t+1)%this.items.length:(this.items.length+t-1)%this.items.length,b.canSetCaret(this.items[t])&&Q(function(){return C.setCursor(n.items[t])},50)(),this.items[t].classList.add(this.focusedCssClass),t)}}]))(),B=Ze,I=(B.directions={RIGHT:"right",LEFT:"left"},(()=>{function n(e){var t=this;_classCallCheck(this,n),this.iterator=null,this.activated=!1,this.flipCallbacks=[],this.onKeyDown=function(e){if(t.isEventReadyForHandling(e))switch(n.usedKeys.includes(e.keyCode)&&e.preventDefault(),e.keyCode){case s:t.handleTabPress(e);break;case U:case l:t.flipLeft();break;case G:case c:t.flipRight();break;case a:t.handleEnterPress(e)}},this.iterator=new B(e.items,e.focusedItemClass),this.activateCallback=e.activateCallback,this.allowedKeys=e.allowedKeys||n.usedKeys}return _createClass(n,[{key:"isActivated",get:function(){return this.activated}},{key:"activate",value:function(e,t){this.activated=!0,e&&this.iterator.setItems(e),void 0!==t&&this.iterator.setCursor(t),document.addEventListener("keydown",this.onKeyDown,!0)}},{key:"deactivate",value:function(){this.activated=!1,this.dropCursor(),document.removeEventListener("keydown",this.onKeyDown)}},{key:"focusFirst",value:function(){this.dropCursor(),this.flipRight()}},{key:"flipLeft",value:function(){this.iterator.previous(),this.flipCallback()}},{key:"flipRight",value:function(){this.iterator.next(),this.flipCallback()}},{key:"hasFocus",value:function(){return!!this.iterator.currentItem}},{key:"onFlip",value:function(e){this.flipCallbacks.push(e)}},{key:"removeOnFlip",value:function(t){this.flipCallbacks=this.flipCallbacks.filter(function(e){return e!==t})}},{key:"dropCursor",value:function(){this.iterator.dropCursor()}},{key:"isEventReadyForHandling",value:function(e){return this.activated&&this.allowedKeys.includes(e.keyCode)}},{key:"handleTabPress",value:function(e){switch(e.shiftKey?B.directions.LEFT:B.directions.RIGHT){case B.directions.RIGHT:this.flipRight();break;case B.directions.LEFT:this.flipLeft()}}},{key:"handleEnterPress",value:function(e){this.activated&&(this.iterator.currentItem&&(e.stopPropagation(),e.preventDefault(),this.iterator.currentItem.click()),p(this.activateCallback))&&this.activateCallback(this.iterator.currentItem)}},{key:"flipCallback",value:function(){this.iterator.currentItem&&this.iterator.currentItem.scrollIntoViewIfNeeded(),this.flipCallbacks.forEach(function(e){return e()})}}],[{key:"usedKeys",get:function(){return[s,U,G,a,l,c]}}])})()),$e=(()=>{function o(e){var t=e.items,n=e.onSearch,e=e.placeholder;_classCallCheck(this,o),this.listeners=new ae,this.items=t,this.onSearch=n,this.render(e)}return _createClass(o,[{key:"getElement",value:function(){return this.wrapper}},{key:"focus",value:function(){this.input.focus()}},{key:"clear",value:function(){this.input.value="",this.searchQuery="",this.onSearch("",this.foundItems)}},{key:"destroy",value:function(){this.listeners.removeAll()}},{key:"render",value:function(e){var t=this,n=(this.wrapper=b.make("div",o.CSS.wrapper),b.make("div",o.CSS.icon,{innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><circle cx="10.5" cy="10.5" r="5.5" stroke="currentColor" stroke-width="2"/><line x1="15.4142" x2="19" y1="15" y2="18.5858" stroke="currentColor" stroke-linecap="round" stroke-width="2"/></svg>'}));this.input=b.make("input",o.CSS.input,{placeholder:e,tabIndex:-1}),this.wrapper.appendChild(n),this.wrapper.appendChild(this.input),this.listeners.on(this.input,"input",function(){t.searchQuery=t.input.value,t.onSearch(t.searchQuery,t.foundItems)})}},{key:"foundItems",get:function(){var t=this;return this.items.filter(function(e){return t.checkItem(e)})}},{key:"checkItem",value:function(e){var e=(null==(e=e.title)?void 0:e.toLowerCase())||"",t=this.searchQuery.toLowerCase();return e.includes(t)}}],[{key:"CSS",get:function(){return{wrapper:"cdx-search-field",icon:"cdx-search-field__icon",input:"cdx-search-field__input"}}}])})(),Qe=(()=>_createClass(function e(){_classCallCheck(this,e)},[{key:"lock",value:function(){re?this.lockHard():document.body.classList.add(Qe.CSS.scrollLocked)}},{key:"unlock",value:function(){re?this.unlockHard():document.body.classList.remove(Qe.CSS.scrollLocked)}},{key:"lockHard",value:function(){this.scrollPosition=window.pageYOffset,document.documentElement.style.setProperty("--window-scroll-offset","".concat(this.scrollPosition,"px")),document.body.classList.add(Qe.CSS.scrollLockedHard)}},{key:"unlockHard",value:function(){document.body.classList.remove(Qe.CSS.scrollLockedHard),null!==this.scrollPosition&&window.scrollTo(0,this.scrollPosition),this.scrollPosition=null}}]))(),Je=Qe,t=(Je.CSS={scrollLocked:"ce-scroll-locked",scrollLockedHard:"ce-scroll-locked--hard"},Object.defineProperty),et=Object.getOwnPropertyDescriptor,tt=((ct={}).Close="close",ct),A=(()=>{function n(e){var t;return _classCallCheck(this,n),(t=_callSuper(this,n)).scopeElement=document.body,t.listeners=new ae,t.scrollLocker=new Je,t.nodes={wrapper:null,popover:null,nothingFoundMessage:null,customContent:null,items:null,overlay:null},t.messages={nothingFound:"Nothing found",search:"Search"},t.onFlip=function(){t.items.find(function(e){return e.isFocused}).onFocus()},t.items=e.items.map(function(e){return new Xe(e)}),void 0!==e.scopeElement&&(t.scopeElement=e.scopeElement),e.messages&&(t.messages=_objectSpread(_objectSpread({},t.messages),e.messages)),e.customContentFlippableItems&&(t.customContentFlippableItems=e.customContentFlippableItems),t.make(),e.customContent&&t.addCustomContent(e.customContent),e.searchable&&t.addSearch(),t.initializeFlipper(),t}return _inherits(n,se),_createClass(n,[{key:"getElement",value:function(){return this.nodes.wrapper}},{key:"hasFocus",value:function(){return this.flipper.hasFocus()}},{key:"show",value:function(){var t=this;this.shouldOpenBottom||(this.nodes.popover.style.setProperty("--popover-height",this.height+"px"),this.nodes.popover.classList.add(A.CSS.popoverOpenTop)),this.nodes.overlay.classList.remove(A.CSS.overlayHidden),this.nodes.popover.classList.add(A.CSS.popoverOpened),this.flipper.activate(this.flippableElements),void 0!==this.search&&requestAnimationFrame(function(){var e;null!=(e=t.search)&&e.focus()}),k()&&this.scrollLocker.lock()}},{key:"hide",value:function(){this.nodes.popover.classList.remove(A.CSS.popoverOpened),this.nodes.popover.classList.remove(A.CSS.popoverOpenTop),this.nodes.overlay.classList.add(A.CSS.overlayHidden),this.flipper.deactivate(),this.items.forEach(function(e){return e.reset()}),void 0!==this.search&&this.search.clear(),k()&&this.scrollLocker.unlock(),this.emit("close")}},{key:"destroy",value:function(){this.flipper.deactivate(),this.listeners.removeAll(),k()&&this.scrollLocker.unlock()}},{key:"make",value:function(){var t=this;this.nodes.popover=b.make("div",[A.CSS.popover]),this.nodes.nothingFoundMessage=b.make("div",[A.CSS.nothingFoundMessage],{textContent:this.messages.nothingFound}),this.nodes.popover.appendChild(this.nodes.nothingFoundMessage),this.nodes.items=b.make("div",[A.CSS.items]),this.items.forEach(function(e){t.nodes.items.appendChild(e.getElement())}),this.nodes.popover.appendChild(this.nodes.items),this.listeners.on(this.nodes.popover,"click",function(e){e=t.getTargetItem(e);void 0!==e&&t.handleItemClick(e)}),this.nodes.wrapper=b.make("div"),this.nodes.overlay=b.make("div",[A.CSS.overlay,A.CSS.overlayHidden]),this.listeners.on(this.nodes.overlay,"click",function(){t.hide()}),this.nodes.wrapper.appendChild(this.nodes.overlay),this.nodes.wrapper.appendChild(this.nodes.popover)}},{key:"addSearch",value:function(){var t=this,e=(this.search=new $e({items:this.items,placeholder:this.messages.search,onSearch:function(e,n){t.items.forEach(function(e){var t=!n.includes(e);e.toggleHidden(t)}),t.toggleNothingFoundMessage(0===n.length),t.toggleCustomContent(""!==e);e=""===e?t.flippableElements:n.map(function(e){return e.getElement()});t.flipper.isActivated&&(t.flipper.deactivate(),t.flipper.activate(e))}}),this.search.getElement());e.classList.add(A.CSS.search),this.nodes.popover.insertBefore(e,this.nodes.popover.firstChild)}},{key:"addCustomContent",value:function(e){this.nodes.customContent=e,this.nodes.customContent.classList.add(A.CSS.customContent),this.nodes.popover.insertBefore(e,this.nodes.popover.firstChild)}},{key:"getTargetItem",value:function(t){return this.items.find(function(e){return t.composedPath().includes(e.getElement())})}},{key:"handleItemClick",value:function(t){t.isDisabled||(this.items.filter(function(e){return e!==t}).forEach(function(e){return e.reset()}),t.handleClick(),this.toggleItemActivenessIfNeeded(t),t.closeOnActivate&&this.hide())}},{key:"initializeFlipper",value:function(){this.flipper=new I({items:this.flippableElements,focusedItemClass:Xe.CSS.focused,allowedKeys:[s,l,c,a]}),this.flipper.onFlip(this.onFlip)}},{key:"flippableElements",get:function(){var e=this.items.map(function(e){return e.getElement()});return(this.customContentFlippableItems||[]).concat(e)}},{key:"height",get:function(){var e,t;return null===this.nodes.popover?0:((t=this.nodes.popover.cloneNode(!0)).style.visibility="hidden",t.style.position="absolute",t.style.top="-1000px",t.classList.add(A.CSS.popoverOpened),document.body.appendChild(t),e=t.offsetHeight,t.remove(),e)}},{key:"shouldOpenBottom",get:function(){var e=this.nodes.popover.getBoundingClientRect(),t=this.scopeElement.getBoundingClientRect(),n=this.height,o=e.top+n,e=e.top-n,n=Math.min(window.innerHeight,t.bottom);return e<t.top||o<=n}},{key:"toggleNothingFoundMessage",value:function(e){this.nodes.nothingFoundMessage.classList.toggle(A.CSS.nothingFoundMessageDisplayed,e)}},{key:"toggleCustomContent",value:function(e){var t;null!=(t=this.nodes.customContent)&&t.classList.toggle(A.CSS.customContentHidden,e)}},{key:"toggleItemActivenessIfNeeded",value:function(t){var e;!0===t.toggle&&t.toggleActive(),"string"==typeof t.toggle&&(1===(e=this.items.filter(function(e){return e.toggle===t.toggle})).length?t.toggleActive():e.forEach(function(e){e.toggleActive(e===t)}))}}],[{key:"CSS",get:function(){return{popover:"ce-popover",popoverOpenTop:"ce-popover--open-top",popoverOpened:"ce-popover--opened",search:"ce-popover__search",nothingFoundMessage:"ce-popover__nothing-found-message",nothingFoundMessageDisplayed:"ce-popover__nothing-found-message--displayed",customContent:"ce-popover__custom-content",customContentHidden:"ce-popover__custom-content--hidden",items:"ce-popover__items",overlay:"ce-popover__overlay",overlayHidden:"ce-popover__overlay--hidden"}}}])})(),nt=A,ot=[e],rt=nt.prototype,it="height",st=1,L=1<st?void 0:st?et(rt,it):rt,at=ot.length-1;0<=at;at--)(We=ot[at])&&(L=(st?We(rt,it,L):We(L))||L);st&&L&&t(rt,it,L);function lt(e,t,n,o){for(var r,i=1<o?void 0:o?pt(t,n):t,s=e.length-1;0<=s;s--)(r=e[s])&&(i=(o?r(t,n,i):r(i))||i);o&&i&&ht(t,n,i)}var ct=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).opened=!1,e.selection=new C,e.onPopoverClose=function(){e.close()},e}return _inherits(t,x),_createClass(t,[{key:"events",get:function(){return{opened:"block-settings-opened",closed:"block-settings-closed"}}},{key:"CSS",get:function(){return{settings:"ce-settings"}}},{key:"flipper",get:function(){var e;return null==(e=this.popover)?void 0:e.flipper}},{key:"make",value:function(){this.nodes.wrapper=b.make("div",[this.CSS.settings])}},{key:"destroy",value:function(){this.removeAllNodes()}},{key:"open",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.Editor.BlockManager.currentBlock;this.opened=!0,this.selection.save(),this.Editor.BlockSelection.selectBlock(e),this.Editor.BlockSelection.clearCache();var e=_slicedToArray(e.getTunes(),2),n=e[0],e=e[1];this.eventsDispatcher.emit(this.events.opened),this.popover=new nt({searchable:!0,items:n.map(function(e){return t.resolveTuneAliases(e)}),customContent:e,customContentFlippableItems:this.getControls(e),scopeElement:this.Editor.API.methods.ui.nodes.redactor,messages:{nothingFound:y.ui(T.ui.popover,"Nothing found"),search:y.ui(T.ui.popover,"Filter")}}),this.popover.on(tt.Close,this.onPopoverClose),this.nodes.wrapper.append(this.popover.getElement()),this.popover.show()}},{key:"getElement",value:function(){return this.nodes.wrapper}},{key:"close",value:function(){this.opened&&(this.opened=!1,C.isAtEditor||this.selection.restore(),this.selection.clearSaved(),!this.Editor.CrossBlockSelection.isCrossBlockSelectionStarted&&this.Editor.BlockManager.currentBlock&&this.Editor.BlockSelection.unselectBlock(this.Editor.BlockManager.currentBlock),this.eventsDispatcher.emit(this.events.closed),this.popover)&&(this.popover.off(tt.Close,this.onPopoverClose),this.popover.destroy(),this.popover.getElement().remove(),this.popover=null)}},{key:"getControls",value:function(e){var t=this.Editor.StylesAPI,e=e.querySelectorAll(".".concat(t.classes.settingsButton,", ").concat(b.allInputsSelector));return Array.from(e)}},{key:"resolveTuneAliases",value:function(e){n=e,o={label:"title"},r={},Object.keys(n).forEach(function(e){var t=o[e];void 0!==t?r[t]=n[e]:r[e]=n[e]});var n,o,r,t=r;return e.confirmation&&(t.confirmation=this.resolveTuneAliases(e.confirmation)),t}}])})(),et=(()=>{function s(){var e;return _classCallCheck(this,s),(e=_callSuper(this,s,arguments)).opened=!1,e.tools=[],e.flipper=null,e.togglingCallback=null,e}return _inherits(s,x),_createClass(s,[{key:"make",value:function(){this.nodes.wrapper=b.make("div",[s.CSS.conversionToolbarWrapper].concat(_toConsumableArray(this.isRtl?[this.Editor.UI.CSS.editorRtlFix]:[]))),this.nodes.tools=b.make("div",s.CSS.conversionToolbarTools);var e=b.make("div",s.CSS.conversionToolbarLabel,{textContent:y.ui(T.ui.inlineToolbar.converter,"Convert to")});return this.addTools(),this.enableFlipper(),b.append(this.nodes.wrapper,e),b.append(this.nodes.wrapper,this.nodes.tools),this.nodes.wrapper}},{key:"destroy",value:function(){this.flipper&&(this.flipper.deactivate(),this.flipper=null),this.removeAllNodes()}},{key:"toggle",value:function(e){this.opened?this.close():this.open(),p(e)&&(this.togglingCallback=e)}},{key:"open",value:function(){var e=this;this.filterTools(),this.opened=!0,this.nodes.wrapper.classList.add(s.CSS.conversionToolbarShowed),window.requestAnimationFrame(function(){e.flipper.activate(e.tools.map(function(e){return e.button}).filter(function(e){return!e.classList.contains(s.CSS.conversionToolHidden)})),e.flipper.focusFirst(),p(e.togglingCallback)&&e.togglingCallback(!0)})}},{key:"close",value:function(){this.opened=!1,this.flipper.deactivate(),this.nodes.wrapper.classList.remove(s.CSS.conversionToolbarShowed),p(this.togglingCallback)&&this.togglingCallback(!1)}},{key:"hasTools",value:function(){return 1!==this.tools.length||this.tools[0].name!==this.config.defaultBlock}},{key:"replaceWithBlock",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o,r,i,s,a,l=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=this.Editor,r=o.BlockManager,i=o.BlockSelection,s=o.InlineToolbar,a=o.Caret,r.convert(this.Editor.BlockManager.currentBlock,t,n),i.clearSelection(),this.close(),s.close(),window.requestAnimationFrame(function(){a.setToBlock(l.Editor.BlockManager.currentBlock,a.positions.END)});case 2:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"addTools",value:function(){var o=this,e=this.Editor.Tools.blockTools;Array.from(e.entries()).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1],n=e.conversionConfig;n&&n.import&&null!=(n=e.toolbox)&&n.forEach(function(e){return o.addToolIfValid(t,e)})})}},{key:"addToolIfValid",value:function(e,t){!v(t)&&t.icon&&this.addTool(e,t)}},{key:"addTool",value:function(t,n){var o=this,e=b.make("div",[s.CSS.conversionTool]),r=b.make("div",[s.CSS.conversionToolIcon]),r=(e.dataset.tool=t,r.innerHTML=n.icon,b.append(e,r),b.append(e,b.text(y.t(T.toolNames,n.title||m(t)))),null==(r=this.Editor.Tools.blockTools.get(t))?void 0:r.shortcut);r&&(r=b.make("span",s.CSS.conversionToolSecondaryLabel,{innerText:ne(r)}),b.append(e,r)),b.append(this.nodes.tools,e),this.tools.push({name:t,button:e,toolboxItem:n}),this.listeners.on(e,"click",_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.replaceWithBlock(t,n.data);case 2:case"end":return e.stop()}},e)})))}},{key:"filterTools",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var o,r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(e,t){return e.icon===t.icon&&e.title===t.title},o=this.Editor.BlockManager.currentBlock,e.next=4,o.getActiveToolboxEntry();case 4:r=e.sent,this.tools.forEach(function(e){var t,n=!1;r&&(t=i(r,e.toolboxItem),n=e.button.dataset.tool===o.name&&t),e.button.hidden=n,e.button.classList.toggle(s.CSS.conversionToolHidden,n)});case 6:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"enableFlipper",value:function(){this.flipper=new I({focusedItemClass:s.CSS.conversionToolFocused})}}],[{key:"CSS",get:function(){return{conversionToolbarWrapper:"ce-conversion-toolbar",conversionToolbarShowed:"ce-conversion-toolbar--showed",conversionToolbarTools:"ce-conversion-toolbar__tools",conversionToolbarLabel:"ce-conversion-toolbar__label",conversionTool:"ce-conversion-tool",conversionToolHidden:"ce-conversion-tool--hidden",conversionToolIcon:"ce-conversion-tool__icon",conversionToolSecondaryLabel:"ce-conversion-tool__secondary-label",conversionToolFocused:"ce-conversion-tool--focused",conversionToolActive:"ce-conversion-tool--active"}}}]);var e,n})(),ut={},t={get exports(){return ut},set exports(e){ut=e}},dt=(window,t.exports=(n=>{var o={};function r(e){var t;return(o[e]||(t=o[e]={i:e,l:!1,exports:{}},n[e].call(t.exports,t,t.exports,r),t.l=!0,t)).exports}return r.m=n,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){("undefined"==typeof Symbol?"undefined":_typeof(Symbol))<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e||4&e&&"object"==_typeof(t)&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)})([function(e,t,n){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e,t,n){t&&o(e.prototype,t),n&&o(e,n)}function s(e){var t=this;if(!(this instanceof s))throw new TypeError("Cannot call a class as a function");this.commands={},this.keys={},this.name=e.name,this.parseShortcutName(e.name),this.element=e.on,this.callback=e.callback,this.executeShortcut=function(e){t.execute(e)},this.element.addEventListener("keydown",this.executeShortcut,!1)}n.r(t),r(s,null,[{key:"supportedCommands",get:function(){return{SHIFT:["SHIFT"],CMD:["CMD","CONTROL","COMMAND","WINDOWS","CTRL"],ALT:["ALT","OPTION"]}}},{key:"keyCodes",get:function(){return{0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,BACKSPACE:8,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,".":190}}}]),r(s,[{key:"parseShortcutName",value:function(e){e=e.split("+");for(var t,n=0;n<e.length;n++){e[n]=e[n].toUpperCase();var o,r=!1;for(o in s.supportedCommands)if(s.supportedCommands[o].includes(e[n])){r=this.commands[o]=!0;break}r||(this.keys[e[n]]=!0)}for(t in s.supportedCommands)this.commands[t]||(this.commands[t]=!1)}},{key:"execute",value:function(e){var t,n={CMD:e.ctrlKey||e.metaKey,SHIFT:e.shiftKey,ALT:e.altKey},o=!0;for(t in this.commands)this.commands[t]!==n[t]&&(o=!1);var r,i=!0;for(r in this.keys)i=i&&e.keyCode===s.keyCodes[r];o&&i&&this.callback(e)}},{key:"remove",value:function(){this.element.removeEventListener("keydown",this.executeShortcut)}}]),t.default=s}]).default,P(ut)),M=new((()=>_createClass(function e(){_classCallCheck(this,e),this.registeredShortcuts=new Map},[{key:"add",value:function(e){if(this.findShortcut(e.on,e.name))throw Error("Shortcut ".concat(e.name," is already registered for ").concat(e.on,". Please remove it before add a new handler."));var t=new dt({name:e.name,on:e.on,callback:e.handler}),n=this.registeredShortcuts.get(e.on)||[];this.registeredShortcuts.set(e.on,[].concat(_toConsumableArray(n),[t]))}},{key:"remove",value:function(e,t){var n=this.findShortcut(e,t);n&&(n.remove(),t=this.registeredShortcuts.get(e),this.registeredShortcuts.set(e,t.filter(function(e){return e!==n})))}},{key:"findShortcut",value:function(e,t){return(this.registeredShortcuts.get(e)||[]).find(function(e){return e.name===t})}}]))()),ht=Object.defineProperty,pt=Object.getOwnPropertyDescriptor,ft=((t={}).Opened="toolbox-opened",t.Closed="toolbox-closed",t.BlockAdded="toolbox-block-added",t),gt=(()=>{function r(e){var t,n=e.api,o=e.tools,e=e.i18nLabels;return _classCallCheck(this,r),(t=_callSuper(this,r)).opened=!1,t.nodes={toolbox:null},t.onPopoverClose=function(){t.opened=!1,t.emit("toolbox-closed")},t.api=n,t.tools=o,t.i18nLabels=e,t}return _inherits(r,se),_createClass(r,[{key:"isEmpty",get:function(){return 0===this.toolsToBeDisplayed.length}},{key:"make",value:function(){return this.popover=new nt({scopeElement:this.api.ui.nodes.redactor,searchable:!0,messages:{nothingFound:this.i18nLabels.nothingFound,search:this.i18nLabels.filter},items:this.toolboxItemsToBeDisplayed}),this.popover.on(tt.Close,this.onPopoverClose),this.enableShortcuts(),this.nodes.toolbox=this.popover.getElement(),this.nodes.toolbox.classList.add(gt.CSS.toolbox),this.nodes.toolbox}},{key:"hasFocus",value:function(){var e;return null==(e=this.popover)?void 0:e.hasFocus()}},{key:"destroy",value:function(){var e;_superPropGet(r,"destroy",this,3)([]),this.nodes&&this.nodes.toolbox&&(this.nodes.toolbox.remove(),this.nodes.toolbox=null),this.removeAllShortcuts(),null!=(e=this.popover)&&e.off(tt.Close,this.onPopoverClose)}},{key:"toolButtonActivated",value:function(e,t){this.insertNewBlock(e,t)}},{key:"open",value:function(){var e;this.isEmpty||(null!=(e=this.popover)&&e.show(),this.opened=!0,this.emit("toolbox-opened"))}},{key:"close",value:function(){var e;null!=(e=this.popover)&&e.hide(),this.opened=!1,this.emit("toolbox-closed")}},{key:"toggle",value:function(){this.opened?this.close():this.open()}},{key:"toolsToBeDisplayed",get:function(){var t=[];return this.tools.forEach(function(e){e.toolbox&&t.push(e)}),t}},{key:"toolboxItemsToBeDisplayed",get:function(){function o(e,t){return{icon:e.icon,title:y.t(T.toolNames,e.title||m(t.name)),name:t.name,onActivate:function(){n.toolButtonActivated(t.name,e.data)},secondaryLabel:t.shortcut?ne(t.shortcut):""}}var n=this;return this.toolsToBeDisplayed.reduce(function(t,n){return Array.isArray(n.toolbox)?n.toolbox.forEach(function(e){t.push(o(e,n))}):void 0!==n.toolbox&&t.push(o(n.toolbox,n)),t},[])}},{key:"enableShortcuts",value:function(){var n=this;this.toolsToBeDisplayed.forEach(function(e){var t=e.shortcut;t&&n.enableShortcutForTool(e.name,t)})}},{key:"enableShortcutForTool",value:function(n,e){var o=this;M.add({name:e,on:this.api.ui.nodes.redactor,handler:function(e){e.preventDefault();var t=o.api.blocks.getCurrentBlockIndex(),e=o.api.blocks.getBlockByIndex(t);if(e)try{return o.api.blocks.convert(e.id,n),void window.requestAnimationFrame(function(){o.api.caret.setToBlock(t,"end")})}catch(e){}o.insertNewBlock(n)}})}},{key:"removeAllShortcuts",value:function(){var t=this;this.toolsToBeDisplayed.forEach(function(e){e=e.shortcut;e&&M.remove(t.api.ui.nodes.redactor,e)})}},{key:"insertNewBlock",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o,r,i,s,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.api.blocks.getCurrentBlockIndex(),r=this.api.blocks.getBlockByIndex(o)){e.next=3;break}return e.abrupt("return");case 3:if(i=r.isEmpty?o:o+1,n)return e.next=7,this.api.blocks.composeBlockData(t);e.next=9;break;case 7:s=e.sent,s=Object.assign(s,n);case 9:(a=this.api.blocks.insert(t,s,void 0,i,void 0,r.isEmpty)).call(_.APPEND_CALLBACK),this.api.caret.setToBlock(i),this.emit("toolbox-block-added",{block:a}),this.api.toolbar.close();case 11:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})}],[{key:"CSS",get:function(){return{toolbox:"ce-toolbox"}}}]);var n})(),vt=gt,mt=(lt([e],vt.prototype,"toolsToBeDisplayed",1),lt([e],vt.prototype,"toolboxItemsToBeDisplayed",1),"block hovered");function kt(){return(kt=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=navigator.keyboard,e.t1=o,e.t1)return e.next=5,o.getLayoutMap();e.next=6;break;case 5:e.t1=e.sent.get(t);case 6:if(e.t0=e.t1,e.t0){e.next=9;break}e.t0=n;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},e)}))).apply(this,arguments)}var t=(()=>{function n(e){var t=e.config,e=e.eventsDispatcher;return _classCallCheck(this,n),(t=_callSuper(this,n,[{config:t,eventsDispatcher:e}])).toolboxInstance=null,t}return _inherits(n,x),_createClass(n,[{key:"CSS",get:function(){return{toolbar:"ce-toolbar",content:"ce-toolbar__content",actions:"ce-toolbar__actions",actionsOpened:"ce-toolbar__actions--opened",toolbarOpened:"ce-toolbar--opened",openedToolboxHolderModifier:"codex-editor--toolbox-opened",plusButton:"ce-toolbar__plus",plusButtonShortcut:"ce-toolbar__plus-shortcut",settingsToggler:"ce-toolbar__settings-btn",settingsTogglerHidden:"ce-toolbar__settings-btn--hidden"}}},{key:"opened",get:function(){return this.nodes.wrapper.classList.contains(this.CSS.toolbarOpened)}},{key:"toolbox",get:function(){var e,t=this;return{opened:null==(e=this.toolboxInstance)?void 0:e.opened,close:function(){var e;null!=(e=t.toolboxInstance)&&e.close()},open:function(){null===t.toolboxInstance?u("toolbox.open() called before initialization is finished","warn"):(t.Editor.BlockManager.currentBlock=t.hoveredBlock,t.toolboxInstance.open())},toggle:function(){null===t.toolboxInstance?u("toolbox.toggle() called before initialization is finished","warn"):t.toolboxInstance.toggle()},hasFocus:function(){var e;return null==(e=t.toolboxInstance)?void 0:e.hasFocus()}}}},{key:"blockActions",get:function(){var e=this;return{hide:function(){e.nodes.actions.classList.remove(e.CSS.actionsOpened)},show:function(){e.nodes.actions.classList.add(e.CSS.actionsOpened)}}}},{key:"blockTunesToggler",get:function(){var e=this;return{hide:function(){return e.nodes.settingsToggler.classList.add(e.CSS.settingsTogglerHidden)},show:function(){return e.nodes.settingsToggler.classList.remove(e.CSS.settingsTogglerHidden)}}}},{key:"toggleReadOnly",value:function(e){var t=this;e?(this.destroy(),this.Editor.BlockSettings.destroy(),this.disableModuleBindings()):window.requestIdleCallback(function(){t.drawUI(),t.enableModuleBindings()},{timeout:2e3})}},{key:"moveAndOpen",value:function(){var e,t,n,o,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.Editor.BlockManager.currentBlock;null===this.toolboxInstance?u("Can't open Toolbar since Editor initialization is not finished yet","warn"):(this.toolboxInstance.opened&&this.toolboxInstance.close(),this.Editor.BlockSettings.opened&&this.Editor.BlockSettings.close(),r&&(e=(this.hoveredBlock=r).holder,o=this.Editor.UI.isMobile,t=window.getComputedStyle(r.pluginsContent),t=parseInt(t.paddingTop,10),n=e.offsetHeight,o=o?e.offsetTop+n:e.offsetTop+t,this.nodes.wrapper.style.top="".concat(Math.floor(o),"px"),1===this.Editor.BlockManager.blocks.length&&r.isEmpty?this.blockTunesToggler.hide():this.blockTunesToggler.show(),this.open()))}},{key:"close",value:function(){var e;this.Editor.ReadOnly.isEnabled||(null!=(e=this.nodes.wrapper)&&e.classList.remove(this.CSS.toolbarOpened),this.blockActions.hide(),null!=(e=this.toolboxInstance)&&e.close(),this.Editor.BlockSettings.close(),this.reset())}},{key:"reset",value:function(){this.nodes.wrapper.style.top="unset"}},{key:"open",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.nodes.wrapper.classList.add(this.CSS.toolbarOpened),e?this.blockActions.show():this.blockActions.hide()}},{key:"make",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o,r=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.nodes.wrapper=b.make("div",this.CSS.toolbar),["content","actions"].forEach(function(e){r.nodes[e]=b.make("div",r.CSS[e])}),b.append(this.nodes.wrapper,this.nodes.content),b.append(this.nodes.content,this.nodes.actions),this.nodes.plusButton=b.make("div",this.CSS.plusButton,{innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 7V12M12 17V12M17 12H12M12 12H7"/></svg>'}),b.append(this.nodes.actions,this.nodes.plusButton),this.readOnlyMutableListeners.on(this.nodes.plusButton,"click",function(){Ge(!0),r.plusButtonClicked()},!1),(t=b.make("div")).appendChild(document.createTextNode(y.ui(T.ui.toolbar.toolbox,"Add"))),t.appendChild(b.make("div",this.CSS.plusButtonShortcut,{textContent:"/"})),qe(this.nodes.plusButton,t,{hidingDelay:400}),this.nodes.settingsToggler=b.make("span",this.CSS.settingsToggler,{innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.40999 7.29999H9.4"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 7.29999H14.59"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.30999 12H9.3"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 12H14.59"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M9.40999 16.7H9.4"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2.6" d="M14.6 16.7H14.59"/></svg>'}),b.append(this.nodes.actions,this.nodes.settingsToggler),t=b.make("div"),n=b.text(y.ui(T.ui.blockTunes.toggler,"Click to tune")),e.next=7,function(){return kt.apply(this,arguments)}("Slash","/");case 7:o=e.sent,t.appendChild(n),t.appendChild(b.make("div",this.CSS.plusButtonShortcut,{textContent:ne("CMD + ".concat(o))})),qe(this.nodes.settingsToggler,t,{hidingDelay:400}),b.append(this.nodes.actions,this.makeToolbox()),b.append(this.nodes.actions,this.Editor.BlockSettings.getElement()),b.append(this.Editor.UI.nodes.wrapper,this.nodes.wrapper);case 9:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"makeToolbox",value:function(){var o=this;return this.toolboxInstance=new vt({api:this.Editor.API.methods,tools:this.Editor.Tools.blockTools,i18nLabels:{filter:y.ui(T.ui.popover,"Filter"),nothingFound:y.ui(T.ui.popover,"Nothing found")}}),this.toolboxInstance.on(ft.Opened,function(){o.Editor.UI.nodes.wrapper.classList.add(o.CSS.openedToolboxHolderModifier)}),this.toolboxInstance.on(ft.Closed,function(){o.Editor.UI.nodes.wrapper.classList.remove(o.CSS.openedToolboxHolderModifier)}),this.toolboxInstance.on(ft.BlockAdded,function(e){var e=e.block,t=o.Editor,n=t.BlockManager,t=t.Caret,e=n.getBlockById(e.id);0===e.inputs.length&&(e===n.lastBlock?(n.insertAtEnd(),t.setToBlock(n.lastBlock)):t.setToBlock(n.nextBlock))}),this.toolboxInstance.make()}},{key:"plusButtonClicked",value:function(){var e;this.Editor.BlockManager.currentBlock=this.hoveredBlock,null!=(e=this.toolboxInstance)&&e.toggle()}},{key:"enableModuleBindings",value:function(){var n=this;this.readOnlyMutableListeners.on(this.nodes.settingsToggler,"mousedown",function(e){e.stopPropagation(),n.settingsTogglerClicked(),null!=(e=n.toolboxInstance)&&e.opened&&n.toolboxInstance.close(),Ge(!0)},!0),k()||this.eventsDispatcher.on(mt,function(e){var t;n.Editor.BlockSettings.opened||null!=(t=n.toolboxInstance)&&t.opened||n.moveAndOpen(e.block)})}},{key:"disableModuleBindings",value:function(){this.readOnlyMutableListeners.clearAll()}},{key:"settingsTogglerClicked",value:function(){this.Editor.BlockManager.currentBlock=this.hoveredBlock,this.Editor.BlockSettings.opened?this.Editor.BlockSettings.close():this.Editor.BlockSettings.open(this.hoveredBlock)}},{key:"drawUI",value:function(){this.Editor.BlockSettings.make(),this.make()}},{key:"destroy",value:function(){this.removeAllNodes(),this.toolboxInstance&&this.toolboxInstance.destroy()}}]);var e})(),bt=((O={})[O.Block=0]="Block",O[O.Inline=1]="Inline",O[O.Tune=2]="Tune",O),yt=((O={}).Shortcut="shortcut",O.Toolbox="toolbox",O.EnabledInlineTools="inlineToolbar",O.EnabledBlockTunes="tunes",O.Config="config",O),wt=((O={}).Shortcut="shortcut",O.SanitizeConfig="sanitize",O),xt=((O={}).IsEnabledLineBreaks="enableLineBreaks",O.Toolbox="toolbox",O.ConversionConfig="conversionConfig",O.IsReadOnlySupported="isReadOnlySupported",O.PasteConfig="pasteConfig",O),Ct=((O={}).IsInline="isInline",O.Title="title",O),_t=((O={}).IsTune="isTune",O),St=(()=>_createClass(function e(t){var n=t.name,o=t.constructable,r=t.config,i=t.api,s=t.isDefault,a=t.isInternal,a=void 0!==a&&a,t=t.defaultPlaceholder;_classCallCheck(this,e),this.api=i,this.name=n,this.constructable=o,this.config=r,this.isDefault=s,this.isInternal=a,this.defaultPlaceholder=t},[{key:"settings",get:function(){var e=this.config.config||{};return!this.isDefault||"placeholder"in e||!this.defaultPlaceholder||(e.placeholder=this.defaultPlaceholder),e}},{key:"reset",value:function(){if(p(this.constructable.reset))return this.constructable.reset()}},{key:"prepare",value:function(){if(p(this.constructable.prepare))return this.constructable.prepare({toolName:this.name,config:this.settings})}},{key:"shortcut",get:function(){var e=this.constructable.shortcut;return this.config.shortcut||e}},{key:"sanitizeConfig",get:function(){return this.constructable.sanitize||{}}},{key:"isInline",value:function(){return 1===this.type}},{key:"isBlock",value:function(){return 0===this.type}},{key:"isTune",value:function(){return 2===this.type}}]))(),O=(()=>{function n(e){var t=e.config,e=e.eventsDispatcher;return _classCallCheck(this,n),(t=_callSuper(this,n,[{config:t,eventsDispatcher:e}])).CSS={inlineToolbar:"ce-inline-toolbar",inlineToolbarShowed:"ce-inline-toolbar--showed",inlineToolbarLeftOriented:"ce-inline-toolbar--left-oriented",inlineToolbarRightOriented:"ce-inline-toolbar--right-oriented",inlineToolbarShortcut:"ce-inline-toolbar__shortcut",buttonsWrapper:"ce-inline-toolbar__buttons",actionsWrapper:"ce-inline-toolbar__actions",inlineToolButton:"ce-inline-tool",inputField:"cdx-input",focusedButton:"ce-inline-tool--focused",conversionToggler:"ce-inline-toolbar__dropdown",conversionTogglerArrow:"ce-inline-toolbar__dropdown-arrow",conversionTogglerHidden:"ce-inline-toolbar__dropdown--hidden",conversionTogglerContent:"ce-inline-toolbar__dropdown-content",togglerAndButtonsWrapper:"ce-inline-toolbar__toggler-and-button-wrapper"},t.opened=!1,t.toolbarVerticalMargin=k()?20:6,t.buttonsList=null,t.width=0,t.flipper=null,t}return _inherits(n,x),_createClass(n,[{key:"toggleReadOnly",value:function(e){var t=this;e?(this.destroy(),this.Editor.ConversionToolbar.destroy()):window.requestIdleCallback(function(){t.make()},{timeout:2e3})}},{key:"tryToShow",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(1<n.length&&void 0!==n[1])||n[1],0<n.length&&void 0!==n[0]&&n[0]&&this.close(),e.t0=this.allowedToShow(),e.t0)return e.next=7,this.addToolsFiltered(t);e.next=10;break;case 7:this.move(),this.open(t),this.Editor.Toolbar.close();case 10:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"close",value:function(){var n=this;this.opened&&!this.Editor.ReadOnly.isEnabled&&(this.nodes.wrapper.classList.remove(this.CSS.inlineToolbarShowed),Array.from(this.toolsInstances.entries()).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1],t=n.getToolShortcut(t);t&&M.remove(n.Editor.UI.nodes.redactor,t),p(e.clear)&&e.clear()}),this.reset(),this.opened=!1,this.flipper.deactivate(),this.Editor.ConversionToolbar.close())}},{key:"containsNode",value:function(e){return void 0!==this.nodes.wrapper&&this.nodes.wrapper.contains(e)}},{key:"destroy",value:function(){this.flipper&&(this.flipper.deactivate(),this.flipper=null),this.removeAllNodes()}},{key:"make",value:function(){var t=this;this.nodes.wrapper=b.make("div",[this.CSS.inlineToolbar].concat(_toConsumableArray(this.isRtl?[this.Editor.UI.CSS.editorRtlFix]:[]))),this.nodes.togglerAndButtonsWrapper=b.make("div",this.CSS.togglerAndButtonsWrapper),this.nodes.buttons=b.make("div",this.CSS.buttonsWrapper),this.nodes.actions=b.make("div",this.CSS.actionsWrapper),this.listeners.on(this.nodes.wrapper,"mousedown",function(e){e.target.closest(".".concat(t.CSS.actionsWrapper))||e.preventDefault()}),b.append(this.nodes.wrapper,[this.nodes.togglerAndButtonsWrapper,this.nodes.actions]),b.append(this.Editor.UI.nodes.wrapper,this.nodes.wrapper),this.addConversionToggler(),b.append(this.nodes.togglerAndButtonsWrapper,this.nodes.buttons),this.prepareConversionToolbar(),window.requestAnimationFrame(function(){t.recalculateWidth()}),this.enableFlipper()}},{key:"open",value:function(){var e;this.opened||(this.nodes.wrapper.classList.add(this.CSS.inlineToolbarShowed),this.buttonsList=this.nodes.buttons.querySelectorAll(".".concat(this.CSS.inlineToolButton)),this.opened=!0,(e=Array.from(this.buttonsList)).unshift(this.nodes.conversionToggler),e=e.filter(function(e){return!e.hidden}),this.flipper.activate(e))}},{key:"move",value:function(){var e=C.rect,t=this.Editor.UI.nodes.wrapper.getBoundingClientRect(),e={x:e.x-t.x,y:e.y+e.height-t.top+this.toolbarVerticalMargin};e.x+this.width+t.x>this.Editor.UI.contentRect.right&&(e.x=this.Editor.UI.contentRect.right-this.width-t.x),this.nodes.wrapper.style.left=Math.floor(e.x)+"px",this.nodes.wrapper.style.top=Math.floor(e.y)+"px"}},{key:"reset",value:function(){this.nodes.wrapper.classList.remove(this.CSS.inlineToolbarLeftOriented,this.CSS.inlineToolbarRightOriented),this.nodes.wrapper.style.left="0",this.nodes.wrapper.style.top="0"}},{key:"allowedToShow",value:function(){var e=C.get(),t=C.text;return!(!e||!e.anchorNode||e.isCollapsed||t.length<1||(t=b.isElement(e.anchorNode)?e.anchorNode:e.anchorNode.parentElement,e&&["IMG","INPUT"].includes(t.tagName))||null===t.closest('[contenteditable="true"]')||!(t=this.Editor.BlockManager.getBlock(e.anchorNode))||0===t.tool.inlineTools.size)}},{key:"recalculateWidth",value:function(){this.width=this.nodes.wrapper.offsetWidth}},{key:"addConversionToggler",value:function(){var t=this,e=(this.nodes.conversionToggler=b.make("div",this.CSS.conversionToggler),this.nodes.conversionTogglerContent=b.make("div",this.CSS.conversionTogglerContent),b.make("div",this.CSS.conversionTogglerArrow,{innerHTML:Ye}));this.nodes.conversionToggler.appendChild(this.nodes.conversionTogglerContent),this.nodes.conversionToggler.appendChild(e),this.nodes.togglerAndButtonsWrapper.appendChild(this.nodes.conversionToggler),this.listeners.on(this.nodes.conversionToggler,"click",function(){t.Editor.ConversionToolbar.toggle(function(e){!e&&t.opened?t.flipper.activate():t.opened&&t.flipper.deactivate()})}),!1===k()&&qe(this.nodes.conversionToggler,y.ui(T.ui.inlineToolbar.converter,"Convert to"),{placement:"top",hidingDelay:100})}},{key:"setConversionTogglerContent",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Editor.BlockManager,t=t.currentBlock,n=t.name,o=t.tool.conversionConfig,o=o&&o.export,this.nodes.conversionToggler.hidden=!o,this.nodes.conversionToggler.classList.toggle(this.CSS.conversionTogglerHidden,!o),e.next=4,t.getActiveToolboxEntry();case 4:if(e.t0=e.sent,e.t0){e.next=7;break}e.t0={};case 7:o=e.t0,this.nodes.conversionTogglerContent.innerHTML=o.icon||o.title||m(n);case 9:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"prepareConversionToolbar",value:function(){var e=this.Editor.ConversionToolbar.make();b.append(this.nodes.wrapper,e)}},{key:"addToolsFiltered",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o=this,r=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(0<r.length&&void 0!==r[0])||r[0],n=C.get(),n=this.Editor.BlockManager.getBlock(n.anchorNode),this.nodes.buttons.innerHTML="",this.nodes.actions.innerHTML="",this.toolsInstances=new Map,Array.from(n.tool.inlineTools.values()).forEach(function(e){o.addTool(e)}),t&&this.Editor.ConversionToolbar.hasTools())return e.next=9,this.setConversionTogglerContent();e.next=11;break;case 9:e.next=12;break;case 11:this.nodes.conversionToggler.hidden=!0;case 12:this.recalculateWidth();case 13:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"addTool",value:function(e){var t=this,n=e.create(),o=n.render();if(o){o.dataset.tool=e.name,this.nodes.buttons.appendChild(o),this.toolsInstances.set(e.name,n),p(n.renderActions)&&(r=n.renderActions(),this.nodes.actions.appendChild(r)),this.listeners.on(o,"click",function(e){t.toolClicked(n),e.preventDefault()});var r=this.getToolShortcut(e.name);if(r)try{this.enableShortcuts(n,r)}catch(e){}var i=b.make("div"),s=y.t(T.toolNames,e.title||m(e.name));i.appendChild(b.text(s)),r&&i.appendChild(b.make("div",this.CSS.inlineToolbarShortcut,{textContent:ne(r)})),!1===k()&&qe(o,i,{placement:"top",hidingDelay:100}),n.checkState(C.get())}else u("Render method must return an instance of Node","warn",e.name)}},{key:"getToolShortcut",value:function(e){var t=this.Editor.Tools,n=t.inlineTools.get(e),t=t.internal.inlineTools;return Array.from(t.keys()).includes(e)?this.inlineTools[e][wt.Shortcut]:n.shortcut}},{key:"enableShortcuts",value:function(n,e){var o=this;M.add({name:e,handler:function(e){var t=o.Editor.BlockManager.currentBlock;t&&t.tool.enabledInlineTools&&(e.preventDefault(),o.toolClicked(n))},on:this.Editor.UI.nodes.redactor})}},{key:"toolClicked",value:function(e){var t=C.range;e.surround(t),this.checkToolsState(),void 0!==e.renderActions&&this.flipper.deactivate()}},{key:"checkToolsState",value:function(){this.toolsInstances.forEach(function(e){e.checkState(C.get())})}},{key:"inlineTools",get:function(){var n={};return Array.from(this.Editor.Tools.inlineTools.entries()).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];n[t]=e.create()}),n}},{key:"enableFlipper",value:function(){this.flipper=new I({focusedItemClass:this.CSS.focusedButton,allowedKeys:[a,s]})}}]);var e,t,o})(),Et=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"keydown",value:function(e){switch(this.beforeKeydownProcessing(e),e.keyCode){case H:this.backspace(e);break;case q:this.delete(e);break;case a:this.enter(e);break;case c:case G:this.arrowRightAndDown(e);break;case l:case U:this.arrowLeftAndUp(e);break;case s:this.tabPressed(e)}"/"!==e.key||e.ctrlKey||e.metaKey||this.slashPressed(),"Slash"===e.code&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.commandSlashPressed())}},{key:"beforeKeydownProcessing",value:function(e){this.needToolbarClosing(e)&&X(e.keyCode)&&(this.Editor.Toolbar.close(),this.Editor.ConversionToolbar.close(),e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||this.Editor.BlockSelection.clearSelection(e))}},{key:"keyup",value:function(e){e.shiftKey||this.Editor.UI.checkEmptiness()}},{key:"dragOver",value:function(e){this.Editor.BlockManager.getBlockByChildNode(e.target).dropTarget=!0}},{key:"dragLeave",value:function(e){this.Editor.BlockManager.getBlockByChildNode(e.target).dropTarget=!1}},{key:"handleCommandC",value:function(e){var t=this.Editor.BlockSelection;t.anyBlockSelected&&t.copySelectedBlocks(e)}},{key:"handleCommandX",value:function(t){var e=this.Editor,n=e.BlockSelection,o=e.BlockManager,r=e.Caret;n.anyBlockSelected&&n.copySelectedBlocks(t).then(function(){var e=o.removeSelectedBlocks(),e=o.insertDefaultBlockAtIndex(e,!0);r.setToBlock(e,r.positions.START),n.clearSelection(t)})}},{key:"tabPressed",value:function(e){var t=this.Editor,n=t.InlineToolbar,o=t.Caret;t.ConversionToolbar.opened||n.opened||(e.shiftKey?o.navigatePrevious(!0):o.navigateNext(!0))&&e.preventDefault()}},{key:"commandSlashPressed",value:function(){1<this.Editor.BlockSelection.selectedBlocks.length||this.activateBlockSettings()}},{key:"slashPressed",value:function(){this.Editor.BlockManager.currentBlock.isEmpty&&this.activateToolbox()}},{key:"enter",value:function(e){var t=this.Editor,n=t.BlockManager,t=t.UI;n.currentBlock.tool.isLineBreaksEnabled||t.someToolbarOpened&&t.someFlipperButtonFocused||e.shiftKey||(n=this.Editor.BlockManager.currentBlock,this.Editor.Caret.isAtStart&&!this.Editor.BlockManager.currentBlock.hasMedia?this.Editor.BlockManager.insertDefaultBlockAtIndex(this.Editor.BlockManager.currentBlockIndex):n=this.Editor.Caret.isAtEnd?this.Editor.BlockManager.insertDefaultBlockAtIndex(this.Editor.BlockManager.currentBlockIndex+1):this.Editor.BlockManager.split(),this.Editor.Caret.setToBlock(n),this.Editor.Toolbar.moveAndOpen(n),e.preventDefault())}},{key:"backspace",value:function(e){var t=this.Editor,n=t.BlockManager,t=t.Caret,o=n.currentBlock,r=n.previousBlock;C.isCollapsed&&t.isAtStart&&(e.preventDefault(),this.Editor.Toolbar.close(),o.currentInput!==o.firstInput?t.navigatePrevious():null!==r&&(r.isEmpty?n.removeBlock(r):o.isEmpty?(n.removeBlock(o),e=n.currentBlock,t.setToBlock(e,t.positions.END)):he(o,r)?this.mergeBlocks(r,o):t.setToBlock(r,t.positions.END)))}},{key:"delete",value:function(e){var t=this.Editor,n=t.BlockManager,t=t.Caret,o=n.currentBlock,r=n.nextBlock;C.isCollapsed&&t.isAtEnd&&(e.preventDefault(),this.Editor.Toolbar.close(),o.currentInput!==o.lastInput?t.navigateNext():null!==r&&(r.isEmpty?n.removeBlock(r):o.isEmpty?(n.removeBlock(o),t.setToBlock(r,t.positions.START)):he(o,r)?this.mergeBlocks(o,r):t.setToBlock(r,t.positions.START)))}},{key:"mergeBlocks",value:function(e,t){var n=this.Editor,o=n.BlockManager,r=n.Caret,i=n.Toolbar;r.createShadow(e.pluginsContent),o.mergeBlocks(e,t).then(function(){window.requestAnimationFrame(function(){r.restoreCaret(e.pluginsContent),e.pluginsContent.normalize(),i.close()})})}},{key:"arrowRightAndDown",value:function(e){var t=this,n=I.usedKeys.includes(e.keyCode)&&(!e.shiftKey||e.keyCode===s);this.Editor.UI.someToolbarOpened&&n||(this.Editor.Toolbar.close(),n=this.Editor.Caret.isAtEnd||this.Editor.BlockSelection.anyBlockSelected,e.shiftKey&&e.keyCode===c&&n?this.Editor.CrossBlockSelection.toggleBlockSelectedState():(e.keyCode===c||e.keyCode===G&&!this.isRtl?this.Editor.Caret.navigateNext():this.Editor.Caret.navigatePrevious())?e.preventDefault():(Q(function(){t.Editor.BlockManager.currentBlock&&t.Editor.BlockManager.currentBlock.updateCurrentInput()},20)(),this.Editor.BlockSelection.clearSelection(e)))}},{key:"arrowLeftAndUp",value:function(e){var t=this;if(this.Editor.UI.someToolbarOpened){if(I.usedKeys.includes(e.keyCode)&&(!e.shiftKey||e.keyCode===s))return;this.Editor.UI.closeAllToolbars()}this.Editor.Toolbar.close();var n=this.Editor.Caret.isAtStart||this.Editor.BlockSelection.anyBlockSelected;e.shiftKey&&e.keyCode===l&&n?this.Editor.CrossBlockSelection.toggleBlockSelectedState(!1):(e.keyCode===l||e.keyCode===U&&!this.isRtl?this.Editor.Caret.navigatePrevious():this.Editor.Caret.navigateNext())?e.preventDefault():(Q(function(){t.Editor.BlockManager.currentBlock&&t.Editor.BlockManager.currentBlock.updateCurrentInput()},20)(),this.Editor.BlockSelection.clearSelection(e))}},{key:"needToolbarClosing",value:function(e){var t=e.keyCode===a&&this.Editor.Toolbar.toolbox.opened,n=e.keyCode===a&&this.Editor.BlockSettings.opened,o=e.keyCode===a&&this.Editor.InlineToolbar.opened,r=e.keyCode===a&&this.Editor.ConversionToolbar.opened,i=e.keyCode===s;return!(e.shiftKey||i||t||n||o||r)}},{key:"activateToolbox",value:function(){this.Editor.Toolbar.opened||this.Editor.Toolbar.moveAndOpen(),this.Editor.Toolbar.toolbox.open()}},{key:"activateBlockSettings",value:function(){this.Editor.Toolbar.opened||this.Editor.Toolbar.moveAndOpen(),this.Editor.BlockSettings.opened||this.Editor.BlockSettings.open()}}])})(),Tt=(()=>_createClass(function e(t){_classCallCheck(this,e),this.blocks=[],this.workingArea=t},[{key:"length",get:function(){return this.blocks.length}},{key:"array",get:function(){return this.blocks}},{key:"nodes",get:function(){return $(this.workingArea.children)}},{key:"push",value:function(e){this.blocks.push(e),this.insertToDOM(e)}},{key:"swap",value:function(e,t){var n=this.blocks[t];b.swap(this.blocks[e].holder,n.holder),this.blocks[t]=this.blocks[e],this.blocks[e]=n}},{key:"move",value:function(e,t){var n=this.blocks.splice(t,1)[0],o=Math.max(0,e-1),o=this.blocks[o],o=(0<e?this.insertToDOM(n,"afterend",o):this.insertToDOM(n,"beforebegin",o),this.blocks.splice(e,0,n),this.composeBlockEvent("move",{fromIndex:t,toIndex:e}));n.call(_.MOVED,o)}},{key:"insert",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];this.length?(e>this.length&&(e=this.length),n&&(this.blocks[e].holder.remove(),this.blocks[e].call(_.REMOVED)),this.blocks.splice(e,n?1:0,t),0<e?(n=this.blocks[e-1],this.insertToDOM(t,"afterend",n)):(n=this.blocks[e+1])?this.insertToDOM(t,"beforebegin",n):this.insertToDOM(t)):this.push(t)}},{key:"replace",value:function(e,t){if(void 0===this.blocks[e])throw Error("Incorrect index");this.blocks[e].holder.replaceWith(t.holder),this.blocks[e]=t}},{key:"insertMany",value:function(e,t){var n,o,r=new DocumentFragment,i=_createForOfIteratorHelper(e);try{for(i.s();!(n=i.n()).done;){var s=n.value;r.appendChild(s.holder)}}catch(e){i.e(e)}finally{i.f()}0<this.length?(0<t?(o=Math.min(t-1,this.length-1),this.blocks[o].holder.after(r)):0===t&&this.workingArea.prepend(r),(o=this.blocks).splice.apply(o,[t,0].concat(_toConsumableArray(e)))):((o=this.blocks).push.apply(o,_toConsumableArray(e)),this.workingArea.appendChild(r)),e.forEach(function(e){return e.call(_.RENDERED)})}},{key:"remove",value:function(e){isNaN(e)&&(e=this.length-1),this.blocks[e].holder.remove(),this.blocks[e].call(_.REMOVED),this.blocks.splice(e,1)}},{key:"removeAll",value:function(){this.workingArea.innerHTML="",this.blocks.forEach(function(e){return e.call(_.REMOVED)}),this.blocks.length=0}},{key:"insertAfter",value:function(e,t){e=this.blocks.indexOf(e);this.insert(e+1,t)}},{key:"get",value:function(e){return this.blocks[e]}},{key:"indexOf",value:function(e){return this.blocks.indexOf(e)}},{key:"insertToDOM",value:function(e,t,n){t?n.holder.insertAdjacentElement(t,e.holder):this.workingArea.appendChild(e.holder),e.call(_.RENDERED)}},{key:"composeBlockEvent",value:function(e,t){return new CustomEvent(e,{detail:t})}}],[{key:"set",value:function(e,t,n){return isNaN(Number(t))?Reflect.set(e,t,n):e.insert(+t,n),!0}},{key:"get",value:function(e,t){return isNaN(Number(t))?Reflect.get(e,t):e.get(+t)}}]))(),Bt="block-removed",It="block-added",At="block-changed",Lt=(()=>_createClass(function e(){_classCallCheck(this,e),this.completed=Promise.resolve()},[{key:"add",value:function(n){var o=this;return new Promise(function(e,t){o.completed=o.completed.then(n).then(e).catch(t)})}}]))(),Mt=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments))._currentBlockIndex=-1,e._blocks=null,e}return _inherits(t,x),_createClass(t,[{key:"currentBlockIndex",get:function(){return this._currentBlockIndex},set:function(e){this._currentBlockIndex=e}},{key:"firstBlock",get:function(){return this._blocks[0]}},{key:"lastBlock",get:function(){return this._blocks[this._blocks.length-1]}},{key:"currentBlock",get:function(){return this._blocks[this.currentBlockIndex]},set:function(e){this.currentBlockIndex=this.getBlockIndex(e)}},{key:"nextBlock",get:function(){return this.currentBlockIndex===this._blocks.length-1?null:this._blocks[this.currentBlockIndex+1]}},{key:"nextContentfulBlock",get:function(){return this.blocks.slice(this.currentBlockIndex+1).find(function(e){return!!e.inputs.length})}},{key:"previousContentfulBlock",get:function(){return this.blocks.slice(0,this.currentBlockIndex).reverse().find(function(e){return!!e.inputs.length})}},{key:"previousBlock",get:function(){return 0===this.currentBlockIndex?null:this._blocks[this.currentBlockIndex-1]}},{key:"blocks",get:function(){return this._blocks.array}},{key:"isEditorEmpty",get:function(){return this.blocks.every(function(e){return e.isEmpty})}},{key:"prepare",value:function(){var t=this,e=new Tt(this.Editor.UI.nodes.redactor);this._blocks=new Proxy(e,{set:Tt.set,get:Tt.get}),this.listeners.on(document,"copy",function(e){return t.Editor.BlockEvents.handleCommandC(e)})}},{key:"toggleReadOnly",value:function(e){e?this.disableModuleBindings():this.enableModuleBindings()}},{key:"composeBlock",value:function(e){var t=this,n=e.tool,o=e.data,o=void 0===o?{}:o,r=e.id,r=void 0===r?void 0:r,e=e.tunes,e=void 0===e?{}:e,i=this.Editor.ReadOnly.isEnabled,n=this.Editor.Tools.blockTools.get(n),s=new S({id:r,data:o,tool:n,api:this.Editor.API,readOnly:i,tunesData:e},this.eventsDispatcher);return i||window.requestIdleCallback(function(){t.bindBlockEvents(s)},{timeout:2e3}),s}},{key:"insert",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,n=e.tool,n=void 0===n?this.config.defaultBlock:n,o=e.data,r=e.needToFocus,r=void 0===r||r,i=e.replace,i=void 0!==i&&i,s=e.tunes,e=e.index,t=(void 0===e&&(e=this.currentBlockIndex+(i?0:1)),this.composeBlock({id:void 0===t?void 0:t,tool:n,data:void 0===o?{}:o,tunes:void 0===s?{}:s}));return i&&this.blockDidMutated(Bt,this.getBlockByIndex(e),{index:e}),this._blocks.insert(e,t,i),this.blockDidMutated(It,t,{index:e}),r?this.currentBlockIndex=e:e<=this.currentBlockIndex&&this.currentBlockIndex++,t}},{key:"insertMany",value:function(e){this._blocks.insertMany(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0)}},{key:"update",value:(i=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data;case 2:return o=e.sent,o=this.composeBlock({id:t.id,tool:t.name,data:Object.assign({},o,n),tunes:t.tunes}),r=this.getBlockIndex(t),e.abrupt("return",(this._blocks.replace(r,o),this.blockDidMutated(At,o,{index:r}),o));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"replace",value:function(e,t,n){e=this.getBlockIndex(e);this.insert({tool:t,data:n,index:e,replace:!0})}},{key:"paste",value:function(t,e){var n=this.insert({tool:t,replace:2<arguments.length&&void 0!==arguments[2]&&arguments[2]});try{window.requestIdleCallback(function(){n.call(_.ON_PASTE,e)})}catch(e){u("".concat(t,": onPaste callback call is failed"),"error",e)}return n}},{key:"insertDefaultBlockAtIndex",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.composeBlock({tool:this.config.defaultBlock});return this._blocks[e]=n,this.blockDidMutated(It,n,{index:e}),t?this.currentBlockIndex=e:e<=this.currentBlockIndex&&this.currentBlockIndex++,n}},{key:"insertAtEnd",value:function(){return this.currentBlockIndex=this.blocks.length-1,this.insert()}},{key:"mergeBlocks",value:(r=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.data;case 2:if(o=e.sent,e.t0=v(o),e.t0){e.next=7;break}return e.next=7,t.mergeWith(o);case 7:this.removeBlock(n),this.currentBlockIndex=this._blocks.indexOf(t);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"removeBlock",value:function(n){var o=this,r=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];return new Promise(function(e){var t=o._blocks.indexOf(n);if(!o.validateIndex(t))throw new Error("Can't find a Block to remove");n.destroy(),o._blocks.remove(t),o.blockDidMutated(Bt,n,{index:t}),o.currentBlockIndex>=t&&o.currentBlockIndex--,o.blocks.length?0===t&&(o.currentBlockIndex=0):(o.currentBlockIndex=-1,r&&o.insert()),e()})}},{key:"removeSelectedBlocks",value:function(){for(var e,t=this.blocks.length-1;0<=t;t--)this.blocks[t].selected&&(this.removeBlock(this.blocks[t]),e=t);return e}},{key:"removeAllBlocks",value:function(){for(var e=this.blocks.length-1;0<=e;e--)this._blocks.remove(e);this.currentBlockIndex=-1,this.insert(),this.currentBlock.firstInput.focus()}},{key:"split",value:function(){var e=this.Editor.Caret.extractFragmentFromCaretPosition(),t=b.make("div"),e=(t.appendChild(e),{text:b.isEmpty(t)?"":t.innerHTML});return this.insert({data:e})}},{key:"getBlockByIndex",value:function(e){return-1===e&&(e=this._blocks.length-1),this._blocks[e]}},{key:"getBlockIndex",value:function(e){return this._blocks.indexOf(e)}},{key:"getBlockById",value:function(t){return this._blocks.array.find(function(e){return e.id===t})}},{key:"getBlock",value:function(e){b.isElement(e)||(e=e.parentNode);var t=this._blocks.nodes,e=e.closest(".".concat(S.CSS.wrapper)),t=t.indexOf(e);if(0<=t)return this._blocks[t]}},{key:"setCurrentBlockByChildNode",value:function(e){var t,e=(e=b.isElement(e)?e:e.parentNode).closest(".".concat(S.CSS.wrapper));return e&&null!=(t=e.closest(".".concat(this.Editor.UI.CSS.editorWrapper)))&&t.isEqualNode(this.Editor.UI.nodes.wrapper)?(this.currentBlockIndex=this._blocks.nodes.indexOf(e),this.currentBlock.updateCurrentInput(),this.currentBlock):void 0}},{key:"getBlockByChildNode",value:function(e){var t;if(e&&e instanceof Node)return t=(e=b.isElement(e)?e:e.parentNode).closest(".".concat(S.CSS.wrapper)),this.blocks.find(function(e){return e.holder===t})}},{key:"swap",value:function(e,t){this._blocks.swap(e,t),this.currentBlockIndex=t}},{key:"move",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.currentBlockIndex;isNaN(e)||isNaN(t)?u("Warning during 'move' call: incorrect indices provided.","warn"):this.validateIndex(e)&&this.validateIndex(t)?(this._blocks.move(e,t),this.currentBlockIndex=e,this.blockDidMutated("block-moved",this.currentBlock,{fromIndex:t,toIndex:e})):u("Warning during 'move' call: indices cannot be lower than 0 or greater than the amount of blocks.","warn")}},{key:"convert",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(o,r,i){var s,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.save();case 2:if(e.sent){e.next=4;break}throw new Error("Could not convert Block. Failed to extract original Block data.");case 4:if(s=this.Editor.Tools.blockTools.get(r)){e.next=7;break}throw new Error("Could not convert Block. Tool «".concat(r,"» not found."));case 7:return e.next=9,o.exportDataAsString();case 9:a=e.sent,a=E(a,s.sanitizeConfig),t=a,n=s.conversionConfig,a=p(n=null==n?void 0:n.import)?n(t):g(n)?_defineProperty({},n,t):(void 0!==n&&u("Conversion «import» property must be a string or function. String means key of tool data to import. Function accepts a imported string and return composed tool data."),{}),i&&(a=Object.assign(a,i)),this.replace(o,s.name,a);case 13:case"end":return e.stop()}var t,n},e,this)})),function(e,t,n){return o.apply(this,arguments)})},{key:"dropPointer",value:function(){this.currentBlockIndex=-1}},{key:"clear",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o=this,r=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=0<r.length&&void 0!==r[0]&&r[0],n=new Lt,this.blocks.forEach(function(t){n.add(_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.removeBlock(t,!1);case 2:case"end":return e.stop()}},e)})))}),e.next=5,n.completed;case 5:this.dropPointer(),t&&this.insert(),this.Editor.UI.checkEmptiness();case 8:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"destroy",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.blocks.map(function(e){return e.destroy()}));case 2:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"bindBlockEvents",value:function(e){var t=this,n=this.Editor.BlockEvents;this.readOnlyMutableListeners.on(e.holder,"keydown",function(e){n.keydown(e)}),this.readOnlyMutableListeners.on(e.holder,"keyup",function(e){n.keyup(e)}),this.readOnlyMutableListeners.on(e.holder,"dragover",function(e){n.dragOver(e)}),this.readOnlyMutableListeners.on(e.holder,"dragleave",function(e){n.dragLeave(e)}),e.on("didMutated",function(e){return t.blockDidMutated(At,e,{index:t.getBlockIndex(e)})})}},{key:"disableModuleBindings",value:function(){this.readOnlyMutableListeners.clearAll()}},{key:"enableModuleBindings",value:function(){var t=this;this.readOnlyMutableListeners.on(document,"cut",function(e){return t.Editor.BlockEvents.handleCommandX(e)}),this.blocks.forEach(function(e){t.bindBlockEvents(e)})}},{key:"validateIndex",value:function(e){return!(e<0||e>=this._blocks.length)}},{key:"blockDidMutated",value:function(e,t,n){e=new CustomEvent(e,{detail:_objectSpread({target:new w(t)},n)});return this.eventsDispatcher.emit(ce,{event:e}),t}}]);var e,n,o,r,i})(),Ot=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).anyBlockSelectedCache=null,e.needToSelectAll=!1,e.nativeInputSelected=!1,e.readyToBlockSelection=!1,e}return _inherits(t,x),_createClass(t,[{key:"sanitizerConfig",get:function(){return{p:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},ol:{},ul:{},li:{},br:!0,img:{src:!0,width:!0,height:!0},a:{href:!0},b:{},i:{},u:{}}}},{key:"allBlocksSelected",get:function(){return this.Editor.BlockManager.blocks.every(function(e){return!0===e.selected})},set:function(t){this.Editor.BlockManager.blocks.forEach(function(e){e.selected=t}),this.clearCache()}},{key:"anyBlockSelected",get:function(){var e=this.Editor.BlockManager;return null===this.anyBlockSelectedCache&&(this.anyBlockSelectedCache=e.blocks.some(function(e){return!0===e.selected})),this.anyBlockSelectedCache}},{key:"selectedBlocks",get:function(){return this.Editor.BlockManager.blocks.filter(function(e){return e.selected})}},{key:"prepare",value:function(){var o=this;this.selection=new C,M.add({name:"CMD+A",handler:function(e){var t=o.Editor,n=t.BlockManager;t.ReadOnly.isEnabled?(e.preventDefault(),o.selectAllBlocks()):n.currentBlock&&o.handleCommandA(e)},on:this.Editor.UI.nodes.redactor})}},{key:"toggleReadOnly",value:function(){C.get().removeAllRanges(),this.allBlocksSelected=!1}},{key:"unSelectBlockByIndex",value:function(e){var t=this.Editor.BlockManager,t=isNaN(e)?t.currentBlock:t.getBlockByIndex(e);t.selected=!1,this.clearCache()}},{key:"clearSelection",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=this.Editor,o=n.BlockManager,r=n.Caret,n=n.RectangleSelection,i=(this.needToSelectAll=!1,this.nativeInputSelected=!1,this.readyToBlockSelection=!1,t&&t instanceof KeyboardEvent),s=i&&X(t.keyCode);this.anyBlockSelected&&i&&s&&!C.isSelectionExists&&(i=o.removeSelectedBlocks(),o.insertDefaultBlockAtIndex(i,!0),r.setToBlock(o.currentBlock),Q(function(){var e=t.key;r.insertContentAtCaretPosition(1<e.length?"":e)},20)()),this.Editor.CrossBlockSelection.clear(t),!this.anyBlockSelected||n.isRectActivated()?this.Editor.RectangleSelection.clearSelection():(e&&this.selection.restore(),this.allBlocksSelected=!1)}},{key:"copySelectedBlocks",value:function(t){var n=this,o=(t.preventDefault(),b.make("div")),e=(this.selectedBlocks.forEach(function(e){var e=E(e.holder.innerHTML,n.sanitizerConfig),t=b.make("p");t.innerHTML=e,o.appendChild(t)}),Array.from(o.childNodes).map(function(e){return e.textContent}).join("\n\n")),r=o.innerHTML;return t.clipboardData.setData("text/plain",e),t.clipboardData.setData("text/html",r),Promise.all(this.selectedBlocks.map(function(e){return e.save()})).then(function(e){try{t.clipboardData.setData(n.Editor.Paste.MIME_TYPE,JSON.stringify(e))}catch(e){}})}},{key:"selectBlockByIndex",value:function(e){e=this.Editor.BlockManager.getBlockByIndex(e);void 0!==e&&this.selectBlock(e)}},{key:"selectBlock",value:function(e){this.selection.save(),C.get().removeAllRanges(),e.selected=!0,this.clearCache(),this.Editor.InlineToolbar.close()}},{key:"unselectBlock",value:function(e){e.selected=!1,this.clearCache()}},{key:"clearCache",value:function(){this.anyBlockSelectedCache=null}},{key:"destroy",value:function(){M.remove(this.Editor.UI.nodes.redactor,"CMD+A")}},{key:"handleCommandA",value:function(e){var t,n;this.Editor.RectangleSelection.clearSelection(),b.isNativeInput(e.target)&&!this.readyToBlockSelection||1<(n=(t=this.Editor.BlockManager.getBlock(e.target)).inputs).length&&!this.readyToBlockSelection?this.readyToBlockSelection=!0:1!==n.length||this.needToSelectAll?this.needToSelectAll?(e.preventDefault(),this.selectAllBlocks(),this.needToSelectAll=!1,this.readyToBlockSelection=!1,this.Editor.ConversionToolbar.close()):this.readyToBlockSelection&&(e.preventDefault(),this.selectBlock(t),this.needToSelectAll=!0):this.needToSelectAll=!0}},{key:"selectAllBlocks",value:function(){this.selection.save(),C.get().removeAllRanges(),this.allBlocksSelected=!0,this.Editor.InlineToolbar.close()}}])})(),Rt=(()=>{function n(){return _classCallCheck(this,n),_callSuper(this,n,arguments)}return _inherits(n,x),_createClass(n,[{key:"positions",get:function(){return{START:"start",END:"end",DEFAULT:"default"}}},{key:"isAtStart",get:function(){var e,t,n,o=this.Editor.BlockManager.currentBlock;return!o.focusable||(n=C.get(),o=b.getDeepestNode(o.currentInput),e=n.focusNode,b.isNativeInput(o)?0===o.selectionEnd:!!n.anchorNode&&(-1===(t=e.textContent.search(/\S/))&&(t=0),n=n.focusOffset,e.nodeType!==Node.TEXT_NODE&&e.childNodes.length&&(n=e.childNodes[n]?(e=e.childNodes[n],0):(e=e.childNodes[n-1]).textContent.length),!(!b.isLineBreakTag(o)&&!b.isEmpty(o)||!this.getHigherLevelSiblings(e,"left").every(function(e){var t=b.isLineBreakTag(e),n=1===e.children.length&&b.isLineBreakTag(e.children[0]),t=t||n;return b.isEmpty(e)&&!t})||n!==t)||null===o||e===o&&n<=t))}},{key:"isAtEnd",get:function(){var e=this.Editor.BlockManager.currentBlock;if(!e.focusable)return!0;var t=C.get(),n=t.focusNode,e=b.getDeepestNode(e.currentInput,!0);if(b.isNativeInput(e))return e.selectionEnd===e.value.length;if(!t.focusNode)return!1;t=t.focusOffset;if(n.nodeType!==Node.TEXT_NODE&&n.childNodes.length&&(t=n.childNodes[t-1]?(n=n.childNodes[t-1]).textContent.length:(n=n.childNodes[0],0)),b.isLineBreakTag(e)||b.isEmpty(e)){var o=this.getHigherLevelSiblings(n,"right");if(o.every(function(e,t){return t===o.length-1&&b.isLineBreakTag(e)||b.isEmpty(e)&&!b.isLineBreakTag(e)})&&t===n.textContent.length)return!0}var r=e.textContent.replace(/\s+$/,"");return n===e&&t>=r.length}},{key:"setToBlock",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.positions.DEFAULT,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=this.Editor,i=r.BlockManager,r=r.BlockSelection;if(r.clearSelection(),e.focusable){switch(n){case this.positions.START:t=e.firstInput;break;case this.positions.END:t=e.lastInput;break;default:t=e.currentInput}if(t){var s=b.getDeepestNode(t,n===this.positions.END),a=b.getContentLength(s);switch(!0){case n===this.positions.START:o=0;break;case n===this.positions.END:case a<o:o=a}this.set(s,o),i.setCurrentBlockByChildNode(e.holder),i.currentBlock.currentInput=t}}else null!=(n=window.getSelection())&&n.removeAllRanges(),r.selectBlock(e),i.currentBlock=e}},{key:"setToInput",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.positions.DEFAULT,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=this.Editor.BlockManager.currentBlock,r=b.getDeepestNode(e);switch(t){case this.positions.START:this.set(r,0);break;case this.positions.END:this.set(r,b.getContentLength(r));break;default:n&&this.set(r,n)}o.currentInput=e}},{key:"set",value:function(e){var e=C.setCursor(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:0),t=e.top,e=e.bottom,n=window.innerHeight;t<0?window.scrollBy(0,t-30):n<e&&window.scrollBy(0,e-n+30)}},{key:"setToTheLastBlock",value:function(){var e=this.Editor.BlockManager.lastBlock;e&&(e.tool.isDefault&&e.isEmpty?this.setToBlock(e):(e=this.Editor.BlockManager.insertAtEnd(),this.setToBlock(e)))}},{key:"extractFragmentFromCaretPosition",value:function(){var e=C.get();if(e.rangeCount){var t,n,o,r,e=e.getRangeAt(0),i=this.Editor.BlockManager.currentBlock.currentInput;if(e.deleteContents(),i)return b.isNativeInput(i)?(t=i,n=document.createDocumentFragment(),o=t.value.substring(0,t.selectionStart),r=t.value.substring(t.selectionStart),n.textContent=r,t.value=o,n):((r=e.cloneRange()).selectNodeContents(i),r.setStart(e.endContainer,e.endOffset),r.extractContents())}}},{key:"navigateNext",value:function(){var e=this.Editor.BlockManager,t=e.currentBlock,n=t.nextInput,o=this.isAtEnd,r=e.nextBlock,o=0<arguments.length&&void 0!==arguments[0]&&arguments[0]||o;if(n&&o)return this.setToInput(n,this.positions.START),!0;if(null===r){if(t.tool.isDefault||!o)return!1;r=e.insertAtEnd()}return!!o&&(this.setToBlock(r,this.positions.START),!0)}},{key:"navigatePrevious",value:function(){var e,t=this.Editor.BlockManager,n=t.currentBlock,t=t.previousBlock;return!(!n||(n=n.previousInput,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0]||this.isAtStart,n&&e?(this.setToInput(n,this.positions.END),0):null===t||!e||(this.setToBlock(t,this.positions.END),0)))}},{key:"createShadow",value:function(e){var t=document.createElement("span");t.classList.add(n.CSS.shadowCaret),e.insertAdjacentElement("beforeend",t)}},{key:"restoreCaret",value:function(e){var t,e=e.querySelector(".".concat(n.CSS.shadowCaret));e&&((new C).expandToTag(e),(t=document.createRange()).selectNode(e),t.extractContents())}},{key:"insertContentAtCaretPosition",value:function(e){var t=document.createDocumentFragment(),n=document.createElement("div"),o=C.get(),r=C.range,e=(n.innerHTML=e,Array.from(n.childNodes).forEach(function(e){return t.appendChild(e)}),0===t.childNodes.length&&t.appendChild(new Text),t.lastChild),n=(r.deleteContents(),r.insertNode(t),document.createRange()),r=e.nodeType===Node.TEXT_NODE?e:e.firstChild;null!==r&&null!==r.textContent&&n.setStart(r,r.textContent.length),o.removeAllRanges(),o.addRange(n)}},{key:"getHigherLevelSiblings",value:function(e,t){for(var n=e,o=[];n.parentNode&&"true"!==n.parentNode.contentEditable;)n=n.parentNode;for(var r="left"===t?"previousSibling":"nextSibling";n[r];)n=n[r],o.push(n);return o}}],[{key:"CSS",get:function(){return{shadowCaret:"cdx-shadow-caret"}}}])})(),Nt=(()=>{function e(){var r;return _classCallCheck(this,e),(r=_callSuper(this,e,arguments)).onMouseUp=function(){r.listeners.off(document,"mouseover",r.onMouseOver),r.listeners.off(document,"mouseup",r.onMouseUp)},r.onMouseOver=function(e){var t,n=r.Editor,o=n.BlockManager,n=n.BlockSelection;null===e.relatedTarget&&null===e.target||(t=o.getBlockByChildNode(e.relatedTarget)||r.lastSelectedBlock,o=o.getBlockByChildNode(e.target),t&&o&&o!==t&&(t===r.firstSelectedBlock?(C.get().removeAllRanges(),t.selected=!0,o.selected=!0,n.clearCache()):o===r.firstSelectedBlock?(t.selected=!1,o.selected=!1,n.clearCache()):(r.Editor.InlineToolbar.close(),r.toggleBlocksSelectedState(t,o),r.lastSelectedBlock=o)))},r}return _inherits(e,x),_createClass(e,[{key:"prepare",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.listeners.on(document,"mousedown",function(e){t.enableCrossBlockSelection(e)});case 1:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"watchSelection",value:function(e){var t;e.button===K&&(t=this.Editor.BlockManager,this.firstSelectedBlock=t.getBlock(e.target),this.lastSelectedBlock=this.firstSelectedBlock,this.listeners.on(document,"mouseover",this.onMouseOver),this.listeners.on(document,"mouseup",this.onMouseUp))}},{key:"isCrossBlockSelectionStarted",get:function(){return!!this.firstSelectedBlock&&!!this.lastSelectedBlock}},{key:"toggleBlockSelectedState",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this.Editor,n=t.BlockManager,t=t.BlockSelection,e=(this.lastSelectedBlock||(this.lastSelectedBlock=this.firstSelectedBlock=n.currentBlock),this.firstSelectedBlock===this.lastSelectedBlock&&(this.firstSelectedBlock.selected=!0,t.clearCache(),C.get().removeAllRanges()),n.blocks.indexOf(this.lastSelectedBlock)+(e?1:-1)),n=n.blocks[e];n&&(this.lastSelectedBlock.selected!==n.selected?n.selected=!0:this.lastSelectedBlock.selected=!1,t.clearCache(),this.lastSelectedBlock=n,this.Editor.InlineToolbar.close(),n.holder.scrollIntoView({block:"nearest"}))}},{key:"clear",value:function(e){var t=this.Editor,n=t.BlockManager,o=t.BlockSelection,r=t.Caret,i=n.blocks.indexOf(this.firstSelectedBlock),s=n.blocks.indexOf(this.lastSelectedBlock);if(o.anyBlockSelected&&-1<i&&-1<s&&e&&e instanceof KeyboardEvent)switch(e.keyCode){case c:case G:r.setToBlock(n.blocks[Math.max(i,s)],r.positions.END);break;case l:case U:r.setToBlock(n.blocks[Math.min(i,s)],r.positions.START);break;default:r.setToBlock(n.blocks[Math.max(i,s)],r.positions.END)}this.firstSelectedBlock=this.lastSelectedBlock=null}},{key:"enableCrossBlockSelection",value:function(e){var t=this.Editor.UI;C.isCollapsed||this.Editor.BlockSelection.clearSelection(e),t.nodes.redactor.contains(e.target)?this.watchSelection(e):this.Editor.BlockSelection.clearSelection(e)}},{key:"toggleBlocksSelectedState",value:function(e,t){for(var n=this.Editor,o=n.BlockManager,r=n.BlockSelection,i=o.blocks.indexOf(e),s=o.blocks.indexOf(t),a=e.selected!==t.selected,l=Math.min(i,s);l<=Math.max(i,s);l++){var c=o.blocks[l];c!==this.firstSelectedBlock&&c!==(a?e:t)&&(o.blocks[l].selected=!o.blocks[l].selected,r.clearCache())}}}]);var t})(),Pt=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).isStartedAtEditor=!1,e}return _inherits(t,x),_createClass(t,[{key:"toggleReadOnly",value:function(e){e?this.disableModuleBindings():this.enableModuleBindings()}},{key:"enableModuleBindings",value:function(){var n=this,e=this.Editor.UI;this.readOnlyMutableListeners.on(e.nodes.holder,"drop",(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.processDrop(t);case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),!0),this.readOnlyMutableListeners.on(e.nodes.holder,"dragstart",function(){n.processDragStart()}),this.readOnlyMutableListeners.on(e.nodes.holder,"dragover",function(e){n.processDragOver(e)},!0)}},{key:"disableModuleBindings",value:function(){this.readOnlyMutableListeners.clearAll()}},{key:"processDrop",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o,r,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.Editor,n=r.BlockManager,o=r.Caret,r=r.Paste,t.preventDefault(),n.blocks.forEach(function(e){e.dropTarget=!1}),C.isAtEditor&&!C.isCollapsed&&this.isStartedAtEditor&&document.execCommand("delete"),this.isStartedAtEditor=!1,(i=n.setCurrentBlockByChildNode(t.target))?this.Editor.Caret.setToBlock(i,o.positions.END):(i=n.setCurrentBlockByChildNode(n.lastBlock.holder),this.Editor.Caret.setToBlock(i,o.positions.END)),e.next=6,r.processDataTransfer(t.dataTransfer,!0);case 6:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"processDragStart",value:function(){C.isAtEditor&&!C.isCollapsed&&(this.isStartedAtEditor=!0),this.Editor.InlineToolbar.close()}},{key:"processDragOver",value:function(e){e.preventDefault()}}]);var n})(),Dt=(()=>{function o(e){var t,n=e.config,e=e.eventsDispatcher;return _classCallCheck(this,o),(t=_callSuper(this,o,[{config:n,eventsDispatcher:e}])).disabled=!1,t.batchingTimeout=null,t.batchingOnChangeQueue=new Map,t.batchTime=400,t.mutationObserver=new MutationObserver(function(e){t.redactorChanged(e)}),t.eventsDispatcher.on(ce,function(e){t.particularBlockChanged(e.event)}),t.eventsDispatcher.on(ue,function(){t.disable()}),t.eventsDispatcher.on(de,function(){t.enable()}),t}return _inherits(o,x),_createClass(o,[{key:"enable",value:function(){this.mutationObserver.observe(this.Editor.UI.nodes.redactor,{childList:!0,subtree:!0,characterData:!0,attributes:!0}),this.disabled=!1}},{key:"disable",value:function(){this.mutationObserver.disconnect(),this.disabled=!0}},{key:"particularBlockChanged",value:function(e){var t=this;!this.disabled&&p(this.config.onChange)&&(this.batchingOnChangeQueue.set("block:".concat(e.detail.target.id,":event:").concat(e.type),e),this.batchingTimeout&&clearTimeout(this.batchingTimeout),this.batchingTimeout=setTimeout(function(){var e=1===t.batchingOnChangeQueue.size?t.batchingOnChangeQueue.values().next().value:Array.from(t.batchingOnChangeQueue.values());t.config.onChange&&t.config.onChange(t.Editor.API.methods,e),t.batchingOnChangeQueue.clear()},this.batchTime))}},{key:"redactorChanged",value:function(e){this.eventsDispatcher.emit(le,{mutations:e})}}])})(),jt=(()=>{function e(){var r;return _classCallCheck(this,e),(r=_callSuper(this,e,arguments)).MIME_TYPE="application/x-editor-js",r.toolsTags={},r.tagsByTool={},r.toolsPatterns=[],r.toolsFiles={},r.exceptionList=[],r.processTool=function(e){try{var t=e.create({},{},!1);!1===e.pasteConfig?r.exceptionList.push(e.name):p(t.onPaste)&&(r.getTagsConfig(e),r.getFilesConfig(e),r.getPatternsConfig(e))}catch(t){u("Paste handling for «".concat(e.name,"» Tool hasn't been set up because of the error"),"warn",t)}},r.handlePasteEvent=(()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=r.Editor,o=n.BlockManager,n=n.Toolbar,!(o=o.setCurrentBlockByChildNode(t.target))||r.isNativeBehaviour(t.target)&&!t.clipboardData.types.includes("Files")||o&&r.exceptionList.includes(o.name)||(t.preventDefault(),r.processDataTransfer(t.clipboardData),n.close());case 2:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})(),r}return _inherits(e,x),_createClass(e,[{key:"prepare",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.processTools();case 1:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"toggleReadOnly",value:function(e){e?this.unsetCallback():this.setCallback()}},{key:"processDataTransfer",value:(a=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o,r,i,s,a,l=this,c=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<c.length&&void 0!==c[1]&&c[1],o=this.Editor.Tools,((r=t.types).includes?r.includes("Files"):r.contains("Files"))&&!v(this.toolsFiles))return e.next=5,this.processFiles(t.files);e.next=6;break;case 5:return e.abrupt("return");case 6:if(r=t.getData(this.MIME_TYPE),i=t.getData("text/plain"),s=t.getData("text/html"),r)return e.prev=9,this.insertEditorJSData(JSON.parse(r)),e.abrupt("return");e.next=16;break;case 14:e.prev=14,e.t0=e.catch(9);case 16:if(n&&i.trim()&&s.trim()&&(s="<p>"+(s.trim()?s:i)+"</p>"),a=Object.keys(this.toolsTags).reduce(function(e,t){return e[t.toLowerCase()]=null!=(t=l.toolsTags[t].sanitizationConfig)?t:{},e},{}),a=Object.assign({},a,o.getAllInlineToolsSanitizeConfig(),{br:{}}),(a=E(s,a)).trim()&&a.trim()!==i&&b.isHTMLString(a)){e.next=23;break}return e.next=21,this.processText(i);case 21:e.next=25;break;case 23:return e.next=25,this.processText(a,!0);case 25:case"end":return e.stop()}},e,this,[[9,14]])})),function(e){return a.apply(this,arguments)})},{key:"processText",value:(s=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o,r,i,s=this,a=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=1<a.length&&void 0!==a[1]&&a[1],o=this.Editor,n=o.Caret,o=o.BlockManager,(r=r?this.processHTML(t):this.processPlain(t)).length){e.next=4;break}return e.abrupt("return");case 4:if(1===r.length)return r[0].isBlock?this.processSingleBlock(r.pop()):this.processInlinePaste(r.pop()),e.abrupt("return");e.next=7;break;case 7:i=o.currentBlock&&o.currentBlock.tool.isDefault&&o.currentBlock.isEmpty,r.map((()=>{var n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.insertBlock(t,0===n&&i));case 1:case"end":return e.stop()}},e)}));return function(e,t){return n.apply(this,arguments)}})()),o.currentBlock&&n.setToBlock(o.currentBlock,n.positions.END);case 9:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"setCallback",value:function(){this.listeners.on(this.Editor.UI.nodes.holder,"paste",this.handlePasteEvent)}},{key:"unsetCallback",value:function(){this.listeners.off(this.Editor.UI.nodes.holder,"paste",this.handlePasteEvent)}},{key:"processTools",value:function(){var e=this.Editor.Tools.blockTools;Array.from(e.values()).forEach(this.processTool)}},{key:"collectTagNames",value:function(e){return g(e)?[e]:f(e)?Object.keys(e):[]}},{key:"getTagsConfig",value:function(o){var e,t,r=this;!1!==o.pasteConfig&&(e=o.pasteConfig.tags||[],t=[],e.forEach(function(n){var e=r.collectTagNames(n);t.push.apply(t,_toConsumableArray(e)),e.forEach(function(e){var t;Object.prototype.hasOwnProperty.call(r.toolsTags,e)?u("Paste handler for «".concat(o.name,"» Tool on «").concat(e,"» tag is skipped because it is already used by «").concat(r.toolsTags[e].tool.name,"» Tool."),"warn"):(t=f(n)?n[e]:null,r.toolsTags[e.toUpperCase()]={tool:o,sanitizationConfig:t})})}),this.tagsByTool[o.name]=t.map(function(e){return e.toUpperCase()}))}},{key:"getFilesConfig",value:function(t){var e,n;!1!==t.pasteConfig&&(e=(n=void 0===(n=t.pasteConfig.files)?{}:n).extensions,n=n.mimeTypes,e||n)&&(e&&!Array.isArray(e)&&(u("«extensions» property of the onDrop config for «".concat(t.name,"» Tool should be an array")),e=[]),n&&!Array.isArray(n)&&(u("«mimeTypes» property of the onDrop config for «".concat(t.name,"» Tool should be an array")),n=[]),n=n&&n.filter(function(e){return!!/^[-\w]+\/([-+\w]+|\*)$/.test(e)||(u("MIME type value «".concat(e,"» for the «").concat(t.name,"» Tool is not a valid MIME type"),"warn"),!1)}),this.toolsFiles[t.name]={extensions:e||[],mimeTypes:n||[]})}},{key:"getPatternsConfig",value:function(n){var o=this;!1!==n.pasteConfig&&n.pasteConfig.patterns&&!v(n.pasteConfig.patterns)&&Object.entries(n.pasteConfig.patterns).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];e instanceof RegExp||u("Pattern ".concat(e," for «").concat(n.name,"» Tool is skipped because it should be a Regexp instance."),"warn"),o.toolsPatterns.push({key:t,pattern:e,tool:n})})}},{key:"isNativeBehaviour",value:function(e){return b.isNativeInput(e)}},{key:"processFiles",value:(i=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o,r,i=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.Editor.BlockManager,e.next=3,Promise.all(Array.from(t).map(function(e){return i.processFile(e)}));case 3:o=(o=e.sent).filter(function(e){return!!e}),r=n.currentBlock.tool.isDefault&&n.currentBlock.isEmpty,o.forEach(function(e,t){n.paste(e.type,e.event,0===t&&r)});case 7:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"processFile",value:(r=_asyncToGenerator(_regeneratorRuntime().mark(function e(i){var s,t,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i.name.split(".").pop(),t=Object.entries(this.toolsFiles).find(function(e){var e=_slicedToArray(e,2),e=(e[0],e[1]),t=e.mimeTypes,e=e.extensions,n=_slicedToArray(i.type.split("/"),2),o=n[0],r=n[1],n=e.find(function(e){return e.toLowerCase()===s.toLowerCase()}),e=t.find(function(e){var e=_slicedToArray(e.split("/"),2),t=e[0],e=e[1];return t===o&&(e===r||"*"===e)});return!!n||!!e})){e.next=3;break}return e.abrupt("return");case 3:return n=_slicedToArray(t,1),n=n[0],e.abrupt("return",{event:this.composePasteEvent("file",{file:i}),type:n});case 5:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"processHTML",value:function(e){var s=this,a=this.Editor.Tools,t=b.make("DIV");return t.innerHTML=e,this.getNodes(t).map(function(e){var t=a.defaultTool,n=!1;switch(e.nodeType){case Node.DOCUMENT_FRAGMENT_NODE:(o=b.make("div")).appendChild(e);break;case Node.ELEMENT_NODE:n=!0,s.toolsTags[(o=e).tagName]&&(t=s.toolsTags[o.tagName].tool)}var o,r=(t.pasteConfig||{tags:[]}).tags.reduce(function(n,o){return s.collectTagNames(o).forEach(function(e){var t=f(o)?o[e]:null;n[e.toLowerCase()]=t||{}}),n},{}),r=Object.assign({},r,t.baseSanitizeConfig),i=("table"===o.tagName.toLowerCase()?(i=E(o.outerHTML,r),o=b.make("div",void 0,{innerHTML:i}).firstChild):o.innerHTML=E(o.innerHTML,r),s.composePasteEvent("tag",{data:o}));return{content:o,isBlock:n,tool:t.name,event:i}}).filter(function(e){var t=b.isEmpty(e.content),e=b.isSingleTag(e.content);return!t||e})}},{key:"processPlain",value:function(e){var n,o=this,t=this.config.defaultBlock;return e?(n=t,e.split(/\r?\n/).filter(function(e){return e.trim()}).map(function(e){var t=b.make("div"),e=(t.textContent=e,o.composePasteEvent("tag",{data:t}));return{content:t,tool:n,isBlock:!1,event:e}})):[]}},{key:"processSingleBlock",value:(o=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.Editor,n=o.Caret,(o=o.BlockManager.currentBlock)&&t.tool===o.name&&b.containsOnlyInlineElements(t.content.innerHTML)){e.next=4;break}return this.insertBlock(t,(null==o?void 0:o.tool.isDefault)&&o.isEmpty),e.abrupt("return");case 4:n.insertContentAtCaretPosition(t.content.innerHTML);case 5:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"processInlinePaste",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o,r,i,s;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.Editor,n=o.BlockManager,o=o.Caret,r=t.content,n.currentBlock&&n.currentBlock.tool.isDefault&&r.textContent.length<jt.PATTERN_PROCESSING_MAX_LENGTH)return e.next=4,this.processPattern(r.textContent);e.next=9;break;case 4:if(i=e.sent)return s=n.currentBlock&&n.currentBlock.tool.isDefault&&n.currentBlock.isEmpty,i=n.paste(i.tool,i.event,s),o.setToBlock(i,o.positions.END),e.abrupt("return");e.next=9;break;case 9:n.currentBlock&&n.currentBlock.currentInput?(s=n.currentBlock.tool.baseSanitizeConfig,document.execCommand("insertHTML",!1,E(r.innerHTML,s))):this.insertBlock(t);case 10:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"processPattern",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.toolsPatterns.find(function(e){e=e.pattern.exec(t);return!!e&&t===e.shift()}),e.abrupt("return",n?{event:this.composePasteEvent("pattern",{key:n.key,data:t}),tool:n.tool.name}:void 0);case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"insertBlock",value:function(e){var t,n=this.Editor,o=n.BlockManager,n=n.Caret,r=o.currentBlock;t=1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&r&&r.isEmpty?o.paste(e.tool,e.event,!0):o.paste(e.tool,e.event),n.setToBlock(t,n.positions.END)}},{key:"insertEditorJSData",value:function(e){var t=this.Editor,r=t.BlockManager,i=t.Caret,n=t.Tools;Oe(e,function(e){return n.blockTools.get(e).sanitizeConfig}).forEach(function(e,t){var n=e.tool,o=!1,t=(0===t&&(o=r.currentBlock&&r.currentBlock.tool.isDefault&&r.currentBlock.isEmpty),r.insert({tool:n,data:e.data,replace:o}));i.setToBlock(t,i.positions.END)})}},{key:"processElementNode",value:function(e,t,n){var o=Object.keys(this.toolsTags),r=(this.toolsTags[e.tagName]||{}).tool,i=this.tagsByTool[null==r?void 0:r.name]||[],r=o.includes(e.tagName),s=b.blockElements.includes(e.tagName.toLowerCase()),a=Array.from(e.children).some(function(e){e=e.tagName;return o.includes(e)&&!i.includes(e)}),l=Array.from(e.children).some(function(e){e=e.tagName;return b.blockElements.includes(e.toLowerCase())});return s||r||a?r&&!a||s&&!l&&!a?[].concat(_toConsumableArray(t),[n,e]):void 0:(n.appendChild(e),[].concat(_toConsumableArray(t),[n]))}},{key:"getNodes",value:function(e){var r,i=this,e=Array.from(e.childNodes),s=function(e,t){if(b.isEmpty(t)&&!b.isSingleTag(t))return e;var n=e[e.length-1],o=new DocumentFragment;switch(n&&b.isFragment(n)&&(o=e.pop()),t.nodeType){case Node.ELEMENT_NODE:if(r=i.processElementNode(t,e,o))return r;break;case Node.TEXT_NODE:return o.appendChild(t),[].concat(_toConsumableArray(e),[o]);default:return[].concat(_toConsumableArray(e),[o])}return[].concat(_toConsumableArray(e),_toConsumableArray(Array.from(t.childNodes).reduce(s,[])))};return e.reduce(s,[])}},{key:"composePasteEvent",value:function(e,t){return new CustomEvent(e,{detail:t})}}]);var t,n,o,r,i,s,a,l})(),Ft=jt,Ht=(Ft.PATTERN_PROCESSING_MAX_LENGTH=450,(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).toolsDontSupportReadOnly=[],e.readOnlyEnabled=!1,e}return _inherits(t,x),_createClass(t,[{key:"isEnabled",get:function(){return this.readOnlyEnabled}},{key:"prepare",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.Editor.Tools,t=t.blockTools,n=[],Array.from(t.entries()).forEach(function(e){var e=_slicedToArray(e,2),t=e[0];e[1].isReadOnlySupported||n.push(t)}),this.toolsDontSupportReadOnly=n,this.config.readOnly&&0<n.length&&this.throwCriticalError(),this.toggle(this.config.readOnly);case 2:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"toggle",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o,r,i=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(o in(t=0<i.length&&void 0!==i[0]?i[0]:!this.readOnlyEnabled)&&0<this.toolsDontSupportReadOnly.length&&this.throwCriticalError(),n=this.readOnlyEnabled,this.readOnlyEnabled=t,this.Editor)this.Editor[o].toggleReadOnly&&this.Editor[o].toggleReadOnly(t);if(n===t)return e.abrupt("return",this.readOnlyEnabled);e.next=7;break;case 7:return e.next=9,this.Editor.Saver.save();case 9:return r=e.sent,e.next=12,this.Editor.BlockManager.clear();case 12:return e.next=14,this.Editor.Renderer.render(r.blocks);case 14:return e.abrupt("return",this.readOnlyEnabled);case 15:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"throwCriticalError",value:function(){throw new ie("To enable read-only mode all connected tools should support it. Tools ".concat(this.toolsDontSupportReadOnly.join(", ")," don't support read-only mode."))}}]);var e,n})()),zt=(()=>{function r(){var e;return _classCallCheck(this,r),(e=_callSuper(this,r,arguments)).isRectSelectionActivated=!1,e.SCROLL_SPEED=3,e.HEIGHT_OF_SCROLL_ZONE=40,e.BOTTOM_SCROLL_ZONE=1,e.TOP_SCROLL_ZONE=2,e.MAIN_MOUSE_BUTTON=0,e.mousedown=!1,e.isScrolling=!1,e.inScrollZone=null,e.startX=0,e.startY=0,e.mouseX=0,e.mouseY=0,e.stackOfSelected=[],e.listenerIds=[],e}return _inherits(r,x),_createClass(r,[{key:"prepare",value:function(){this.enableModuleBindings()}},{key:"startSelection",value:function(e,t){var n=document.elementFromPoint(e-window.pageXOffset,t-window.pageYOffset),o=(n.closest(".".concat(this.Editor.Toolbar.CSS.toolbar))||(this.Editor.BlockSelection.allBlocksSelected=!1,this.clearSelection(),this.stackOfSelected=[]),[".".concat(S.CSS.content),".".concat(this.Editor.Toolbar.CSS.toolbar),".".concat(this.Editor.InlineToolbar.CSS.inlineToolbar)]),r=n.closest("."+this.Editor.UI.CSS.editorWrapper),o=o.some(function(e){return!!n.closest(e)});r&&!o&&(this.mousedown=!0,this.startX=e,this.startY=t)}},{key:"endSelection",value:function(){this.mousedown=!1,this.startX=0,this.startY=0,this.overlayRectangle.style.display="none"}},{key:"isRectActivated",value:function(){return this.isRectSelectionActivated}},{key:"clearSelection",value:function(){this.isRectSelectionActivated=!1}},{key:"enableModuleBindings",value:function(){var t=this,e=this.genHTML().container;this.listeners.on(e,"mousedown",function(e){t.processMouseDown(e)},!1),this.listeners.on(document.body,"mousemove",ee(function(e){t.processMouseMove(e)},10),{passive:!0}),this.listeners.on(document.body,"mouseleave",function(){t.processMouseLeave()}),this.listeners.on(window,"scroll",ee(function(e){t.processScroll(e)},10),{passive:!0}),this.listeners.on(document.body,"mouseup",function(){t.processMouseUp()},!1)}},{key:"processMouseDown",value:function(e){e.button===this.MAIN_MOUSE_BUTTON&&null===e.target.closest(b.allInputsSelector)&&this.startSelection(e.pageX,e.pageY)}},{key:"processMouseMove",value:function(e){this.changingRectangle(e),this.scrollByZones(e.clientY)}},{key:"processMouseLeave",value:function(){this.clearSelection(),this.endSelection()}},{key:"processScroll",value:function(e){this.changingRectangle(e)}},{key:"processMouseUp",value:function(){this.clearSelection(),this.endSelection()}},{key:"scrollByZones",value:function(e){this.inScrollZone=null,e<=this.HEIGHT_OF_SCROLL_ZONE&&(this.inScrollZone=this.TOP_SCROLL_ZONE),document.documentElement.clientHeight-e<=this.HEIGHT_OF_SCROLL_ZONE&&(this.inScrollZone=this.BOTTOM_SCROLL_ZONE),this.inScrollZone?this.isScrolling||(this.scrollVertical(this.inScrollZone===this.TOP_SCROLL_ZONE?-this.SCROLL_SPEED:this.SCROLL_SPEED),this.isScrolling=!0):this.isScrolling=!1}},{key:"genHTML",value:function(){var e=this.Editor.UI,e=e.nodes.holder.querySelector("."+e.CSS.editorWrapper),t=b.make("div",r.CSS.overlay,{}),n=b.make("div",r.CSS.overlayContainer,{}),o=b.make("div",r.CSS.rect,{});return n.appendChild(o),t.appendChild(n),e.appendChild(t),this.overlayRectangle=o,{container:e,overlay:t}}},{key:"scrollVertical",value:function(e){var t,n=this;this.inScrollZone&&this.mousedown&&(t=window.pageYOffset,window.scrollBy(0,e),this.mouseY+=window.pageYOffset-t,setTimeout(function(){n.scrollVertical(e)},0))}},{key:"changingRectangle",value:function(e){var t,n;this.mousedown&&(void 0!==e.pageY&&(this.mouseX=e.pageX,this.mouseY=e.pageY),n=(e=this.genInfoForMouseSelection()).rightPos,t=e.index,n=this.startX>n&&this.mouseX>n,e=this.startX<(e=e.leftPos)&&this.mouseX<e,this.rectCrossesBlocks=!(n||e),this.isRectSelectionActivated||(this.rectCrossesBlocks=!1,this.isRectSelectionActivated=!0,this.shrinkRectangleToPoint(),this.overlayRectangle.style.display="block"),this.updateRectangleSize(),this.Editor.Toolbar.close(),void 0!==t)&&(this.trySelectNextBlock(t),this.inverseSelection(),C.get().removeAllRanges())}},{key:"shrinkRectangleToPoint",value:function(){this.overlayRectangle.style.left="".concat(this.startX-window.pageXOffset,"px"),this.overlayRectangle.style.top="".concat(this.startY-window.pageYOffset,"px"),this.overlayRectangle.style.bottom="calc(100% - ".concat(this.startY-window.pageYOffset,"px"),this.overlayRectangle.style.right="calc(100% - ".concat(this.startX-window.pageXOffset,"px")}},{key:"inverseSelection",value:function(){var e=this.Editor.BlockManager.getBlockByIndex(this.stackOfSelected[0]).selected;if(this.rectCrossesBlocks&&!e){var t,n=_createForOfIteratorHelper(this.stackOfSelected);try{for(n.s();!(t=n.n()).done;){var o=t.value;this.Editor.BlockSelection.selectBlockByIndex(o)}}catch(e){n.e(e)}finally{n.f()}}if(!this.rectCrossesBlocks&&e){var r,i=_createForOfIteratorHelper(this.stackOfSelected);try{for(i.s();!(r=i.n()).done;){var s=r.value;this.Editor.BlockSelection.unSelectBlockByIndex(s)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"updateRectangleSize",value:function(){this.mouseY>=this.startY?(this.overlayRectangle.style.top="".concat(this.startY-window.pageYOffset,"px"),this.overlayRectangle.style.bottom="calc(100% - ".concat(this.mouseY-window.pageYOffset,"px")):(this.overlayRectangle.style.bottom="calc(100% - ".concat(this.startY-window.pageYOffset,"px"),this.overlayRectangle.style.top="".concat(this.mouseY-window.pageYOffset,"px")),this.mouseX>=this.startX?(this.overlayRectangle.style.left="".concat(this.startX-window.pageXOffset,"px"),this.overlayRectangle.style.right="calc(100% - ".concat(this.mouseX-window.pageXOffset,"px")):(this.overlayRectangle.style.right="calc(100% - ".concat(this.startX-window.pageXOffset,"px"),this.overlayRectangle.style.left="".concat(this.mouseX-window.pageXOffset,"px"))}},{key:"genInfoForMouseSelection",value:function(){var e,t=document.body.offsetWidth/2,n=this.mouseY-window.pageYOffset,n=document.elementFromPoint(t,n),o=this.Editor.BlockManager.getBlockByChildNode(n),n=(void 0!==o&&(e=this.Editor.BlockManager.blocks.findIndex(function(e){return e.holder===o.holder})),this.Editor.BlockManager.lastBlock.holder.querySelector("."+S.CSS.content)),n=Number.parseInt(window.getComputedStyle(n).width,10)/2;return{index:e,leftPos:t-n,rightPos:t+n}}},{key:"addBlockInSelection",value:function(e){this.rectCrossesBlocks&&this.Editor.BlockSelection.selectBlockByIndex(e),this.stackOfSelected.push(e)}},{key:"trySelectNextBlock",value:function(e){var t=this,n=this.stackOfSelected[this.stackOfSelected.length-1]===e,o=this.stackOfSelected.length;if(!n){var n=0<this.stackOfSelected[o-1]-this.stackOfSelected[o-2],r=0,n=(1<o&&(r=n?1:-1),e>this.stackOfSelected[o-1]&&1===r),i=e<this.stackOfSelected[o-1]&&-1===r,n=!(n||i||0===r);if(!n&&(e>this.stackOfSelected[o-1]||void 0===this.stackOfSelected[o-1]))for(var s=this.stackOfSelected[o-1]+1||e;s<=e;s++)this.addBlockInSelection(s);else if(!n&&e<this.stackOfSelected[o-1])for(var a=this.stackOfSelected[o-1]-1;e<=a;a--)this.addBlockInSelection(a);else if(n)for(var l=o-1,c=e>this.stackOfSelected[o-1]?function(){return e>t.stackOfSelected[l]}:function(){return e<t.stackOfSelected[l]};c();)this.rectCrossesBlocks&&this.Editor.BlockSelection.unSelectBlockByIndex(this.stackOfSelected[l]),this.stackOfSelected.pop(),l--}}}],[{key:"CSS",get:function(){return{overlay:"codex-editor-overlay",overlayContainer:"codex-editor-overlay__container",rect:"codex-editor-overlay__rectangle",topScrollZone:"codex-editor-overlay__scroll-zone--top",bottomScrollZone:"codex-editor-overlay__scroll-zone--bottom"}}}])})(),Ut=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"render",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(n){var l=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var t=l.Editor,s=t.Tools,a=t.BlockManager;0===n.length?a.insert():(t=n.map(function(t){var n,o=t.type,r=t.data,i=t.tunes,t=t.id;!1===s.available.has(o)&&(d("Tool «".concat(o,"» is not found. Check 'tools' property at the Editor.js config."),"warn"),r=l.composeStubDataForTool(o,r,t),o=s.stubTool);try{n=a.composeBlock({id:t,tool:o,data:r,tunes:i})}catch(e){u("Block «".concat(o,"» skipped because of plugins error"),"error",{data:r,error:e}),r=l.composeStubDataForTool(o,r,t),o=s.stubTool,n=a.composeBlock({id:t,tool:o,data:r,tunes:i})}return n}),a.insertMany(t)),window.requestIdleCallback(function(){e()},{timeout:2e3})}));case 1:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"composeStubDataForTool",value:function(e,t,n){var o=this.Editor.Tools,r=e;return{savedData:{id:n,type:e,data:t},title:r=o.unavailable.has(e)&&void 0!==(n=o.unavailable.get(e).toolbox)&&void 0!==n[0].title?n[0].title:r}}}]);var t})(),Gt=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,x),_createClass(e,[{key:"save",value:(n=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o,r,i=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.Editor,o=r.BlockManager,t=r.Tools,r=o.blocks,n=[],e.prev=1,r.forEach(function(e){n.push(i.getSavedData(e))}),e.next=5,Promise.all(n);case 5:return o=e.sent,e.next=8,Oe(o,function(e){return t.blockTools.get(e).sanitizeConfig});case 8:return r=e.sent,e.abrupt("return",this.makeOutput(r));case 12:e.prev=12,e.t0=e.catch(1),d("Saving failed due to the Error %o","error",e.t0);case 15:case"end":return e.stop()}},e,this,[[1,12]])})),function(){return n.apply(this,arguments)})},{key:"getSavedData",value:(t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,o;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.save();case 2:if(n=e.sent,e.t0=n,e.t0)return e.next=7,t.validate(n.data);e.next=8;break;case 7:e.t0=e.sent;case 8:return o=e.t0,e.abrupt("return",_objectSpread(_objectSpread({},n),{},{isValid:o}));case 10:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)})},{key:"makeOutput",value:function(e){var i=this,s=[];return e.forEach(function(e){var t=e.id,n=e.tool,o=e.data,r=e.tunes;e.isValid?n===i.Editor.Tools.stubTool?s.push(o):(e=_objectSpread({id:t,type:n,data:o},!v(r)&&{tunes:r}),s.push(e)):u("Block «".concat(n,"» skipped because saved data is invalid"))}),{time:+new Date,blocks:s,version:"2.29.1"}}}]);var t,n})();try{("undefined"==typeof document?"undefined":_typeof(document))<"u"&&((en=document.createElement("style")).appendChild(document.createTextNode(".ce-paragraph{line-height:1.6em;outline:none}.ce-paragraph[data-placeholder]:empty:before{content:attr(data-placeholder);color:#707684;font-weight:400;opacity:0}.codex-editor--empty .ce-block:first-child .ce-paragraph[data-placeholder]:empty:before{opacity:1}.codex-editor--toolbox-opened .ce-block:first-child .ce-paragraph[data-placeholder]:empty:before,.codex-editor--empty .ce-block:first-child .ce-paragraph[data-placeholder]:empty:focus:before{opacity:0}.ce-paragraph p:first-of-type{margin-top:0}.ce-paragraph p:last-of-type{margin-bottom:0}")),document.head.appendChild(en))}catch(e){console.error("vite-plugin-css-injected-by-js",e)}for(var qt,Kt=(()=>_createClass(function e(t){var n=t.data,o=t.config,r=t.api,t=t.readOnly;_classCallCheck(this,e),this.api=r,this.readOnly=t,this._CSS={block:this.api.styles.block,wrapper:"ce-paragraph"},this.readOnly||(this.onKeyUp=this.onKeyUp.bind(this)),this._placeholder=o.placeholder||e.DEFAULT_PLACEHOLDER,this._data={},this._element=null,this._preserveBlank=void 0!==o.preserveBlank&&o.preserveBlank,this.data=n},[{key:"onKeyUp",value:function(e){"Backspace"!==e.code&&"Delete"!==e.code||""===this._element.textContent&&(this._element.innerHTML="")}},{key:"drawView",value:function(){var e=document.createElement("DIV");return e.classList.add(this._CSS.wrapper,this._CSS.block),e.contentEditable=!1,e.dataset.placeholder=this.api.i18n.t(this._placeholder),this._data.text&&(e.innerHTML=this._data.text),this.readOnly||(e.contentEditable=!0,e.addEventListener("keyup",this.onKeyUp)),e}},{key:"render",value:function(){return this._element=this.drawView(),this._element}},{key:"merge",value:function(e){e={text:this.data.text+e.text};this.data=e}},{key:"validate",value:function(e){return!(""===e.text.trim()&&!this._preserveBlank)}},{key:"save",value:function(e){return{text:e.innerHTML}}},{key:"onPaste",value:function(e){e={text:e.detail.data.innerHTML};this.data=e}},{key:"data",get:function(){var e;return null!==this._element&&(e=this._element.innerHTML,this._data.text=e),this._data},set:function(e){this._data=e||{},null!==this._element&&this.hydrate()}},{key:"hydrate",value:function(){var e=this;window.requestAnimationFrame(function(){e._element.innerHTML=e._data.text||""})}}],[{key:"DEFAULT_PLACEHOLDER",get:function(){return""}},{key:"conversionConfig",get:function(){return{export:"text",import:"text"}}},{key:"sanitize",get:function(){return{text:{br:!0}}}},{key:"isReadOnlySupported",get:function(){return!0}},{key:"pasteConfig",get:function(){return{tags:["P"]}}},{key:"toolbox",get:function(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 9V7.2C8 7.08954 8.08954 7 8.2 7L12 7M16 9V7.2C16 7.08954 15.9105 7 15.8 7L12 7M12 7L12 17M12 17H10M12 17H14"/></svg>',title:"Text"}}}]))(),Wt=(()=>_createClass(function e(){_classCallCheck(this,e),this.commandName="bold",this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--bold"},this.nodes={button:void 0}},[{key:"render",value:function(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M9 12L9 7.1C9 7.04477 9.04477 7 9.1 7H10.4C11.5 7 14 7.1 14 9.5C14 9.5 14 12 11 12M9 12V16.8C9 16.9105 9.08954 17 9.2 17H12.5C14 17 15 16 15 14.5C15 11.7046 11 12 11 12M9 12H11"/></svg>',this.nodes.button}},{key:"surround",value:function(){document.execCommand(this.commandName)}},{key:"checkState",value:function(){var e=document.queryCommandState(this.commandName);return this.nodes.button.classList.toggle(this.CSS.buttonActive,e),e}},{key:"shortcut",get:function(){return"CMD+B"}}],[{key:"sanitize",get:function(){return{b:{}}}}]))(),Yt=(Wt.isInline=!0,Wt.title="Bold",(()=>_createClass(function e(){_classCallCheck(this,e),this.commandName="italic",this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--italic"},this.nodes={button:null}},[{key:"render",value:function(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M13.34 10C12.4223 12.7337 11 17 11 17"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.21 7H14.2"/></svg>',this.nodes.button}},{key:"surround",value:function(){document.execCommand(this.commandName)}},{key:"checkState",value:function(){var e=document.queryCommandState(this.commandName);return this.nodes.button.classList.toggle(this.CSS.buttonActive,e),e}},{key:"shortcut",get:function(){return"CMD+I"}}],[{key:"sanitize",get:function(){return{i:{}}}}]))()),Vt=(Yt.isInline=!0,Yt.title="Italic",(()=>_createClass(function e(t){t=t.api;_classCallCheck(this,e),this.commandLink="createLink",this.commandUnlink="unlink",this.ENTER_KEY=13,this.CSS={button:"ce-inline-tool",buttonActive:"ce-inline-tool--active",buttonModifier:"ce-inline-tool--link",buttonUnlink:"ce-inline-tool--unlink",input:"ce-inline-tool-input",inputShowed:"ce-inline-tool-input--showed"},this.nodes={button:null,input:null},this.inputOpened=!1,this.toolbar=t.toolbar,this.inlineToolbar=t.inlineToolbar,this.notifier=t.notifier,this.i18n=t.i18n,this.selection=new C},[{key:"render",value:function(){return this.nodes.button=document.createElement("button"),this.nodes.button.type="button",this.nodes.button.classList.add(this.CSS.button,this.CSS.buttonModifier),this.nodes.button.innerHTML=Ve,this.nodes.button}},{key:"renderActions",value:function(){var t=this;return this.nodes.input=document.createElement("input"),this.nodes.input.placeholder=this.i18n.t("Add a link"),this.nodes.input.classList.add(this.CSS.input),this.nodes.input.addEventListener("keydown",function(e){e.keyCode===t.ENTER_KEY&&t.enterPressed(e)}),this.nodes.input}},{key:"surround",value:function(e){if(e){this.inputOpened?(this.selection.restore(),this.selection.removeFakeBackground()):(this.selection.setFakeBackground(),this.selection.save());e=this.selection.findParentTag("A");if(e)return this.selection.expandToTag(e),this.unlink(),this.closeActions(),this.checkState(),void this.toolbar.close()}this.toggleActions()}},{key:"checkState",value:function(){var e,t=this.selection.findParentTag("A");return t?(this.nodes.button.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M15.7795 11.5C15.7795 11.5 16.053 11.1962 16.5497 10.6722C17.4442 9.72856 17.4701 8.2475 16.5781 7.30145V7.30145C15.6482 6.31522 14.0873 6.29227 13.1288 7.25073L11.8796 8.49999"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8.24517 12.3883C8.24517 12.3883 7.97171 12.6922 7.47504 13.2161C6.58051 14.1598 6.55467 15.6408 7.44666 16.5869V16.5869C8.37653 17.5731 9.93744 17.5961 10.8959 16.6376L12.1452 15.3883"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M17.7802 15.1032L16.597 14.9422C16.0109 14.8624 15.4841 15.3059 15.4627 15.8969L15.4199 17.0818"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M6.39064 9.03238L7.58432 9.06668C8.17551 9.08366 8.6522 8.58665 8.61056 7.99669L8.5271 6.81397"/><line x1="12.1142" x2="11.7" y1="12.2" y2="11.7858" stroke="currentColor" stroke-linecap="round" stroke-width="2"/></svg>',this.nodes.button.classList.add(this.CSS.buttonUnlink),this.nodes.button.classList.add(this.CSS.buttonActive),this.openActions(),e=t.getAttribute("href"),this.nodes.input.value="null"!==e?e:"",this.selection.save()):(this.nodes.button.innerHTML=Ve,this.nodes.button.classList.remove(this.CSS.buttonUnlink),this.nodes.button.classList.remove(this.CSS.buttonActive)),!!t}},{key:"clear",value:function(){this.closeActions()}},{key:"shortcut",get:function(){return"CMD+K"}},{key:"toggleActions",value:function(){this.inputOpened?this.closeActions(!1):this.openActions(!0)}},{key:"openActions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.nodes.input.classList.add(this.CSS.inputShowed),e&&this.nodes.input.focus(),this.inputOpened=!0}},{key:"closeActions",value:function(){var e,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.selection.isFakeBackgroundEnabled&&((e=new C).save(),this.selection.restore(),this.selection.removeFakeBackground(),e.restore()),this.nodes.input.classList.remove(this.CSS.inputShowed),this.nodes.input.value="",t&&this.selection.clearSaved(),this.inputOpened=!1}},{key:"enterPressed",value:function(e){var t=this.nodes.input.value||"";t.trim()?this.validateURL(t)?(t=this.prepareLink(t),this.selection.restore(),this.selection.removeFakeBackground(),this.insertLink(t),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.selection.collapseToEnd(),this.inlineToolbar.close()):(this.notifier.show({message:"Pasted link is not valid.",style:"error"}),u("Incorrect Link pasted","warn",t)):(this.selection.restore(),this.unlink(),e.preventDefault(),this.closeActions())}},{key:"validateURL",value:function(e){return!/\s/.test(e)}},{key:"prepareLink",value:function(e){return e=e.trim(),e=this.addProtocol(e)}},{key:"addProtocol",value:function(e){var t,n,o;return e=/^(\w+):(\/\/)?/.test(e)||(t=/^\/[^/\s]/.test(e),n="#"===e.substring(0,1),o=/^\/\/[^/\s]/.test(e),t)||n||o?e:"http://"+e}},{key:"insertLink",value:function(e){var t=this.selection.findParentTag("A");t&&this.selection.expandToTag(t),document.execCommand(this.commandLink,!1,e)}},{key:"unlink",value:function(){document.execCommand(this.commandUnlink)}}],[{key:"sanitize",get:function(){return{a:{href:!0,target:"_blank",rel:"nofollow"}}}}]))()),Xt=(Vt.isInline=!0,Vt.title="Link",(()=>_createClass(function e(t){var n=t.data,t=t.api;_classCallCheck(this,e),this.CSS={wrapper:"ce-stub",info:"ce-stub__info",title:"ce-stub__title",subtitle:"ce-stub__subtitle"},this.api=t,this.title=n.title||this.api.i18n.t("Error"),this.subtitle=this.api.i18n.t("The block can not be displayed correctly."),this.savedData=n.savedData,this.wrapper=this.make()},[{key:"render",value:function(){return this.wrapper}},{key:"save",value:function(){return this.savedData}},{key:"make",value:function(){var e=b.make("div",this.CSS.wrapper),t=b.make("div",this.CSS.info),n=b.make("div",this.CSS.title,{textContent:this.title}),o=b.make("div",this.CSS.subtitle,{textContent:this.subtitle});return e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><rect width="14" height="14" x="5" y="5" stroke="currentColor" stroke-width="2" rx="4"/><line x1="12" x2="12" y1="9" y2="12" stroke="currentColor" stroke-linecap="round" stroke-width="2"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M12 15.02V15.01"/></svg>',t.appendChild(n),t.appendChild(o),e.appendChild(t),e}}]))()),Zt=(Xt.isReadOnlySupported=!0,(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).type=bt.Inline,e}return _inherits(t,St),_createClass(t,[{key:"title",get:function(){return this.constructable[Ct.Title]}},{key:"create",value:function(){return new this.constructable({api:this.api.getMethodsForTool(this),config:this.settings})}}])})()),$t=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).type=bt.Tune,e}return _inherits(t,St),_createClass(t,[{key:"create",value:function(e,t){return new this.constructable({api:this.api.getMethodsForTool(this),config:this.settings,block:t,data:e})}}])})(),R=(()=>{function e(){return _classCallCheck(this,e),_callSuper(this,e,arguments)}return _inherits(e,_wrapNativeSuper(Map)),_createClass(e,[{key:"blockTools",get:function(){return new e(Array.from(this.entries()).filter(function(e){return _slicedToArray(e,2)[1].isBlock()}))}},{key:"inlineTools",get:function(){return new e(Array.from(this.entries()).filter(function(e){return _slicedToArray(e,2)[1].isInline()}))}},{key:"blockTunes",get:function(){return new e(Array.from(this.entries()).filter(function(e){return _slicedToArray(e,2)[1].isTune()}))}},{key:"internalTools",get:function(){return new e(Array.from(this.entries()).filter(function(e){return _slicedToArray(e,2)[1].isInternal}))}},{key:"externalTools",get:function(){return new e(Array.from(this.entries()).filter(function(e){return!_slicedToArray(e,2)[1].isInternal}))}}])})(),Qt=Object.defineProperty,Jt=Object.getOwnPropertyDescriptor,en=function(e,t,n,o){for(var r,i=1<o?void 0:o?Jt(t,n):t,s=e.length-1;0<=s;s--)(r=e[s])&&(i=(o?r(t,n,i):r(i))||i);return o&&i&&Qt(t,n,i),i},tn=(()=>{function i(){var e;return _classCallCheck(this,i),(e=_callSuper(this,i,arguments)).type=bt.Block,e.inlineTools=new R,e.tunes=new R,e}return _inherits(i,St),_createClass(i,[{key:"create",value:function(e,t,n){return new this.constructable({data:e,block:t,readOnly:n,api:this.api.getMethodsForTool(this),config:this.settings})}},{key:"isReadOnlySupported",get:function(){return!0===this.constructable[xt.IsReadOnlySupported]}},{key:"isLineBreaksEnabled",get:function(){return this.constructable[xt.IsEnabledLineBreaks]}},{key:"toolbox",get:function(){var n=this.constructable[xt.Toolbox],e=this.config[yt.Toolbox];if(!v(n)&&!1!==e)return e?Array.isArray(n)?Array.isArray(e)?e.map(function(e,t){t=n[t];return t?_objectSpread(_objectSpread({},t),e):e}):[e]:Array.isArray(e)?e:[_objectSpread(_objectSpread({},n),e)]:Array.isArray(n)?n:[n]}},{key:"conversionConfig",get:function(){return this.constructable[xt.ConversionConfig]}},{key:"enabledInlineTools",get:function(){return this.config[yt.EnabledInlineTools]||!1}},{key:"enabledBlockTunes",get:function(){return this.config[yt.EnabledBlockTunes]}},{key:"pasteConfig",get:function(){var e;return null!=(e=this.constructable[xt.PasteConfig])?e:{}}},{key:"sanitizeConfig",get:function(){var e=_superPropGet(i,"sanitizeConfig",this,1),t=this.baseSanitizeConfig;if(v(e))return t;var n,o,r={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(f(o=e[n])?r[n]=Object.assign({},t,o):r[n]=o);return r}},{key:"baseSanitizeConfig",get:function(){var t={};return Array.from(this.inlineTools.values()).forEach(function(e){return Object.assign(t,e.sanitizeConfig)}),Array.from(this.tunes.values()).forEach(function(e){return Object.assign(t,e.sanitizeConfig)}),t}}])})(),nn=(en([e],tn.prototype,"sanitizeConfig",1),en([e],tn.prototype,"baseSanitizeConfig",1),(()=>_createClass(function e(t,n,o){_classCallCheck(this,e),this.api=o,this.config=t,this.editorConfig=n},[{key:"get",value:function(e){var t=this.config[e],n=t.class,o=t.isInternal,o=void 0!==o&&o,t=_objectWithoutProperties(t,_excluded);return new(this.getConstructor(n))({name:e,constructable:n,config:t,api:this.api,isDefault:e===this.editorConfig.defaultBlock,defaultPlaceholder:this.editorConfig.placeholder,isInternal:o})}},{key:"getConstructor",value:function(e){switch(!0){case e[Ct.IsInline]:return Zt;case e[_t.IsTune]:return $t;default:return tn}}}]))()),on=(()=>_createClass(function e(t){t=t.api;_classCallCheck(this,e),this.CSS={animation:"wobble"},this.api=t},[{key:"render",value:function(){var e=this;return{icon:Ye,title:this.api.i18n.t("Move down"),onActivate:function(){return e.handleClick()},name:"move-down"}}},{key:"handleClick",value:function(){var e=this.api.blocks.getCurrentBlockIndex(),t=this.api.blocks.getBlockByIndex(e+1);if(!t)throw new Error("Unable to move Block down since it is already the last");var t=t.holder,n=t.getBoundingClientRect(),o=Math.abs(window.innerHeight-t.offsetHeight);n.top<window.innerHeight&&(o=window.scrollY+t.offsetHeight),window.scrollTo(0,o),this.api.blocks.move(e+1),this.api.toolbar.toggleBlockSettings(!0)}}]))(),rn=(on.isTune=!0,(()=>_createClass(function e(t){t=t.api;_classCallCheck(this,e),this.api=t},[{key:"render",value:function(){var e=this;return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M8 8L12 12M12 12L16 16M12 12L16 8M12 12L8 16"/></svg>',title:this.api.i18n.t("Delete"),name:"delete",confirmation:{title:this.api.i18n.t("Click to delete"),onActivate:function(){return e.handleClick()}}}}},{key:"handleClick",value:function(){this.api.blocks.delete()}}]))()),sn=(rn.isTune=!0,(()=>_createClass(function e(t){t=t.api;_classCallCheck(this,e),this.CSS={animation:"wobble"},this.api=t},[{key:"render",value:function(){var e=this;return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M7 15L11.8586 10.1414C11.9367 10.0633 12.0633 10.0633 12.1414 10.1414L17 15"/></svg>',title:this.api.i18n.t("Move up"),onActivate:function(){return e.handleClick()},name:"move-up"}}},{key:"handleClick",value:function(){var e=this.api.blocks.getCurrentBlockIndex(),t=this.api.blocks.getBlockByIndex(e),n=this.api.blocks.getBlockByIndex(e-1);if(0===e||!t||!n)throw new Error("Unable to move Block up since it is already the first");t=t.holder,n=n.holder,t=t.getBoundingClientRect(),n=n.getBoundingClientRect(),t=0<n.top?Math.abs(t.top)-Math.abs(n.top):Math.abs(t.top)+n.height;window.scrollBy(0,-1*t),this.api.blocks.move(e-1),this.api.toolbar.toggleBlockSettings(!0)}}]))()),an=(sn.isTune=!0,Object.defineProperty),ln=Object.getOwnPropertyDescriptor,cn=(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).stubTool="stub",e.toolsAvailable=new R,e.toolsUnavailable=new R,e}return _inherits(t,x),_createClass(t,[{key:"available",get:function(){return this.toolsAvailable}},{key:"unavailable",get:function(){return this.toolsUnavailable}},{key:"inlineTools",get:function(){return this.available.inlineTools}},{key:"blockTools",get:function(){return this.available.blockTools}},{key:"blockTunes",get:function(){return this.available.blockTunes}},{key:"defaultTool",get:function(){return this.blockTools.get(this.config.defaultBlock)}},{key:"internal",get:function(){return this.available.internalTools}},{key:"prepare",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.validateTools(),this.config.tools=te({},this.internalTools,this.config.tools),Object.prototype.hasOwnProperty.call(this.config,"tools")&&0!==Object.keys(this.config.tools).length){e.next=2;break}throw Error("Can't start without tools");case 2:if(t=this.prepareConfig(),this.factory=new nn(t,this.config,this.Editor.API),0===(t=this.getListOfPrepareFunctions(t)).length)return e.abrupt("return",Promise.resolve());e.next=7;break;case 7:return e.next=9,function(){return Z.apply(this,arguments)}(t,function(e){n.toolPrepareMethodSuccess(e)},function(e){n.toolPrepareMethodFallback(e)});case 9:this.prepareBlockTools();case 10:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"getAllInlineToolsSanitizeConfig",value:function(){var t={};return Array.from(this.inlineTools.values()).forEach(function(e){Object.assign(t,e.sanitizeConfig)}),t}},{key:"destroy",value:function(){Object.values(this.available).forEach((()=>{var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=p(t.reset),e.t0)return e.next=4,t.reset();e.next=4;break;case 4:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}})())}},{key:"internalTools",get:function(){return{bold:{class:Wt,isInternal:!0},italic:{class:Yt,isInternal:!0},link:{class:Vt,isInternal:!0},paragraph:{class:Kt,inlineToolbar:!0,isInternal:!0},stub:{class:Xt,isInternal:!0},moveUp:{class:sn,isInternal:!0},delete:{class:rn,isInternal:!0},moveDown:{class:on,isInternal:!0}}}},{key:"toolPrepareMethodSuccess",value:function(e){var t=this.factory.get(e.toolName);if(t.isInline()){e=["render","surround","checkState"].filter(function(e){return!t.create()[e]});if(e.length)return u("Incorrect Inline Tool: ".concat(t.name,". Some of required methods is not implemented %o"),"warn",e),void this.toolsUnavailable.set(t.name,t)}this.toolsAvailable.set(t.name,t)}},{key:"toolPrepareMethodFallback",value:function(e){this.toolsUnavailable.set(e.toolName,this.factory.get(e.toolName))}},{key:"getListOfPrepareFunctions",value:function(e){var n=[];return Object.entries(e).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];n.push({function:p(e.class.prepare)?e.class.prepare:function(){},data:{toolName:t,config:e.config}})}),n}},{key:"prepareBlockTools",value:function(){var t=this;Array.from(this.blockTools.values()).forEach(function(e){t.assignInlineToolsToBlockTool(e),t.assignBlockTunesToBlockTool(e)})}},{key:"assignInlineToolsToBlockTool",value:function(e){var t=this;!1!==this.config.inlineToolbar&&(!0===e.enabledInlineTools?e.inlineTools=new R(Array.isArray(this.config.inlineToolbar)?this.config.inlineToolbar.map(function(e){return[e,t.inlineTools.get(e)]}):Array.from(this.inlineTools.entries())):Array.isArray(e.enabledInlineTools)&&(e.inlineTools=new R(e.enabledInlineTools.map(function(e){return[e,t.inlineTools.get(e)]}))))}},{key:"assignBlockTunesToBlockTool",value:function(e){var t,n=this;!1!==e.enabledBlockTunes&&(Array.isArray(e.enabledBlockTunes)?(t=new R(e.enabledBlockTunes.map(function(e){return[e,n.blockTunes.get(e)]})),e.tunes=new R([].concat(_toConsumableArray(t),_toConsumableArray(this.blockTunes.internalTools)))):Array.isArray(this.config.tunes)?(t=new R(this.config.tunes.map(function(e){return[e,n.blockTunes.get(e)]})),e.tunes=new R([].concat(_toConsumableArray(t),_toConsumableArray(this.blockTunes.internalTools)))):e.tunes=this.blockTunes.internalTools)}},{key:"validateTools",value:function(){for(var e in this.config.tools)if(Object.prototype.hasOwnProperty.call(this.config.tools,e)){if(e in this.internalTools)return;var t=this.config.tools[e];if(!p(t)&&!p(t.class))throw Error("Tool «".concat(e,"» must be a constructor function or an object with function in the «class» property"))}}},{key:"prepareConfig",value:function(){var e,t={};for(e in this.config.tools)f(this.config.tools[e])?t[e]=this.config.tools[e]:t[e]={class:this.config.tools[e]};return t}}]);var e})(),un=[e],dn=cn.prototype,hn="getAllInlineToolsSanitizeConfig",pn=1,N=1<pn?void 0:pn?ln(dn,hn):dn,fn=un.length-1;0<=fn;fn--)(qt=un[fn])&&(N=(pn?qt(dn,hn,N):qt(N))||N);pn&&N&&an(dn,hn,N);var gn={BlocksAPI:o,CaretAPI:ge,EventsAPI:ve,I18nAPI:me,API:ke,InlineToolbarAPI:be,ListenersAPI:ye,NotifierAPI:xe,ReadOnlyAPI:Te,SanitizerAPI:Ie,SaverAPI:Ne,SelectionAPI:Pe,StylesAPI:De,ToolbarAPI:je,TooltipAPI:He,UiAPI:Ke,BlockSettings:ct,ConversionToolbar:et,Toolbar:t,InlineToolbar:O,BlockEvents:Et,BlockManager:Mt,BlockSelection:Ot,Caret:Rt,CrossBlockSelection:Nt,DragNDrop:Pt,ModificationsObserver:Dt,Paste:Ft,ReadOnly:Ht,RectangleSelection:zt,Renderer:Ut,Saver:Gt,Tools:cn,UI:(()=>{function t(){var e;return _classCallCheck(this,t),(e=_callSuper(this,t,arguments)).isMobile=!1,e.contentRectCache=void 0,e.resizeDebouncer=J(function(){e.windowResize()},200),e}return _inherits(t,x),_createClass(t,[{key:"CSS",get:function(){return{editorWrapper:"codex-editor",editorWrapperNarrow:"codex-editor--narrow",editorZone:"codex-editor__redactor",editorZoneHidden:"codex-editor__redactor--hidden",editorEmpty:"codex-editor--empty",editorRtlFix:"codex-editor--rtl"}}},{key:"contentRect",get:function(){var e;return this.contentRectCache||((e=this.nodes.wrapper.querySelector(".".concat(S.CSS.content)))?(this.contentRectCache=e.getBoundingClientRect(),this.contentRectCache):{width:650,left:0,right:0})}},{key:"prepare",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.checkIsMobile(),this.make(),this.loadStyles();case 1:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"toggleReadOnly",value:function(e){var t=this;e?this.disableModuleBindings():window.requestIdleCallback(function(){t.enableModuleBindings()},{timeout:2e3})}},{key:"checkEmptiness",value:function(){var e=this.Editor.BlockManager;this.nodes.wrapper.classList.toggle(this.CSS.editorEmpty,e.isEditorEmpty)}},{key:"someToolbarOpened",get:function(){var e=this.Editor,t=e.Toolbar;return e.BlockSettings.opened||e.InlineToolbar.opened||e.ConversionToolbar.opened||t.toolbox.opened}},{key:"someFlipperButtonFocused",get:function(){return!!this.Editor.Toolbar.toolbox.hasFocus()||Object.entries(this.Editor).filter(function(e){e=_slicedToArray(e,2);e[0];return e[1].flipper instanceof I}).some(function(e){e=_slicedToArray(e,2);e[0];return e[1].flipper.hasFocus()})}},{key:"destroy",value:function(){this.nodes.holder.innerHTML=""}},{key:"closeAllToolbars",value:function(){var e=this.Editor,t=e.Toolbar,n=e.BlockSettings,o=e.InlineToolbar,e=e.ConversionToolbar;n.close(),o.close(),e.close(),t.toolbox.close()}},{key:"checkIsMobile",value:function(){this.isMobile=window.innerWidth<650}},{key:"make",value:function(){this.nodes.holder=b.getHolder(this.config.holder),this.nodes.wrapper=b.make("div",[this.CSS.editorWrapper].concat(_toConsumableArray(this.isRtl?[this.CSS.editorRtlFix]:[]))),this.nodes.redactor=b.make("div",this.CSS.editorZone),this.nodes.holder.offsetWidth<this.contentRect.width&&this.nodes.wrapper.classList.add(this.CSS.editorWrapperNarrow),this.nodes.redactor.style.paddingBottom=this.config.minHeight+"px",this.nodes.wrapper.appendChild(this.nodes.redactor),this.nodes.holder.appendChild(this.nodes.wrapper)}},{key:"loadStyles",value:function(){var e="editor-js-styles";b.get(e)||(e=b.make("style",null,{id:e,textContent:':root{--selectionColor: #e1f2ff;--inlineSelectionColor: #d4ecff;--bg-light: #eff2f5;--grayText: #707684;--color-dark: #1D202B;--color-active-icon: #388AE5;--color-gray-border: rgba(201, 201, 204, .48);--content-width: 650px;--narrow-mode-right-padding: 50px;--toolbox-buttons-size: 26px;--toolbox-buttons-size--mobile: 36px;--icon-size: 20px;--icon-size--mobile: 28px;--block-padding-vertical: .4em;--color-line-gray: #EFF0F1 }.codex-editor{position:relative;-webkit-box-sizing:border-box;box-sizing:border-box;z-index:1}.codex-editor .hide{display:none}.codex-editor__redactor [contenteditable]:empty:after{content:"\\feff"}@media (min-width: 651px){.codex-editor--narrow .codex-editor__redactor{margin-right:50px}}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .codex-editor__redactor{margin-left:50px;margin-right:0}}@media (min-width: 651px){.codex-editor--narrow .ce-toolbar__actions{right:-5px}}.codex-editor-copyable{position:absolute;height:1px;width:1px;top:-400%;opacity:.001}.codex-editor-overlay{position:fixed;top:0px;left:0px;right:0px;bottom:0px;z-index:999;pointer-events:none;overflow:hidden}.codex-editor-overlay__container{position:relative;pointer-events:auto;z-index:0}.codex-editor-overlay__rectangle{position:absolute;pointer-events:none;background-color:#2eaadc33;border:1px solid transparent}.codex-editor svg{max-height:100%}.codex-editor path{stroke:currentColor}.codex-editor ::-moz-selection{background-color:#d4ecff}.codex-editor ::selection{background-color:#d4ecff}.codex-editor--toolbox-opened [contentEditable=true][data-placeholder]:focus:before{opacity:0!important}.ce-scroll-locked{overflow:hidden}.ce-scroll-locked--hard{overflow:hidden;top:calc(-1 * var(--window-scroll-offset));position:fixed;width:100%}.ce-toolbar{position:absolute;left:0;right:0;top:0;-webkit-transition:opacity .1s ease;transition:opacity .1s ease;will-change:opacity,top;display:none}.ce-toolbar--opened{display:block}.ce-toolbar__content{max-width:650px;margin:0 auto;position:relative}.ce-toolbar__plus{color:#1d202b;cursor:pointer;width:26px;height:26px;border-radius:7px;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-ms-flex-negative:0;flex-shrink:0}@media (max-width: 650px){.ce-toolbar__plus{width:36px;height:36px}}@media (hover: hover){.ce-toolbar__plus:hover{background-color:#eff2f5}}.ce-toolbar__plus--active{background-color:#eff2f5;-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.ce-toolbar__plus-shortcut{opacity:.6;word-spacing:-2px;margin-top:5px}@media (max-width: 650px){.ce-toolbar__plus{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;position:static}.ce-toolbar__plus--left-oriented:before{left:15px;margin-left:0}.ce-toolbar__plus--right-oriented:before{left:auto;right:15px;margin-left:0}}.ce-toolbar__actions{position:absolute;right:100%;opacity:0;display:-webkit-box;display:-ms-flexbox;display:flex;padding-right:5px}.ce-toolbar__actions--opened{opacity:1}@media (max-width: 650px){.ce-toolbar__actions{right:auto}}.ce-toolbar__settings-btn{color:#1d202b;width:26px;height:26px;border-radius:7px;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;margin-left:3px;cursor:pointer;user-select:none}@media (max-width: 650px){.ce-toolbar__settings-btn{width:36px;height:36px}}@media (hover: hover){.ce-toolbar__settings-btn:hover{background-color:#eff2f5}}.ce-toolbar__settings-btn--active{background-color:#eff2f5;-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}@media (min-width: 651px){.ce-toolbar__settings-btn{width:24px}}.ce-toolbar__settings-btn--hidden{display:none}@media (max-width: 650px){.ce-toolbar__settings-btn{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;position:static}.ce-toolbar__settings-btn--left-oriented:before{left:15px;margin-left:0}.ce-toolbar__settings-btn--right-oriented:before{left:auto;right:15px;margin-left:0}}.ce-toolbar__plus svg,.ce-toolbar__settings-btn svg{width:24px;height:24px}@media (min-width: 651px){.codex-editor--narrow .ce-toolbar__plus{left:5px}}@media (min-width: 651px){.codex-editor--narrow .ce-toolbox .ce-popover{right:0;left:auto;left:initial}}.ce-inline-toolbar{--y-offset: 8px;position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;opacity:0;visibility:hidden;-webkit-transition:opacity .25s ease;transition:opacity .25s ease;will-change:opacity,left,top;top:0;left:0;z-index:3}.ce-inline-toolbar--left-oriented:before{left:15px;margin-left:0}.ce-inline-toolbar--right-oriented:before{left:auto;right:15px;margin-left:0}.ce-inline-toolbar--showed{opacity:1;visibility:visible}.ce-inline-toolbar [hidden]{display:none!important}.ce-inline-toolbar__toggler-and-button-wrapper{display:-webkit-box;display:-ms-flexbox;display:flex;width:100%;padding:0 6px}.ce-inline-toolbar__buttons{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-inline-toolbar__dropdown{display:-webkit-box;display:-ms-flexbox;display:flex;padding:6px;margin:0 6px 0 -6px;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;border-right:1px solid rgba(201,201,204,.48);-webkit-box-sizing:border-box;box-sizing:border-box}@media (hover: hover){.ce-inline-toolbar__dropdown:hover{background:#eff2f5}}.ce-inline-toolbar__dropdown--hidden{display:none}.ce-inline-toolbar__dropdown-content,.ce-inline-toolbar__dropdown-arrow{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-inline-toolbar__dropdown-content svg,.ce-inline-toolbar__dropdown-arrow svg{width:20px;height:20px}.ce-inline-toolbar__shortcut{opacity:.6;word-spacing:-3px;margin-top:3px}.ce-inline-tool{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;border-radius:0;line-height:normal}.ce-inline-tool svg{width:20px;height:20px}@media (max-width: 650px){.ce-inline-tool svg{width:28px;height:28px}}@media (hover: hover){.ce-inline-tool:hover{background-color:#eff2f5}}.ce-inline-tool--active{color:#388ae5}.ce-inline-tool--focused{background:rgba(34,186,255,.08)!important}.ce-inline-tool--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-inline-tool--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-inline-tool--link .icon--unlink,.ce-inline-tool--unlink .icon--link{display:none}.ce-inline-tool--unlink .icon--unlink{display:inline-block;margin-bottom:-1px}.ce-inline-tool-input{outline:none;border:0;border-radius:0 0 4px 4px;margin:0;font-size:13px;padding:10px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;display:none;font-weight:500;border-top:1px solid rgba(201,201,204,.48);-webkit-appearance:none;font-family:inherit}@media (max-width: 650px){.ce-inline-tool-input{font-size:15px;font-weight:500}}.ce-inline-tool-input::-webkit-input-placeholder{color:#707684}.ce-inline-tool-input::-moz-placeholder{color:#707684}.ce-inline-tool-input:-ms-input-placeholder{color:#707684}.ce-inline-tool-input::-ms-input-placeholder{color:#707684}.ce-inline-tool-input::placeholder{color:#707684}.ce-inline-tool-input--showed{display:block}.ce-conversion-toolbar{position:absolute;background-color:#fff;border:1px solid #E8E8EB;-webkit-box-shadow:0 3px 15px -3px rgba(13,20,33,.13);box-shadow:0 3px 15px -3px #0d142121;border-radius:6px;z-index:2;opacity:0;visibility:hidden;will-change:transform,opacity;-webkit-transition:opacity .1s ease,-webkit-transform .1s ease;transition:opacity .1s ease,-webkit-transform .1s ease;transition:transform .1s ease,opacity .1s ease;transition:transform .1s ease,opacity .1s ease,-webkit-transform .1s ease;-webkit-transform:translateY(-8px);transform:translateY(-8px);left:-1px;width:190px;margin-top:5px;-webkit-box-sizing:content-box;box-sizing:content-box}.ce-conversion-toolbar--left-oriented:before{left:15px;margin-left:0}.ce-conversion-toolbar--right-oriented:before{left:auto;right:15px;margin-left:0}.ce-conversion-toolbar--showed{opacity:1;visibility:visible;-webkit-transform:none;transform:none}.ce-conversion-toolbar [hidden]{display:none!important}.ce-conversion-toolbar__buttons{display:-webkit-box;display:-ms-flexbox;display:flex}.ce-conversion-toolbar__label{color:#707684;font-size:11px;font-weight:500;letter-spacing:.33px;padding:10px 10px 5px;text-transform:uppercase}.ce-conversion-tool{display:-webkit-box;display:-ms-flexbox;display:flex;padding:5px 10px;font-size:14px;line-height:20px;font-weight:500;cursor:pointer;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.ce-conversion-tool--hidden{display:none}.ce-conversion-tool--focused{background:rgba(34,186,255,.08)!important}.ce-conversion-tool--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-conversion-tool--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-conversion-tool:hover{background:#eff2f5}.ce-conversion-tool__icon{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;width:26px;height:26px;-webkit-box-shadow:0 0 0 1px rgba(201,201,204,.48);box-shadow:0 0 0 1px #c9c9cc7a;border-radius:5px;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;background:#fff;-webkit-box-sizing:content-box;box-sizing:content-box;-ms-flex-negative:0;flex-shrink:0;margin-right:10px}.ce-conversion-tool__icon svg{width:20px;height:20px}@media (max-width: 650px){.ce-conversion-tool__icon{width:36px;height:36px;border-radius:8px}.ce-conversion-tool__icon svg{width:28px;height:28px}}.ce-conversion-tool--last{margin-right:0!important}.ce-conversion-tool--active{color:#388ae5!important}.ce-conversion-tool--active{-webkit-animation:bounceIn .75s 1;animation:bounceIn .75s 1;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards}.ce-conversion-tool__secondary-label{color:#707684;font-size:12px;margin-left:auto;white-space:nowrap;letter-spacing:-.1em;padding-right:5px;margin-bottom:-2px;opacity:.6}@media (max-width: 650px){.ce-conversion-tool__secondary-label{display:none}}.ce-settings__button{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;border-radius:3px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;line-height:32px}.ce-settings__button svg{width:20px;height:20px}@media (max-width: 650px){.ce-settings__button svg{width:28px;height:28px}}@media (hover: hover){.ce-settings__button:hover{background-color:#eff2f5}}.ce-settings__button--active{color:#388ae5}.ce-settings__button--focused{background:rgba(34,186,255,.08)!important}.ce-settings__button--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.ce-settings__button--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.ce-settings__button:not(:nth-child(3n+3)){margin-right:3px}.ce-settings__button:nth-child(n+4){margin-top:3px}.ce-settings__button--disabled{cursor:not-allowed!important}.ce-settings__button--disabled{opacity:.3}.ce-settings__button--selected{color:#388ae5}@media (min-width: 651px){.codex-editor--narrow .ce-settings .ce-popover{right:0;left:auto;left:initial}}@-webkit-keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}.ce-block{-webkit-animation:fade-in .3s ease;animation:fade-in .3s ease;-webkit-animation-fill-mode:none;animation-fill-mode:none;-webkit-animation-fill-mode:initial;animation-fill-mode:initial}.ce-block:first-of-type{margin-top:0}.ce-block--selected .ce-block__content{background:#e1f2ff}.ce-block--selected .ce-block__content [contenteditable]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.ce-block--selected .ce-block__content img,.ce-block--selected .ce-block__content .ce-stub{opacity:.55}.ce-block--stretched .ce-block__content{max-width:none}.ce-block__content{position:relative;max-width:650px;margin:0 auto;-webkit-transition:background-color .15s ease;transition:background-color .15s ease}.ce-block--drop-target .ce-block__content:before{content:"";position:absolute;top:100%;left:-20px;margin-top:-1px;height:8px;width:8px;border:solid #388AE5;border-width:1px 1px 0 0;-webkit-transform-origin:right;transform-origin:right;-webkit-transform:rotate(45deg);transform:rotate(45deg)}.ce-block--drop-target .ce-block__content:after{content:"";position:absolute;top:100%;height:1px;width:100%;color:#388ae5;background:repeating-linear-gradient(90deg,#388AE5,#388AE5 1px,#fff 1px,#fff 6px)}.ce-block a{cursor:pointer;-webkit-text-decoration:underline;text-decoration:underline}.ce-block b{font-weight:700}.ce-block i{font-style:italic}@-webkit-keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}20%{-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}60%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes bounceIn{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.9,.9,.9);transform:scale3d(.9,.9,.9)}20%{-webkit-transform:scale3d(1.03,1.03,1.03);transform:scale3d(1.03,1.03,1.03)}60%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@-webkit-keyframes selectionBounce{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}50%{-webkit-transform:scale3d(1.01,1.01,1.01);transform:scale3d(1.01,1.01,1.01)}70%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes selectionBounce{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}50%{-webkit-transform:scale3d(1.01,1.01,1.01);transform:scale3d(1.01,1.01,1.01)}70%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@-webkit-keyframes buttonClicked{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.95,.95,.95);transform:scale3d(.95,.95,.95)}60%{-webkit-transform:scale3d(1.02,1.02,1.02);transform:scale3d(1.02,1.02,1.02)}80%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}@keyframes buttonClicked{0%,20%,40%,60%,80%,to{-webkit-animation-timing-function:cubic-bezier(.215,.61,.355,1);animation-timing-function:cubic-bezier(.215,.61,.355,1)}0%{-webkit-transform:scale3d(.95,.95,.95);transform:scale3d(.95,.95,.95)}60%{-webkit-transform:scale3d(1.02,1.02,1.02);transform:scale3d(1.02,1.02,1.02)}80%{-webkit-transform:scale3d(1,1,1);transform:scaleZ(1)}}.cdx-block{padding:.4em 0}.cdx-block::-webkit-input-placeholder{line-height:normal!important}.cdx-input{border:1px solid rgba(201,201,204,.48);-webkit-box-shadow:inset 0 1px 2px 0 rgba(35,44,72,.06);box-shadow:inset 0 1px 2px #232c480f;border-radius:3px;padding:10px 12px;outline:none;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box}.cdx-input[data-placeholder]:before{position:static!important}.cdx-input[data-placeholder]:before{display:inline-block;width:0;white-space:nowrap;pointer-events:none}.cdx-settings-button{display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;padding:6px 1px;border-radius:3px;cursor:pointer;border:0;outline:none;background-color:transparent;vertical-align:bottom;color:inherit;margin:0;min-width:26px;min-height:26px}.cdx-settings-button svg{width:20px;height:20px}@media (max-width: 650px){.cdx-settings-button svg{width:28px;height:28px}}@media (hover: hover){.cdx-settings-button:hover{background-color:#eff2f5}}.cdx-settings-button--focused{background:rgba(34,186,255,.08)!important}.cdx-settings-button--focused{-webkit-box-shadow:inset 0 0 0px 1px rgba(7,161,227,.08);box-shadow:inset 0 0 0 1px #07a1e314}.cdx-settings-button--focused-animated{-webkit-animation-name:buttonClicked;animation-name:buttonClicked;-webkit-animation-duration:.25s;animation-duration:.25s}.cdx-settings-button--active{color:#388ae5}.cdx-settings-button svg{width:auto;height:auto}@media (max-width: 650px){.cdx-settings-button{width:36px;height:36px;border-radius:8px}}.cdx-loader{position:relative;border:1px solid rgba(201,201,204,.48)}.cdx-loader:before{content:"";position:absolute;left:50%;top:50%;width:18px;height:18px;margin:-11px 0 0 -11px;border:2px solid rgba(201,201,204,.48);border-left-color:#388ae5;border-radius:50%;-webkit-animation:cdxRotation 1.2s infinite linear;animation:cdxRotation 1.2s infinite linear}@-webkit-keyframes cdxRotation{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes cdxRotation{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.cdx-button{padding:13px;border-radius:3px;border:1px solid rgba(201,201,204,.48);font-size:14.9px;background:#fff;-webkit-box-shadow:0 2px 2px 0 rgba(18,30,57,.04);box-shadow:0 2px 2px #121e390a;color:#707684;text-align:center;cursor:pointer}@media (hover: hover){.cdx-button:hover{background:#FBFCFE;-webkit-box-shadow:0 1px 3px 0 rgba(18,30,57,.08);box-shadow:0 1px 3px #121e3914}}.cdx-button svg{height:20px;margin-right:.2em;margin-top:-2px}.ce-stub{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:12px 18px;margin:10px 0;border-radius:10px;background:#eff2f5;border:1px solid #EFF0F1;color:#707684;font-size:14px}.ce-stub svg{width:20px;height:20px}.ce-stub__info{margin-left:14px}.ce-stub__title{font-weight:500;text-transform:capitalize}.codex-editor.codex-editor--rtl{direction:rtl}.codex-editor.codex-editor--rtl .cdx-list{padding-left:0;padding-right:40px}.codex-editor.codex-editor--rtl .ce-toolbar__plus{right:-26px;left:auto}.codex-editor.codex-editor--rtl .ce-toolbar__actions{right:auto;left:-26px}@media (max-width: 650px){.codex-editor.codex-editor--rtl .ce-toolbar__actions{margin-left:0;margin-right:auto;padding-right:0;padding-left:10px}}.codex-editor.codex-editor--rtl .ce-settings{left:5px;right:auto}.codex-editor.codex-editor--rtl .ce-settings:before{right:auto;left:25px}.codex-editor.codex-editor--rtl .ce-settings__button:not(:nth-child(3n+3)){margin-left:3px;margin-right:0}.codex-editor.codex-editor--rtl .ce-conversion-tool__icon{margin-right:0;margin-left:10px}.codex-editor.codex-editor--rtl .ce-inline-toolbar__dropdown{border-right:0px solid transparent;border-left:1px solid rgba(201,201,204,.48);margin:0 -6px 0 6px}.codex-editor.codex-editor--rtl .ce-inline-toolbar__dropdown .icon--toggler-down{margin-left:0;margin-right:4px}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .ce-toolbar__plus{left:0px;right:5px}}@media (min-width: 651px){.codex-editor--narrow.codex-editor--rtl .ce-toolbar__actions{left:-5px}}.cdx-search-field{--icon-margin-right: 10px;background:rgba(232,232,235,.49);border:1px solid rgba(226,226,229,.2);border-radius:6px;padding:2px;display:grid;grid-template-columns:auto auto 1fr;grid-template-rows:auto}.cdx-search-field__icon{width:26px;height:26px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-right:var(--icon-margin-right)}.cdx-search-field__icon svg{width:20px;height:20px;color:#707684}.cdx-search-field__input{font-size:14px;outline:none;font-weight:500;font-family:inherit;border:0;background:transparent;margin:0;padding:0;line-height:22px;min-width:calc(100% - 26px - var(--icon-margin-right))}.cdx-search-field__input::-webkit-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::-moz-placeholder{color:#707684;font-weight:500}.cdx-search-field__input:-ms-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::-ms-input-placeholder{color:#707684;font-weight:500}.cdx-search-field__input::placeholder{color:#707684;font-weight:500}.ce-popover{--border-radius: 6px;--width: 200px;--max-height: 270px;--padding: 6px;--offset-from-target: 8px;--color-border: #e8e8eb;--color-shadow: rgba(13,20,33,.13);--color-background: white;--color-text-primary: black;--color-text-secondary: #707684;--color-border-icon: rgba(201, 201, 204, .48);--color-border-icon-disabled: #EFF0F1;--color-text-icon-active: #388AE5;--color-background-icon-active: rgba(56, 138, 229, .1);--color-background-item-focus: rgba(34, 186, 255, .08);--color-shadow-item-focus: rgba(7, 161, 227, .08);--color-background-item-hover: #eff2f5;--color-background-item-confirm: #E24A4A;--color-background-item-confirm-hover: #CE4343;min-width:var(--width);width:var(--width);max-height:var(--max-height);border-radius:var(--border-radius);overflow:hidden;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 3px 15px -3px var(--color-shadow);box-shadow:0 3px 15px -3px var(--color-shadow);position:absolute;left:0;top:calc(100% + var(--offset-from-target));background:var(--color-background);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;z-index:4;opacity:0;max-height:0;pointer-events:none;padding:0;border:none}.ce-popover--opened{opacity:1;padding:var(--padding);max-height:var(--max-height);pointer-events:auto;-webkit-animation:panelShowing .1s ease;animation:panelShowing .1s ease;border:1px solid var(--color-border)}@media (max-width: 650px){.ce-popover--opened{-webkit-animation:panelShowingMobile .25s ease;animation:panelShowingMobile .25s ease}}.ce-popover__items{overflow-y:auto;-ms-scroll-chaining:none;overscroll-behavior:contain}@media (max-width: 650px){.ce-popover__overlay{position:fixed;top:0;bottom:0;left:0;right:0;background:#1D202B;z-index:3;opacity:.5;-webkit-transition:opacity .12s ease-in;transition:opacity .12s ease-in;will-change:opacity;visibility:visible}}.ce-popover__overlay--hidden{display:none}.ce-popover--open-top{top:calc(-1 * (var(--offset-from-target) + var(--popover-height)))}@media (max-width: 650px){.ce-popover{--offset: 5px;position:fixed;max-width:none;min-width:calc(100% - var(--offset) * 2);left:var(--offset);right:var(--offset);bottom:calc(var(--offset) + env(safe-area-inset-bottom));top:auto;border-radius:10px}.ce-popover .ce-popover__search{display:none}}.ce-popover__search,.ce-popover__custom-content:not(:empty){margin-bottom:5px}.ce-popover__nothing-found-message{color:#707684;display:none;cursor:default;padding:3px;font-size:14px;line-height:20px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ce-popover__nothing-found-message--displayed{display:block}.ce-popover__custom-content:not(:empty){padding:4px}@media (min-width: 651px){.ce-popover__custom-content:not(:empty){padding:0}}.ce-popover__custom-content--hidden{display:none}.ce-popover-item{--border-radius: 6px;--icon-size: 20px;--icon-size-mobile: 28px;border-radius:var(--border-radius);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:3px;color:var(--color-text-primary);-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}@media (max-width: 650px){.ce-popover-item{padding:4px}}.ce-popover-item:not(:last-of-type){margin-bottom:1px}.ce-popover-item__icon{border-radius:5px;width:26px;height:26px;-webkit-box-shadow:0 0 0 1px var(--color-border-icon);box-shadow:0 0 0 1px var(--color-border-icon);background:#fff;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;margin-right:10px}.ce-popover-item__icon svg{width:20px;height:20px}@media (max-width: 650px){.ce-popover-item__icon{width:36px;height:36px;border-radius:8px}.ce-popover-item__icon svg{width:var(--icon-size-mobile);height:var(--icon-size-mobile)}}.ce-popover-item__title{font-size:14px;line-height:20px;font-weight:500;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}@media (max-width: 650px){.ce-popover-item__title{font-size:16px}}.ce-popover-item__secondary-title{color:var(--color-text-secondary);font-size:12px;margin-left:auto;white-space:nowrap;letter-spacing:-.1em;padding-right:5px;margin-bottom:-2px;opacity:.6}@media (max-width: 650px){.ce-popover-item__secondary-title{display:none}}.ce-popover-item--active{background:var(--color-background-icon-active);color:var(--color-text-icon-active)}.ce-popover-item--active .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}.ce-popover-item--disabled{color:var(--color-text-secondary);cursor:default;pointer-events:none}.ce-popover-item--disabled .ce-popover-item__icon{-webkit-box-shadow:0 0 0 1px var(--color-border-icon-disabled);box-shadow:0 0 0 1px var(--color-border-icon-disabled)}.ce-popover-item--focused:not(.ce-popover-item--no-focus){background:var(--color-background-item-focus)!important}.ce-popover-item--focused:not(.ce-popover-item--no-focus){-webkit-box-shadow:inset 0 0 0px 1px var(--color-shadow-item-focus);box-shadow:inset 0 0 0 1px var(--color-shadow-item-focus)}.ce-popover-item--hidden{display:none}@media (hover: hover){.ce-popover-item:hover{cursor:pointer}.ce-popover-item:hover:not(.ce-popover-item--no-hover){background-color:var(--color-background-item-hover)}.ce-popover-item:hover .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}}.ce-popover-item--confirmation{background:var(--color-background-item-confirm)}.ce-popover-item--confirmation .ce-popover-item__icon{color:var(--color-background-item-confirm)}.ce-popover-item--confirmation .ce-popover-item__title{color:#fff}@media (hover: hover){.ce-popover-item--confirmation:not(.ce-popover-item--no-hover):hover{background:var(--color-background-item-confirm-hover)}}.ce-popover-item--confirmation:not(.ce-popover-item--no-focus).ce-popover-item--focused{background:var(--color-background-item-confirm-hover)!important}.ce-popover-item--confirmation .ce-popover-item__icon,.ce-popover-item--active .ce-popover-item__icon,.ce-popover-item--focused .ce-popover-item__icon{-webkit-box-shadow:none;box-shadow:none}@-webkit-keyframes panelShowing{0%{opacity:0;-webkit-transform:translateY(-8px) scale(.9);transform:translateY(-8px) scale(.9)}70%{opacity:1;-webkit-transform:translateY(2px);transform:translateY(2px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes panelShowing{0%{opacity:0;-webkit-transform:translateY(-8px) scale(.9);transform:translateY(-8px) scale(.9)}70%{opacity:1;-webkit-transform:translateY(2px);transform:translateY(2px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@-webkit-keyframes panelShowingMobile{0%{opacity:0;-webkit-transform:translateY(14px) scale(.98);transform:translateY(14px) scale(.98)}70%{opacity:1;-webkit-transform:translateY(-4px);transform:translateY(-4px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes panelShowingMobile{0%{opacity:0;-webkit-transform:translateY(14px) scale(.98);transform:translateY(14px) scale(.98)}70%{opacity:1;-webkit-transform:translateY(-4px);transform:translateY(-4px)}to{-webkit-transform:translateY(0);transform:translateY(0)}}.wobble{-webkit-animation-name:wobble;animation-name:wobble;-webkit-animation-duration:.4s;animation-duration:.4s}@-webkit-keyframes wobble{0%{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-9%,0,0);transform:translate3d(-9%,0,0)}30%{-webkit-transform:translate3d(9%,0,0);transform:translate3d(9%,0,0)}45%{-webkit-transform:translate3d(-4%,0,0);transform:translate3d(-4%,0,0)}60%{-webkit-transform:translate3d(4%,0,0);transform:translate3d(4%,0,0)}75%{-webkit-transform:translate3d(-1%,0,0);transform:translate3d(-1%,0,0)}to{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}}@keyframes wobble{0%{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}15%{-webkit-transform:translate3d(-9%,0,0);transform:translate3d(-9%,0,0)}30%{-webkit-transform:translate3d(9%,0,0);transform:translate3d(9%,0,0)}45%{-webkit-transform:translate3d(-4%,0,0);transform:translate3d(-4%,0,0)}60%{-webkit-transform:translate3d(4%,0,0);transform:translate3d(4%,0,0)}75%{-webkit-transform:translate3d(-1%,0,0);transform:translate3d(-1%,0,0)}to{-webkit-transform:translate3d(0,0,0);transform:translateZ(0)}}\n'.toString()}),this.config.style&&!v(this.config.style)&&this.config.style.nonce&&e.setAttribute("nonce",this.config.style.nonce),b.prepend(document.head,e))}},{key:"enableModuleBindings",value:function(){var t=this,e=(this.readOnlyMutableListeners.on(this.nodes.redactor,"click",function(e){t.redactorClicked(e)},!1),this.readOnlyMutableListeners.on(this.nodes.redactor,"mousedown",function(e){t.documentTouched(e)},{capture:!0,passive:!0}),this.readOnlyMutableListeners.on(this.nodes.redactor,"touchstart",function(e){t.documentTouched(e)},{capture:!0,passive:!0}),this.readOnlyMutableListeners.on(document,"keydown",function(e){t.documentKeydown(e)},!0),this.readOnlyMutableListeners.on(document,"mousedown",function(e){t.documentClicked(e)},!0),J(function(){t.selectionChanged()},180));this.readOnlyMutableListeners.on(document,"selectionchange",e,!0),this.readOnlyMutableListeners.on(window,"resize",function(){t.resizeDebouncer()},{passive:!0}),this.watchBlockHoveredEvents()}},{key:"watchBlockHoveredEvents",value:function(){var t,n=this;this.readOnlyMutableListeners.on(this.nodes.redactor,"mousemove",ee(function(e){e=e.target.closest(".ce-block");n.Editor.BlockSelection.anyBlockSelected||e&&t!==e&&(t=e,n.eventsDispatcher.emit(mt,{block:n.Editor.BlockManager.getBlockByChildNode(e)}))},20),{passive:!0})}},{key:"disableModuleBindings",value:function(){this.readOnlyMutableListeners.clearAll()}},{key:"windowResize",value:function(){this.contentRectCache=null,this.checkIsMobile()}},{key:"documentKeydown",value:function(e){switch(e.keyCode){case a:this.enterPressed(e);break;case H:case q:this.backspacePressed(e);break;case z:this.escapePressed(e);break;default:this.defaultBehaviour(e)}}},{key:"defaultBehaviour",value:function(e){var t=this.Editor.BlockManager.currentBlock,n=e.target.closest(".".concat(this.CSS.editorWrapper)),o=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;void 0!==t&&null===n?this.Editor.BlockEvents.keydown(e):n||t&&o||(this.Editor.BlockManager.dropPointer(),this.Editor.Toolbar.close())}},{key:"backspacePressed",value:function(e){var t,n=this.Editor,o=n.BlockManager,r=n.BlockSelection,n=n.Caret;r.anyBlockSelected&&!C.isSelectionExists&&(t=o.removeSelectedBlocks(),o=o.insertDefaultBlockAtIndex(t,!0),n.setToBlock(o,n.positions.START),r.clearSelection(e),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())}},{key:"escapePressed",value:function(e){this.Editor.BlockSelection.clearSelection(e),this.Editor.Toolbar.toolbox.opened?(this.Editor.Toolbar.toolbox.close(),this.Editor.Caret.setToBlock(this.Editor.BlockManager.currentBlock,this.Editor.Caret.positions.END)):(this.Editor.BlockSettings.opened?this.Editor.BlockSettings:this.Editor.ConversionToolbar.opened?this.Editor.ConversionToolbar:this.Editor.InlineToolbar.opened?this.Editor.InlineToolbar:this.Editor.Toolbar).close()}},{key:"enterPressed",value:function(e){var t=this.Editor,n=t.BlockManager,t=t.BlockSelection,n=0<=n.currentBlockIndex;t.anyBlockSelected&&!C.isSelectionExists?(t.clearSelection(e),e.preventDefault(),e.stopImmediatePropagation(),e.stopPropagation()):(!this.someToolbarOpened&&n&&"BODY"===e.target.tagName&&(t=this.Editor.BlockManager.insert(),this.Editor.Caret.setToBlock(t),this.Editor.Toolbar.moveAndOpen(t)),this.Editor.BlockSelection.clearSelection(e))}},{key:"documentClicked",value:function(e){var t,n,o;e.isTrusted&&(this.nodes.holder.contains(t=e.target)||C.isAtEditor||(this.Editor.BlockManager.dropPointer(),this.Editor.Toolbar.close()),o=null==(o=this.Editor.BlockSettings.nodes.wrapper)?void 0:o.contains(t),n=null==(n=this.Editor.Toolbar.nodes.settingsToggler)?void 0:n.contains(t),this.Editor.BlockSettings.opened&&!(o||n)&&(this.Editor.BlockSettings.close(),o=this.Editor.BlockManager.getBlockByChildNode(t),this.Editor.Toolbar.moveAndOpen(o)),this.Editor.BlockSelection.clearSelection(e))}},{key:"documentTouched",value:function(e){var t,n=e.target;n===this.nodes.redactor&&(t=(e instanceof MouseEvent?e:e.touches[0]).clientX,e=(e instanceof MouseEvent?e:e.touches[0]).clientY,n=document.elementFromPoint(t,e));try{this.Editor.BlockManager.setCurrentBlockByChildNode(n)}catch(e){this.Editor.RectangleSelection.isRectActivated()||this.Editor.Caret.setToTheLastBlock()}this.Editor.Toolbar.moveAndOpen()}},{key:"redactorClicked",value:function(e){var t,n;C.isCollapsed&&(t=e.target,n=e.metaKey||e.ctrlKey,b.isAnchor(t)&&n?(e.stopImmediatePropagation(),e.stopPropagation(),n=(e=>{try{return new URL(e).href}catch(e){}return"//"===e.substring(0,2)?window.location.protocol+e:window.location.origin+e})(t.getAttribute("href")),window.open(n,"_blank")):this.processBottomZoneClick(e))}},{key:"processBottomZoneClick",value:function(e){var t=this.Editor.BlockManager.getBlockByIndex(-1),t=b.offset(t.holder).bottom,n=e.pageY,o=this.Editor.BlockSelection;e.target instanceof Element&&e.target.isEqualNode(this.nodes.redactor)&&!o.anyBlockSelected&&t<n&&(e.stopImmediatePropagation(),e.stopPropagation(),t=(o=this.Editor).BlockManager,n=o.Caret,e=o.Toolbar,t.lastBlock.tool.isDefault&&t.lastBlock.isEmpty||t.insertAtEnd(),n.setToTheLastBlock(),e.moveAndOpen(t.lastBlock))}},{key:"selectionChanged",value:function(){var e=this.Editor,t=e.CrossBlockSelection,n=C.anchorElement;t.isCrossBlockSelectionStarted&&e.BlockSelection.anyBlockSelected&&C.get().removeAllRanges(),n?(t=null===n.closest(".".concat(S.CSS.content)))&&(this.Editor.InlineToolbar.containsNode(n)||this.Editor.InlineToolbar.close(),"true"!==n.dataset.inlineToolbar)||(this.Editor.BlockManager.currentBlock||this.Editor.BlockManager.setCurrentBlockByChildNode(n),this.Editor.InlineToolbar.tryToShow(!0,!0!=t)):C.range||this.Editor.InlineToolbar.close()}}]);var e})()},vn=(()=>{return _createClass(function e(i){var s,n,a=this;_classCallCheck(this,e),this.moduleInstances={},this.eventsDispatcher=new se,this.isReady=new Promise(function(e,t){s=e,n=t}),Promise.resolve().then(_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,o,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.configuration=i,a.validate(),a.init(),e.next=5,a.start();case 5:return e.next=7,a.render();case 7:r=a.moduleInstances,t=r.BlockManager,n=r.Caret,o=r.UI,r=r.ModificationsObserver,o.checkEmptiness(),r.enable(),a.configuration.autofocus&&n.setToBlock(t.blocks[0],n.positions.START),s();case 9:case"end":return e.stop()}},e)}))).catch(function(e){u("Editor.js is not ready because of ".concat(e),"error"),n(e)})},[{key:"configuration",get:function(){return this.config},set:function(e){f(e)?this.config=_objectSpread({},e):this.config={holder:e},oe(!!this.config.holderId,"config.holderId","config.holder"),this.config.holderId&&!this.config.holder&&(this.config.holder=this.config.holderId,this.config.holderId=null),null==this.config.holder&&(this.config.holder="editorjs"),this.config.logLevel||(this.config.logLevel=F.VERBOSE),e=this.config.logLevel,W.logLevel=e,oe(!!this.config.initialBlock,"config.initialBlock","config.defaultBlock"),this.config.defaultBlock=this.config.defaultBlock||this.config.initialBlock||"paragraph",this.config.minHeight=void 0!==this.config.minHeight?this.config.minHeight:300;var e={type:this.config.defaultBlock,data:{}};this.config.placeholder=this.config.placeholder||!1,this.config.sanitizer=this.config.sanitizer||{p:!0,b:!0,a:!0},this.config.hideToolbar=this.config.hideToolbar||!1,this.config.tools=this.config.tools||{},this.config.i18n=this.config.i18n||{},this.config.data=this.config.data||{blocks:[]},this.config.onReady=this.config.onReady||function(){},this.config.onChange=this.config.onChange||function(){},this.config.inlineToolbar=void 0===this.config.inlineToolbar||this.config.inlineToolbar,!v(this.config.data)&&this.config.data.blocks&&0!==this.config.data.blocks.length||(this.config.data={blocks:[e]}),this.config.readOnly=this.config.readOnly||!1,null!=(e=this.config.i18n)&&e.messages&&y.setDictionary(this.config.i18n.messages),this.config.i18n.direction=(null==(e=this.config.i18n)?void 0:e.direction)||"ltr"}},{key:"validate",value:function(){var e=this.config,t=e.holderId,e=e.holder;if(t&&e)throw Error("«holderId» and «holder» param can't assign at the same time.");if(g(e)&&!b.get(e))throw Error("element with ID «".concat(e,"» is missing. Pass correct holder's ID."));if(e&&f(e)&&!b.isElement(e))throw Error("«holder» value must be an Element node")}},{key:"init",value:function(){this.constructModules(),this.configureModules()}},{key:"start",value:(e=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var n=this;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,["Tools","UI","BlockManager","Paste","BlockSelection","RectangleSelection","CrossBlockSelection","ReadOnly"].reduce(function(e,t){return e.then(_asyncToGenerator(_regeneratorRuntime().mark(function e(){return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.moduleInstances[t].prepare();case 3:e.next=10;break;case 5:if(e.prev=5,e.t0=e.catch(0),e.t0 instanceof ie)throw new Error(e.t0.message);e.next=9;break;case 9:u("Module ".concat(t," was skipped because of %o"),"warn",e.t0);case 10:case"end":return e.stop()}},e,null,[[0,5]])})))},Promise.resolve());case 2:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)})},{key:"render",value:function(){return this.moduleInstances.Renderer.render(this.config.data.blocks)}},{key:"constructModules",value:function(){var n=this;Object.entries(gn).forEach(function(e){var e=_slicedToArray(e,2),t=e[0],e=e[1];try{n.moduleInstances[t]=new e({config:n.configuration,eventsDispatcher:n.eventsDispatcher})}catch(e){u("[constructModules]","Module ".concat(t," skipped because"),"error",e)}})}},{key:"configureModules",value:function(){for(var e in this.moduleInstances)Object.prototype.hasOwnProperty.call(this.moduleInstances,e)&&(this.moduleInstances[e].state=this.getModulesDiff(e))}},{key:"getModulesDiff",value:function(e){var t,n={};for(t in this.moduleInstances)t!==e&&(n[t]=this.moduleInstances[t]);return n}}]);var e})();return(()=>_createClass(function e(t){var n=this,o=(_classCallCheck(this,e),function(){}),r=(f(t)&&p(t.onReady)&&(o=t.onReady),new vn(t));this.isReady=r.isReady.then(function(){n.exportAPI(r),o()})},[{key:"exportAPI",value:function(o){var r=this;["configuration"].forEach(function(e){r[e]=o[e]}),this.destroy=function(){for(var e in Object.values(o.moduleInstances).forEach(function(e){p(e.destroy)&&e.destroy(),e.listeners.removeAll()}),null!=i&&i.destroy(),o=i=null,r)Object.prototype.hasOwnProperty.call(r,e)&&delete r[e];Object.setPrototypeOf(r,null)},Object.setPrototypeOf(this,o.moduleInstances.API.methods),delete this.exportAPI,Object.entries({blocks:{clear:"clear",render:"render"},caret:{focus:"focus"},events:{on:"on",off:"off",emit:"emit"},saver:{save:"save"}}).forEach(function(e){var e=_slicedToArray(e,2),n=e[0];Object.entries(e[1]).forEach(function(e){var e=_slicedToArray(e,2),t=e[0];r[e[1]]=o.moduleInstances.API.methods[n][t]})})}}],[{key:"version",get:function(){return"2.29.1"}}]))()}),(e=>{"function"==typeof define&&define.amd?define(["jquery"],e):"object"==("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=e(require("jquery")):e(jQuery)})(function(u){u.extend(u.fn,{validate:function(e){var o;if(this.length)return(o=u.data(this[0],"validator"))||(this.attr("novalidate","novalidate"),o=new u.validator(e,this[0]),u.data(this[0],"validator",o),o.settings.onsubmit&&(this.on("click.validate",":submit",function(e){o.submitButton=e.currentTarget,u(this).hasClass("cancel")&&(o.cancelSubmit=!0),void 0!==u(this).attr("formnovalidate")&&(o.cancelSubmit=!0)}),this.on("submit.validate",function(n){function e(){var e,t;return o.submitButton&&(o.settings.submitHandler||o.formSubmitted)&&(e=u("<input type='hidden'/>").attr("name",o.submitButton.name).val(u(o.submitButton).val()).appendTo(o.currentForm)),!(o.settings.submitHandler&&!o.settings.debug)||(t=o.settings.submitHandler.call(o,o.currentForm,n),e&&e.remove(),void 0!==t&&t)}return o.settings.debug&&n.preventDefault(),o.cancelSubmit?(o.cancelSubmit=!1,e()):o.form()?o.pendingRequest?!(o.formSubmitted=!0):e():(o.focusInvalid(),!1)})),o);e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing.")},valid:function(){var e,t,n;return u(this[0]).is("form")?e=this.validate().form():(n=[],e=!0,t=u(this[0].form).validate(),this.each(function(){(e=t.element(this)&&e)||(n=n.concat(t.errorList))}),t.errorList=n),e},rules:function(e,t){var n,o,r,i,s,a=this[0],l=void 0!==this.attr("contenteditable")&&"false"!==this.attr("contenteditable");if(null!=a&&(!a.form&&l&&(a.form=this.closest("form")[0],a.name=this.attr("name")),null!=a.form)){if(e)switch(n=u.data(a.form,"validator").settings,o=n.rules,r=u.validator.staticRules(a),e){case"add":u.extend(r,u.validator.normalizeRule(t)),delete r.messages,o[a.name]=r,t.messages&&(n.messages[a.name]=u.extend(n.messages[a.name],t.messages));break;case"remove":return t?(s={},u.each(t.split(/\s/),function(e,t){s[t]=r[t],delete r[t]}),s):(delete o[a.name],r)}return(l=u.validator.normalizeRules(u.extend({},u.validator.classRules(a),u.validator.attributeRules(a),u.validator.dataRules(a),u.validator.staticRules(a)),a)).required&&(i=l.required,delete l.required,l=u.extend({required:i},l)),l.remote&&(i=l.remote,delete l.remote,l=u.extend(l,{remote:i})),l}}});function t(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var n;u.extend(u.expr.pseudos||u.expr[":"],{blank:function(e){return!t(""+u(e).val())},filled:function(e){e=u(e).val();return null!==e&&!!t(""+e)},unchecked:function(e){return!u(e).prop("checked")}}),u.validator=function(e,t){this.settings=u.extend(!0,{},u.validator.defaults,e),this.currentForm=t,this.init()},u.validator.format=function(n,e){return 1===arguments.length?function(){var e=u.makeArray(arguments);return e.unshift(n),u.validator.format.apply(this,e)}:(void 0===e||((e=2<arguments.length&&e.constructor!==Array?u.makeArray(arguments).slice(1):e).constructor!==Array&&(e=[e]),u.each(e,function(e,t){n=n.replace(new RegExp("\\{"+e+"\\}","g"),function(){return t})})),n)},u.extend(u.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",pendingClass:"pending",validClass:"valid",errorElement:"label",focusCleanup:!1,focusInvalid:!0,errorContainer:u([]),errorLabelContainer:u([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(e){this.lastActive=e,this.settings.focusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,e,this.settings.errorClass,this.settings.validClass),this.hideThese(this.errorsFor(e)))},onfocusout:function(e){this.checkable(e)||!(e.name in this.submitted)&&this.optional(e)||this.element(e)},onkeyup:function(e,t){9===t.which&&""===this.elementValue(e)||-1!==u.inArray(t.keyCode,[16,17,18,20,35,36,37,38,39,40,45,144,225])||(e.name in this.submitted||e.name in this.invalid)&&this.element(e)},onclick:function(e){e.name in this.submitted?this.element(e):e.parentNode.name in this.submitted&&this.element(e.parentNode)},highlight:function(e,t,n){("radio"===e.type?this.findByName(e.name):u(e)).addClass(t).removeClass(n)},unhighlight:function(e,t,n){("radio"===e.type?this.findByName(e.name):u(e)).removeClass(t).addClass(n)}},setDefaults:function(e){u.extend(u.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",equalTo:"Password does not match.",maxlength:u.validator.format("Please enter no more than {0} characters."),minlength:u.validator.format("Please enter at least {0} characters."),rangelength:u.validator.format("Please enter a value between {0} and {1} characters long."),range:u.validator.format("Please enter a value between {0} and {1}."),max:u.validator.format("Please enter a value less than or equal to {0}."),min:u.validator.format("Please enter a value greater than or equal to {0}."),step:u.validator.format("Please enter a multiple of {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var t,n,o=void 0!==u(this).attr("contenteditable")&&"false"!==u(this).attr("contenteditable");!this.form&&o&&(this.form=u(this).closest("form")[0],this.name=u(this).attr("name")),r===this.form&&(o=u.data(this.form,"validator"),t="on"+e.type.replace(/^validate/,""),(n=o.settings)[t])&&!u(this).is(n.ignore)&&n[t].call(o,this,e)}this.labelContainer=u(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||u(this.currentForm),this.containers=u(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var n,r=this.currentForm,o=this.groups={};u.each(this.settings.groups,function(n,e){"string"==typeof e&&(e=e.split(/\s/)),u.each(e,function(e,t){o[t]=n})}),n=this.settings.rules,u.each(n,function(e,t){n[e]=u.validator.normalizeRule(t)}),u(this.currentForm).on("focusin.validate focusout.validate keyup.validate",":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'], [type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'], [type='radio'], [type='checkbox'], [contenteditable], [type='button']",e).on("click.validate","select, option, [type='radio'], [type='checkbox']",e),this.settings.invalidHandler&&u(this.currentForm).on("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),u.extend(this.submitted,this.errorMap),this.invalid=u.extend({},this.errorMap),this.valid()||u(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var e=0,t=this.currentElements=this.elements();t[e];e++)this.check(t[e]);return this.valid()},element:function(e){var t,n,o=this.clean(e),r=this.validationTargetFor(o),i=this,s=!0;return void 0===r?delete this.invalid[o.name]:(this.prepareElement(r),this.currentElements=u(r),(n=this.groups[r.name])&&u.each(this.groups,function(e,t){t===n&&e!==r.name&&(o=i.validationTargetFor(i.clean(i.findByName(e))))&&o.name in i.invalid&&(i.currentElements.push(o),s=i.check(o)&&s)}),t=!1!==this.check(r),s=s&&t,this.invalid[r.name]=!t,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),u(e).attr("aria-invalid",!t)),s},showErrors:function(t){var n;t&&(u.extend((n=this).errorMap,t),this.errorList=u.map(this.errorMap,function(e,t){return{message:e,element:n.findByName(t)[0]}}),this.successList=u.grep(this.successList,function(e){return!(e.name in t)})),this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){u.fn.resetForm&&u(this.currentForm).resetForm(),this.invalid={},this.submitted={},this.prepareForm(),this.hideErrors();var e=this.elements().removeData("previousValue").removeAttr("aria-invalid");this.resetElements(e)},resetElements:function(e){var t;if(this.settings.unhighlight)for(t=0;e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,""),this.findByName(e[t].name).removeClass(this.settings.validClass);else e.removeClass(this.settings.errorClass).removeClass(this.settings.validClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(e){var t,n=0;for(t in e)null!=e[t]&&!1!==e[t]&&n++;return n},hideErrors:function(){this.hideThese(this.toHide)},hideThese:function(e){e.not(this.containers).text(""),this.addWrapper(e).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{u(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").trigger("focus").trigger("focusin")}catch(e){}},findLastActive:function(){var t=this.lastActive;return t&&1===u.grep(this.errorList,function(e){return e.element.name===t.name}).length&&t},elements:function(){var n=this,o={};return u(this.currentForm).find("input, select, textarea, [contenteditable]").not(":submit, :reset, :image, :disabled").not(this.settings.ignore).filter(function(){var e=this.name||u(this).attr("name"),t=void 0!==u(this).attr("contenteditable")&&"false"!==u(this).attr("contenteditable");return!e&&n.settings.debug&&window.console&&console.error("%o has no name assigned",this),t&&(this.form=u(this).closest("form")[0],this.name=e),this.form===n.currentForm&&!(e in o||!n.objectLength(u(this).rules()))&&(o[e]=!0)})},clean:function(e){return u(e)[0]},errors:function(){var e=this.settings.errorClass.split(" ").join(".");return u(this.settings.errorElement+"."+e,this.errorContext)},resetInternals:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=u([]),this.toHide=u([])},reset:function(){this.resetInternals(),this.currentElements=u([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(e){this.reset(),this.toHide=this.errorsFor(e)},elementValue:function(e){var t=u(e),n=e.type,o=void 0!==t.attr("contenteditable")&&"false"!==t.attr("contenteditable");return"radio"===n||"checkbox"===n?this.findByName(e.name).filter(":checked").val():"number"===n&&void 0!==e.validity?e.validity.badInput?"NaN":t.val():(e=o?t.text():t.val(),"file"===n?"C:\\fakepath\\"===e.substr(0,12)?e.substr(12):0<=(o=e.lastIndexOf("/"))||0<=(o=e.lastIndexOf("\\"))?e.substr(o+1):e:"string"==typeof e?e.replace(/\r/g,""):e)},check:function(t){t=this.validationTargetFor(this.clean(t));var e,n,o,r,i=u(t).rules(),s=u.map(i,function(e,t){return t}).length,a=!1,l=this.elementValue(t);for(n in"function"==typeof i.normalizer?r=i.normalizer:"function"==typeof this.settings.normalizer&&(r=this.settings.normalizer),r&&(l=r.call(t,l),delete i.normalizer),i){o={method:n,parameters:i[n]};try{if("dependency-mismatch"===(e=u.validator.methods[n].call(this,l,t,o.parameters))&&1===s)a=!0;else{if(a=!1,"pending"===e)return void(this.toHide=this.toHide.not(this.errorsFor(t)));if(!e)return this.formatAndAdd(t,o),!1}}catch(e){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+t.id+", check the '"+o.method+"' method.",e),e instanceof TypeError&&(e.message+=".  Exception occurred when checking element "+t.id+", check the '"+o.method+"' method."),e}}if(!a)return this.objectLength(i)&&this.successList.push(t),!0},customDataMessage:function(e,t){return u(e).data("msg"+t.charAt(0).toUpperCase()+t.substring(1).toLowerCase())||u(e).data("msg")},customMessage:function(e,t){e=this.settings.messages[e];return e&&(e.constructor===String?e:e[t])},findDefined:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},defaultMessage:function(e,t){var n=this.findDefined(this.customMessage(e.name,(t="string"==typeof t?{method:t}:t).method),this.customDataMessage(e,t.method),!this.settings.ignoreTitle&&e.title||void 0,u.validator.messages[t.method],"<strong>Warning: No message defined for "+e.name+"</strong>"),o=/\$?\{(\d+)\}/g;return"function"==typeof n?n=n.call(this,t.parameters,e):o.test(n)&&(n=u.validator.format(n.replace(o,"{$1}"),t.parameters)),n},formatAndAdd:function(e,t){var n=this.defaultMessage(e,t);this.errorList.push({message:n,element:e,method:t.method}),this.errorMap[e.name]=n,this.submitted[e.name]=n},addWrapper:function(e){return e=this.settings.wrapper?e.add(e.parent(this.settings.wrapper)):e},defaultShowErrors:function(){for(var e,t,n=0;this.errorList[n];n++)t=this.errorList[n],this.settings.highlight&&this.settings.highlight.call(this,t.element,this.settings.errorClass,this.settings.validClass),this.showLabel(t.element,t.message);if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(n=0;this.successList[n];n++)this.showLabel(this.successList[n]);if(this.settings.unhighlight)for(n=0,e=this.validElements();e[n];n++)this.settings.unhighlight.call(this,e[n],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return u(this.errorList).map(function(){return this.element})},showLabel:function(e,t){var n,o,r,i=this.errorsFor(e),s=this.idOrName(e),a=u(e).attr("aria-describedby");i.length?(i.removeClass(this.settings.validClass).addClass(this.settings.errorClass),i.html(t)):(o=i=u("<"+this.settings.errorElement+">").attr("id",s+"-error").addClass(this.settings.errorClass).html(t||""),this.settings.wrapper&&(o=i.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.length?this.labelContainer.append(o):this.settings.errorPlacement?this.settings.errorPlacement.call(this,o,u(e)):o.insertAfter(e),i.is("label")?i.attr("for",s):0===i.parents("label[for='"+this.escapeCssMeta(s)+"']").length&&(o=i.attr("id"),a?a.match(new RegExp("\\b"+this.escapeCssMeta(o)+"\\b"))||(a+=" "+o):a=o,u(e).attr("aria-describedby",a),n=this.groups[e.name])&&u.each((r=this).groups,function(e,t){t===n&&u("[name='"+r.escapeCssMeta(e)+"']",r.currentForm).attr("aria-describedby",i.attr("id"))})),!t&&this.settings.success&&(i.text(""),"string"==typeof this.settings.success?i.addClass(this.settings.success):this.settings.success(i,e)),this.toShow=this.toShow.add(i)},errorsFor:function(e){var t=this.escapeCssMeta(this.idOrName(e)),e=u(e).attr("aria-describedby"),t="label[for='"+t+"'], label[for='"+t+"'] *";return e&&(t=t+", #"+this.escapeCssMeta(e).replace(/\s+/g,", #")),this.errors().filter(t)},escapeCssMeta:function(e){return void 0===e?"":e.replace(/([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g,"\\$1")},idOrName:function(e){return this.groups[e.name]||!this.checkable(e)&&e.id||e.name},validationTargetFor:function(e){return this.checkable(e)&&(e=this.findByName(e.name)),u(e).not(this.settings.ignore)[0]},checkable:function(e){return/radio|checkbox/i.test(e.type)},findByName:function(e){return u(this.currentForm).find("[name='"+this.escapeCssMeta(e)+"']")},getLength:function(e,t){switch(t.nodeName.toLowerCase()){case"select":return u("option:selected",t).length;case"input":if(this.checkable(t))return this.findByName(t.name).filter(":checked").length}return e.length},depend:function(e,t){return!this.dependTypes[_typeof(e)]||this.dependTypes[_typeof(e)](e,t)},dependTypes:{boolean:function(e){return e},string:function(e,t){return!!u(e,t.form).length},function:function(e,t){return e(t)}},optional:function(e){var t=this.elementValue(e);return!u.validator.methods.required.call(this,t,e)&&"dependency-mismatch"},startRequest:function(e){this.pending[e.name]||(this.pendingRequest++,u(e).addClass(this.settings.pendingClass),this.pending[e.name]=!0)},stopRequest:function(e,t){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],u(e).removeClass(this.settings.pendingClass),t&&0===this.pendingRequest&&this.formSubmitted&&this.form()&&0===this.pendingRequest?(u(this.currentForm).trigger("submit"),this.submitButton&&u("input:hidden[name='"+this.submitButton.name+"']",this.currentForm).remove(),this.formSubmitted=!1):!t&&0===this.pendingRequest&&this.formSubmitted&&(u(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e,t){return t="string"==typeof t&&t||"remote",u.data(e,"previousValue")||u.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,{method:t})})},destroy:function(){this.resetForm(),u(this.currentForm).off(".validate").removeData("validator").find(".validate-equalTo-blur").off(".validate-equalTo").removeClass("validate-equalTo-blur").find(".validate-lessThan-blur").off(".validate-lessThan").removeClass("validate-lessThan-blur").find(".validate-lessThanEqual-blur").off(".validate-lessThanEqual").removeClass("validate-lessThanEqual-blur").find(".validate-greaterThanEqual-blur").off(".validate-greaterThanEqual").removeClass("validate-greaterThanEqual-blur").find(".validate-greaterThan-blur").off(".validate-greaterThan").removeClass("validate-greaterThan-blur")}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,t){e.constructor===String?this.classRuleSettings[e]=t:u.extend(this.classRuleSettings,e)},classRules:function(e){var t={},e=u(e).attr("class");return e&&u.each(e.split(" "),function(){this in u.validator.classRuleSettings&&u.extend(t,u.validator.classRuleSettings[this])}),t},normalizeAttributeRule:function(e,t,n,o){(o=/min|max|step/.test(n)&&(null===t||/number|range|text/.test(t))&&(o=Number(o),isNaN(o))?void 0:o)||0===o?e[n]=o:t===n&&"range"!==t&&(e["date"===t?"dateISO":n]=!0)},attributeRules:function(e){var t,n,o={},r=u(e),i=e.getAttribute("type");for(t in u.validator.methods)n="required"===t?(n=e.getAttribute(t),""===n&&(n=!0),!!n):r.attr(t),this.normalizeAttributeRule(o,i,t,n);return o.maxlength&&/-1|2147483647|524288/.test(o.maxlength)&&delete o.maxlength,o},dataRules:function(e){var t,n,o={},r=u(e),i=e.getAttribute("type");for(t in u.validator.methods)n=r.data("rule"+t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()),""===n&&(n=!0),this.normalizeAttributeRule(o,i,t,n);return o},staticRules:function(e){var t={},n=u.data(e.form,"validator");return t=n.settings.rules?u.validator.normalizeRule(n.settings.rules[e.name])||{}:t},normalizeRules:function(o,r){return u.each(o,function(e,t){if(!1===t)delete o[e];else if(t.param||t.depends){var n=!0;switch(_typeof(t.depends)){case"string":n=!!u(t.depends,r.form).length;break;case"function":n=t.depends.call(r,r)}n?o[e]=void 0===t.param||t.param:(u.data(r.form,"validator").resetElements(u(r)),delete o[e])}}),u.each(o,function(e,t){o[e]="function"==typeof t&&"normalizer"!==e?t(r):t}),u.each(["minlength","maxlength"],function(){o[this]&&(o[this]=Number(o[this]))}),u.each(["rangelength","range"],function(){var e;o[this]&&(Array.isArray(o[this])?o[this]=[Number(o[this][0]),Number(o[this][1])]:"string"==typeof o[this]&&(e=o[this].replace(/[\[\]]/g,"").split(/[\s,]+/),o[this]=[Number(e[0]),Number(e[1])]))}),u.validator.autoCreateRanges&&(null!=o.min&&null!=o.max&&(o.range=[o.min,o.max],delete o.min,delete o.max),null!=o.minlength)&&null!=o.maxlength&&(o.rangelength=[o.minlength,o.maxlength],delete o.minlength,delete o.maxlength),o},normalizeRule:function(e){var t;return"string"==typeof e&&(t={},u.each(e.split(/\s/),function(){t[this]=!0}),e=t),e},addMethod:function(e,t,n){u.validator.methods[e]=t,u.validator.messages[e]=void 0!==n?n:u.validator.messages[e],t.length<3&&u.validator.addClassRules(e,u.validator.normalizeRule(e))},methods:{required:function(e,t,n){return this.depend(n,t)?"select"===t.nodeName.toLowerCase()?(n=u(t).val())&&0<n.length:this.checkable(t)?0<this.getLength(e,t):null!=e&&0<e.length:"dependency-mismatch"},email:function(e,t){return this.optional(t)||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},url:function(e,t){return this.optional(t)||/^(?:(?:(?:https?|ftp):)?\/\/)(?:(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})+(?::(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e)},date:(n=!1,function(e,t){return n||(n=!0,this.settings.debug&&window.console&&console.warn("The `date` method is deprecated and will be removed in version '2.0.0'.\nPlease don't use it, since it relies on the Date constructor, which\nbehaves very differently across browsers and locales. Use `dateISO`\ninstead or one of the locale specific methods in `localizations/`\nand `additional-methods.js`.")),this.optional(t)||!/Invalid|NaN/.test(new Date(e).toString())}),dateISO:function(e,t){return this.optional(t)||/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(e)},number:function(e,t){return this.optional(t)||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)},digits:function(e,t){return this.optional(t)||/^\d+$/.test(e)},minlength:function(e,t,n){e=Array.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||n<=e},maxlength:function(e,t,n){e=Array.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||e<=n},rangelength:function(e,t,n){e=Array.isArray(e)?e.length:this.getLength(e,t);return this.optional(t)||e>=n[0]&&e<=n[1]},min:function(e,t,n){return this.optional(t)||n<=e},max:function(e,t,n){return this.optional(t)||e<=n},range:function(e,t,n){return this.optional(t)||e>=n[0]&&e<=n[1]},step:function(e,t,n){function o(e){return(e=(""+e).match(/(?:\.(\d+))?$/))&&e[1]?e[1].length:0}function r(e){return Math.round(e*Math.pow(10,i))}var i,s=u(t).attr("type"),a="Step attribute on input type "+s+" is not supported.",l=new RegExp("\\b"+s+"\\b"),c=!0;if(s&&!l.test(["text","number","range"].join()))throw new Error(a);return i=o(n),(o(e)>i||r(e)%r(n)!=0)&&(c=!1),this.optional(t)||c},equalTo:function(e,t,n){n=u(n);return this.settings.onfocusout&&n.not(".validate-equalTo-blur").length&&n.addClass("validate-equalTo-blur").on("blur.validate-equalTo",function(){u(t).valid()}),e===n.val()},remote:function(o,r,e,i){if(this.optional(r))return"dependency-mismatch";i="string"==typeof i&&i||"remote";var s,t,a=this.previousValue(r,i);return this.settings.messages[r.name]||(this.settings.messages[r.name]={}),a.originalMessage=a.originalMessage||this.settings.messages[r.name][i],this.settings.messages[r.name][i]=a.message,t=u.param(u.extend({data:o},(e="string"==typeof e?{url:e}:e).data)),a.old===t?a.valid:(a.old=t,(s=this).startRequest(r),(t={})[r.name]=o,u.ajax(u.extend(!0,{mode:"abort",port:"validate"+r.name,dataType:"json",data:t,context:s.currentForm,success:function(e){var t,n=!0===e||"true"===e;s.settings.messages[r.name][i]=a.originalMessage,n?(t=s.formSubmitted,s.resetInternals(),s.toHide=s.errorsFor(r),s.formSubmitted=t,s.successList.push(r),s.invalid[r.name]=!1,s.showErrors()):(t={},e=e||s.defaultMessage(r,{method:i,parameters:o}),t[r.name]=a.message=e,s.invalid[r.name]=!0,s.showErrors(t)),a.valid=n,s.stopRequest(r,n)}},e)),"pending")}}});var o,r={};return u.ajaxPrefilter?u.ajaxPrefilter(function(e,t,n){var o=e.port;"abort"===e.mode&&(r[o]&&r[o].abort(),r[o]=n)}):(o=u.ajax,u.ajax=function(e){var t=("mode"in e?e:u.ajaxSettings).mode,e=("port"in e?e:u.ajaxSettings).port;return"abort"===t?(r[e]&&r[e].abort(),r[e]=o.apply(this,arguments),r[e]):o.apply(this,arguments)}),u}),(()=>{try{var e;("undefined"==typeof document?"undefined":_typeof(document))<"u"&&((e=document.createElement("style")).appendChild(document.createTextNode(".cdx-marker{background:rgba(245,235,111,.29);padding:3px 0}")),document.head.appendChild(e))}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})(),(e=>{"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&("undefined"==typeof module?"undefined":_typeof(module))<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(("undefined"==typeof globalThis?"undefined":_typeof(globalThis))<"u"?globalThis:self).Marker=e()})(function(){return(()=>{function n(e){e=e.api;_classCallCheck(this,n),this.api=e,this.button=null,this.tag="MARK",this.iconClasses={base:this.api.styles.inlineToolButton,active:this.api.styles.inlineToolButtonActive}}return _createClass(n,[{key:"render",value:function(){return this.button=document.createElement("button"),this.button.type="button",this.button.classList.add(this.iconClasses.base),this.button.innerHTML=this.toolboxIcon,this.button}},{key:"surround",value:function(e){var t;e&&((t=this.api.selection.findParentTag(this.tag,n.CSS))?this.unwrap(t):this.wrap(e))}},{key:"wrap",value:function(e){var t=document.createElement(this.tag);t.classList.add(n.CSS),t.appendChild(e.extractContents()),e.insertNode(t),this.api.selection.expandToTag(t)}},{key:"unwrap",value:function(e){this.api.selection.expandToTag(e);var t=window.getSelection(),n=t.getRangeAt(0),o=n.extractContents();e.parentNode.removeChild(e),n.insertNode(o),t.removeAllRanges(),t.addRange(n)}},{key:"checkState",value:function(){var e=this.api.selection.findParentTag(this.tag,n.CSS);this.button.classList.toggle(this.iconClasses.active,!!e)}},{key:"toolboxIcon",get:function(){return'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-width="2" d="M11.3536 9.31802L12.7678 7.90381C13.5488 7.12276 14.8151 7.12276 15.5962 7.90381C16.3772 8.68486 16.3772 9.95119 15.5962 10.7322L14.182 12.1464M11.3536 9.31802L7.96729 12.7043C7.40889 13.2627 7.02827 13.9739 6.8734 14.7482L6.69798 15.6253C6.55804 16.325 7.17496 16.942 7.87468 16.802L8.75176 16.6266C9.52612 16.4717 10.2373 16.0911 10.7957 15.5327L14.182 12.1464M11.3536 9.31802L14.182 12.1464"/><line x1="15" x2="19" y1="17" y2="17" stroke="currentColor" stroke-linecap="round" stroke-width="2"/></svg>'}}],[{key:"CSS",get:function(){return"cdx-marker"}},{key:"isInline",get:function(){return!0}},{key:"sanitize",get:function(){return{mark:{class:n.CSS}}}}])})()}),(()=>{try{var e;("undefined"==typeof document?"undefined":_typeof(document))<"u"&&((e=document.createElement("style")).appendChild(document.createTextNode(".cdx-simple-image .cdx-loader{min-height:200px}.cdx-simple-image .cdx-input{margin-top:10px}.cdx-simple-image img{max-width:100%;vertical-align:bottom}.cdx-simple-image__caption[contentEditable=true][data-placeholder]:empty:before{position:absolute;content:attr(data-placeholder);color:#707684;font-weight:400;opacity:0}.cdx-simple-image__caption[contentEditable=true][data-placeholder]:empty:before{opacity:1}.cdx-simple-image__caption[contentEditable=true][data-placeholder]:empty:focus:before{opacity:0}.cdx-simple-image__picture--with-background{background:#eff2f5;padding:10px}.cdx-simple-image__picture--with-background img{display:block;max-width:60%;margin:0 auto}.cdx-simple-image__picture--with-border{border:1px solid #e8e8eb;padding:1px}.cdx-simple-image__picture--stretched img{max-width:none;width:100%}")),document.head.appendChild(e))}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})(),(e=>{"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&("undefined"==typeof module?"undefined":_typeof(module))<"u"?module.exports=e():"function"==typeof define&&define.amd?define(e):(("undefined"==typeof globalThis?"undefined":_typeof(globalThis))<"u"?globalThis:self).SimpleImage=e()})(function(){return(()=>_createClass(function e(t){var n=t.data,o=t.api,t=t.readOnly;_classCallCheck(this,e),this.api=o,this.readOnly=t,this.blockIndex=this.api.blocks.getCurrentBlockIndex()+1,this.CSS={baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input,wrapper:"cdx-simple-image",imageHolder:"cdx-simple-image__picture",caption:"cdx-simple-image__caption"},this.nodes={wrapper:null,imageHolder:null,image:null,caption:null},this.data={url:n.url||"",caption:n.caption||"",withBorder:void 0!==n.withBorder&&n.withBorder,withBackground:void 0!==n.withBackground&&n.withBackground,stretched:void 0!==n.stretched&&n.stretched},this.tunes=[{name:"withBorder",label:"Add Border",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 9.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.5 5H14.5096"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M14.625 5H15C17.2091 5 19 6.79086 19 9V9.375"/><path stroke="currentColor" stroke-width="2" d="M9.375 5L9 5C6.79086 5 5 6.79086 5 9V9.375"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 5H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 9.5H5.00957"/><path stroke="currentColor" stroke-width="2" d="M9.375 19H9C6.79086 19 5 17.2091 5 15V14.625"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.3725 19H9.38207"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 14.55H5.00957"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/></svg>'},{name:"stretched",label:"Stretch Image",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9L20 12L17 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 12H20"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 9L4 12L7 15"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12H10"/></svg>'},{name:"withBackground",label:"Add Background",icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19V19C9.13623 19 8.20435 19 7.46927 18.6955C6.48915 18.2895 5.71046 17.5108 5.30448 16.5307C5 15.7956 5 14.8638 5 13V12C5 9.19108 5 7.78661 5.67412 6.77772C5.96596 6.34096 6.34096 5.96596 6.77772 5.67412C7.78661 5 9.19108 5 12 5H13.5C14.8956 5 15.5933 5 16.1611 5.17224C17.4395 5.56004 18.44 6.56046 18.8278 7.83886C19 8.40666 19 9.10444 19 10.5V10.5"/><path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="M16 13V16M16 19V16M19 16H16M16 16H13"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6.5 17.5L17.5 6.5"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.9919 10.5H19.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.9919 19H11.0015"/><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13L13 5"/></svg>'}]},[{key:"render",value:function(){var e=this,t=this._make("div",[this.CSS.baseClass,this.CSS.wrapper]),n=this._make("div",this.CSS.loading),o=this._make("div",this.CSS.imageHolder),r=this._make("img"),i=this._make("div",[this.CSS.input,this.CSS.caption],{contentEditable:!this.readOnly,innerHTML:this.data.caption||""});return i.dataset.placeholder="Enter a caption",t.appendChild(n),this.data.url&&(r.src=this.data.url),r.onload=function(){t.classList.remove(e.CSS.loading),o.appendChild(r),t.appendChild(o),t.appendChild(i),n.remove(),e._acceptTuneView()},r.onerror=function(e){console.log("Failed to load an image",e)},this.nodes.imageHolder=o,this.nodes.wrapper=t,this.nodes.image=r,this.nodes.caption=i,t}},{key:"save",value:function(e){var t=e.querySelector("img"),e=e.querySelector("."+this.CSS.input);return t?Object.assign(this.data,{url:t.src,caption:e.innerHTML}):this.data}},{key:"onDropHandler",value:function(n){var e=new FileReader;return e.readAsDataURL(n),new Promise(function(t){e.onload=function(e){t({url:e.target.result,caption:n.name})}})}},{key:"onPaste",value:function(e){var t=this;switch(e.type){case"tag":var n=e.detail.data;this.data={url:n.src};break;case"pattern":n=e.detail.data;this.data={url:n};break;case"file":n=e.detail.file;this.onDropHandler(n).then(function(e){t.data=e})}}},{key:"data",get:function(){return this._data},set:function(e){this._data=Object.assign({},this.data,e),this.nodes.image&&(this.nodes.image.src=this.data.url),this.nodes.caption&&(this.nodes.caption.innerHTML=this.data.caption)}},{key:"renderSettings",value:function(){var t=this;return this.tunes.map(function(e){return _objectSpread(_objectSpread({},e),{},{label:t.api.i18n.t(e.label),toggle:!0,onActivate:function(){return t._toggleTune(e.name)},isActive:!!t.data[e.name]})})}},{key:"_make",value:function(e){var t,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},r=document.createElement(e);for(t in Array.isArray(n)?(e=r.classList).add.apply(e,_toConsumableArray(n)):n&&r.classList.add(n),o)r[t]=o[t];return r}},{key:"_toggleTune",value:function(e){this.data[e]=!this.data[e],this._acceptTuneView()}},{key:"_acceptTuneView",value:function(){var t=this;this.tunes.forEach(function(e){t.nodes.imageHolder.classList.toggle(t.CSS.imageHolder+"--"+e.name.replace(/([A-Z])/g,function(e){return"-".concat(e[0].toLowerCase())}),!!t.data[e.name]),"stretched"===e.name&&t.api.blocks.stretchBlock(t.blockIndex,!!t.data.stretched)})}}],[{key:"sanitize",get:function(){return{url:{},withBorder:{},withBackground:{},stretched:{},caption:{br:!0}}}},{key:"isReadOnlySupported",get:function(){return!0}},{key:"pasteConfig",get:function(){return{patterns:{image:/https?:\/\/\S+\.(gif|jpe?g|tiff|png|webp)$/i},tags:[{img:{src:!0}}],files:{mimeTypes:["image/*"]}}}}]))()});